=== Fetching Proposal: MDU6SXNzdWU2NTg0OTU1MDE= ===
Issue URL: https://github.com/golang/go/issues/40255

==== [Issue Title] ====
all: drop GO386=387 support in Go 1.16

==== [Issue Body] ====
I propose dropping 387 floating-point support and requiring SSE2 support for GOARCH=386 in the native gc compiler for Go 1.16. This would raise the minimum GOARCH=386 requirement to the Intel Pentium 4 (released in 2000) or AMD Opteron/Athlon 64 (released in 2003).

We would need to pre-announce this in the 1.15 release notes. (I've put it in the 1.15 milestone for this reason.)

There are several benefits to doing this:
1. While 387 support isn’t a huge maintenance burden, it does take time away from performance and feature work and represents a fair amount of latent complexity.
2. 387 support has been a regular source of bugs (#36400, #27516, #22429, #17357, #13923, #12970, #4798, just to name a few).
3. 387 bugs often go undetected for a long time because we don’t have builders that support only 387 (so unsupported instructions can slip in unnoticed).
4. Raising the minimum requirement to SSE2 would allow us to also assume many other useful architectural features, such as proper memory fences and 128 bit registers, which would simplify the compiler and runtime and allow for much more efficient implementations of core functions like memmove on 386.
5. We’re exploring switching to a register-based calling convention in Go 1.16, which promises significant performance improvements, but retaining 387 support will definitely complicate this and slow our progress.

The gccgo toolchain will continue to support 387 floating-point, so this remains an option for projects that absolutely must use 387 floating-point.

I proposed this on [golang-nuts](https://groups.google.com/g/golang-nuts/c/Gl6bODRX1NE/m/F7qxbt3sBQAJ) to get feedback on significant uses of GO386=387, particularly for which using gccgo would not be a viable option.

==== [Comments] ====

--- Comment #1 by gopherbot ---
Change https://golang.org/cl/243137 mentions this issue: `doc/go1.15: announce GO386=387 deprecation`

--- Comment #2 by aclements ---
We should wait a little longer for public comment, but I've gone ahead and prepared the pre-announcement for the release notes. (We could also submit the release notes change and roll it back if necessary.)

Nick Craig-Wood pointed out on golang-nuts that we should make sure GO386=387 fails with a useful error message if we do drop it (rather than, say, starting to ignore the GO386 environment variable entirely).

--- Comment #3 by mvdan ---
Perhaps a silly question, but would this affect GOARCH=amd64 at all?

--- Comment #4 by randall77 ---
@mvdan, no it would not.


--- Comment #5 by beoran ---
I guess I am the only one who still has such an old computer. Emulated coprocessor support is also still useful for certain embedded systems. I would keep the feature around for a few more years.

--- Comment #6 by martisch ---
It is known that systems still exists that do not support SSE2. I have several too. It would be interesting if there are users of them relying on current versions of Go for more than hobbyist use and if they cant use gccgo.

--- Comment #7 by aclements ---
I've gone ahead and submitted the deprecation notice to the 1.15 release notes. However, this issue is still in proposal review. If it does get declined, we can revert the CL. I've asked for this to get reviewed in next week's proposal review meeting.

--- Comment #8 by rsc ---
This went into the proposal minutes last week, and @aclements mailed it to golang-nuts and golang-dev as well. Let's leave this open another week before moving to likely accept, but there doesn't seem to be much pushback here.


--- Comment #9 by rsc ---
Based on the discussion above, this seems like a **likely accept**.
So long, 387, and thanks for all the floating-point errors.


--- Content after FINAL acceptance decision removed ---