=== Fetching Proposal: MDU6SXNzdWU1NTUxNTkzMjY= ===
Issue URL: https://github.com/golang/go/issues/36771

==== [Issue Title] ====
strconv: add ParseComplex

==== [Issue Body] ====
strconv.ParseComplex(s string, bitSize int) (complex128, error)

==== [Comments] ====

--- Comment #1 by pjebs ---
I don't think it should import `regexp` or `strings` to keep the package small. It is heavily recommended (instead of fmt) by gopherjs for exactly this reason.

--- Comment #2 by josharian ---
Exactly what format(s) do you think it should accept?

--- Comment #3 by ianlancetaylor ---
Note that the language doesn't define any format for a complex expression.  Instead it defines an imaginary literal (an integer or floating point constant followed by `i`).  Any complex constant is simply a constant expression that includes at least one imaginary literal.  So I think @josharian is asking a good question here.  We don't want the strconv package to have to parse an arbitrary expression.

That said, we do have an implicit definition for parsing a complex constant in `fmt.Scan`, implemented in the method `fmt.(*ss).complexTokens` (https://golang.org/src/fmt/scan.go#L740).  This syntax doesn't seem to have any user-visible documentation.  We could decide to move that method over to `strconv.ParseComplex`.

--- Comment #4 by pjebs ---
Let me know with what I've done so far after addressing your concerns.

PR: https://github.com/golang/go/pull/36815

--- Comment #5 by pjebs ---
It will accept:
```
- (±34.3±234.2i)
- ±34.3±234.2i
- exponential form
- hexadecimal form
- NaN
- ±Inf±Infi
- only real
- only imag
```

--- Comment #6 by gopherbot ---
Change https://golang.org/cl/216617 mentions this issue: `strconv: Add ParseCompex function`

--- Comment #7 by pjebs ---
Any news on this?

--- Comment #8 by rsc ---
`fmt.Print` and `fmt.Scan` do have an implicit format for complex numbers:
FLOAT+/-FLOATi or (FLOAT+/-FLOATi)
They format and accept both decimal and hex floats, and NaN and Inf for either or both FLOATs.

For floats we have:

func ParseFloat(s string, bitSize int) (float64, error)
func FormatFloat(f float64, fmt byte, prec, bitSize int) string

It seems like we'd need

func ParseComplex(s string, bitSize int) (complex128, error)
func FormatComplex(c complex128, fmt byte, prec, bitSize int) string

This seems like it is a hole we forgot to fill. 

/cc @robpike @griesemer 

--- Comment #9 by robpike ---
Seems like a reasonable thing to add, in parallel with float64 support as @rsc says. It would be good to see if the fmt package adapts well to using it.

--- Comment #10 by pjebs ---
What should `FormatComplex` return?
- With brackets or without brackets?
- hex or always decimal?

--- Comment #11 by rsc ---
FormatComplex should probably put in the parens, same as fmt.
The question of hex or decimal is controlled by the fmt byte,
like in Printf: 'x' gets hex.

For example, I believe these tests from fmt show what fmt='x' prec=3 should do:

```
fmt_test.go:532:	{"%.3x", 0i, "(0x0.000p+00+0x0.000p+00i)"},
fmt_test.go:538:	{"%.3x", 1 + 2i, "(0x1.000p+00+0x1.000p+01i)"},
fmt_test.go:542:	{"%.3x", -1 - 2i, "(-0x1.000p+00-0x1.000p+01i)"},
```





--- Comment #12 by pjebs ---
cool. implemented FormatComplex. Will do unit tests later.

--- Comment #13 by rsc ---
Based on the discussion, this seems like a **likely accept**.



--- Content after FINAL acceptance decision removed ---