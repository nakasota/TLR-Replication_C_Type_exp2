=== Fetching Proposal: MDU6SXNzdWU1MDEzMTUxNTA= ===
Issue URL: https://github.com/golang/go/issues/34652

==== [Issue Title] ====
text/template/parse: add CommentNode to the parse tree

==== [Issue Body] ====
Currently, template comments are ignored in the lexer and do not show in the parse tree.   
It makes it difficult to build tools around templates (like code formatter) without re-implementing the parser. 

My proposal is to add a CommentNode to the parse tree and skip it in the executer. 

==== [Comments] ====

--- Comment #1 by mvdan ---
I assume this can only be accepted if https://github.com/golang/go/issues/25357 is rejected.

--- Comment #2 by a8m ---
> I assume this can only be accepted if #25357 is rejected.

Why? It's a Go2 proposal, and `text/template/parse` is a public package that's being used outside.



--- Comment #3 by mvdan ---
Yes; but if the plan is to eventually hide/remove the `template/parse` package, considering API changes to it wouldn't make a lot of sense. At the very least, the two proposals are related.

--- Comment #4 by rsc ---
/cc @robpike for thoughts about supporting template-manipulation programs a la gofmt by adding CommentNode.


--- Comment #5 by a8m ---
I think itâ€™s needed for gopls as well  - #36911

--- Comment #6 by robpike ---
I would have made the package internal had that been an option at the time, but I couldn't, and now it's being used by software that wouldn't have been able to, making it harder to maintain and de facto subject to the compatibility rules. From my position, that is a tale of woe. Hyrum's law, which was a problem before Hyrum was even born, bites again.

On the other hand, people do depend on it and the uses are mostly reasonable, so we should probably accept this and close #25357.  I do think though that we should keep the comment that discourages its use, to give us some leverage against unreasonable requests for change.

--- Comment #7 by rsc ---
Based on the discussion above, then, this sounds like a **likely accept**.
For what it's worth, I might have made regexp/syntax an internal package too, but it has proved so useful in so many other contexts that I'm glad I exposed it.


--- Content after FINAL acceptance decision removed ---