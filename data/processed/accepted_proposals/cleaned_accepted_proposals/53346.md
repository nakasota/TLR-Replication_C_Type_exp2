=== Fetching Proposal: I_kwDOAWBuf85LpArO ===
Issue URL: https://github.com/golang/go/issues/53346

==== [Issue Title] ====
encoding/xml: Add (*Encoder).Close() to check for unclosed elements

==== [Issue Body] ====
When using [(*xml.Encoder).EncodeToken](
https://pkg.go.dev/encoding/xml#Encoder.EncodeToken), the `Encoder` checks for mismatched elements. That is, it returns an error if e.g. a `<a>` element is closed with a `</b>` token or if there is an extra `</c>` token after all elements have already been closed.

However, if the user simply forgets to close all elements, the `Encoder` emits incorrect XML without reporting an error. See [this code, for an example](https://go.dev/play/p/UMuDbDMn2i5). So currently, the user must track the tokens they encode themselves, to make sure the emitted XML is valid.

`Flush` returns an `error`, but as it is possible to encode more tokens after `Flush` has been called, it can't complain about unclosed elements itself.

I thus propose to add a new method to `Encoder`:

```go
// Close the Encoder, indicating that no more data will be written. It flushes any buffered XML to the underlying writer
// and returns an error if the written XML is invalid (e.g. by containing unclosed elements).
// After Close has been called, any Encode method return errors.
func (enc *Encoder) Close() error
```

Naming the method `Close` is an indication that it should be called and the returned error should be checked by the user.

==== [Comments] ====

--- Comment #1 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
â€” rsc for the proposal review group


--- Comment #2 by rsc ---
Overall this seems simple and reasonable to me. 
I assume Close would also Flush, so that you can just call Close.


--- Comment #3 by Merovius ---
> I assume Close would also Flush, so that you can just call Close.

Yes, that's definitely the intention.

--- Comment #4 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
â€” rsc for the proposal review group


--- Comment #5 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. ðŸŽ‰
This issue now tracks the work of implementing the proposal.
â€” rsc for the proposal review group

--- Content after FINAL acceptance decision removed ---