=== Fetching Proposal: I_kwDOAWBuf85JT1Po ===
Issue URL: https://github.com/golang/go/issues/52792

==== [Issue Title] ====
cmd/go: `go list -e -m -json all` to start displaying hashes of modules

==== [Issue Body] ====
Proposal source: [Gophers Slack](https://gophers.slack.com/archives/C9BMAAFFB/p1650981840694759)

I came to notice that the `go` tool does not list module hash sums when the `list -e -m -json all` command is invoked.
```
$ go mod init hash

$ go get github.com/vmware/govmomi@latest                                                                                                                         â”€â•¯
go: downloading github.com/vmware/govmomi v0.28.0
go: added github.com/vmware/govmomi v0.28.0

$ go list -e -m -json all
{
	"Path": "hash",
	"Main": true,
	"Dir": "/Users/hhalil/test",
	"GoMod": "/Users/hhalil/test/go.mod",
	"GoVersion": "1.18"
}
{
	"Path": "github.com/a8m/tree",
	"Version": "v0.0.0-20210115125333-10a5fd5b637d",
	"Time": "2021-01-15T12:53:33Z",
	"Indirect": true
}
{
	"Path": "github.com/dougm/pretty",
	"Version": "v0.0.0-20171025230240-2ee9d7453c02",
	"Time": "2017-10-25T23:02:40Z",
	"Indirect": true
}
{
	"Path": "github.com/google/uuid",
	"Version": "v1.3.0",
	"Time": "2021-07-12T22:33:52Z",
	"Indirect": true
}
{
	"Path": "github.com/kr/pretty",
	"Version": "v0.3.0",
	"Time": "2020-11-24T22:22:38Z",
	"Indirect": true
}
{
	"Path": "github.com/kr/text",
	"Version": "v0.2.0",
	"Time": "2020-02-14T20:31:06Z",
	"Indirect": true
}
{
	"Path": "github.com/rasky/go-xdr",
	"Version": "v0.0.0-20170217172119-4930550ba2e2",
	"Time": "2017-02-17T17:21:19Z",
	"Indirect": true
}
{
	"Path": "github.com/vmware/govmomi",
	"Version": "v0.28.0",
	"Time": "2022-04-27T15:48:05Z",
	"Indirect": true,
	"Dir": "/Users/hhalil/go/pkg/mod/github.com/vmware/govmomi@v0.28.0",
	"GoMod": "/Users/hhalil/go/pkg/mod/cache/download/github.com/vmware/govmomi/@v/v0.28.0.mod",
	"GoVersion": "1.17"
}
{
	"Path": "github.com/vmware/vmw-guestinfo",
	"Version": "v0.0.0-20170707015358-25eff159a728",
	"Time": "2017-07-07T01:53:58Z",
	"Indirect": true
}
```

That is not the case with `go mod download -json`
```
$ go mod download -json                                                                                                                                         â”€â•¯
{
	"Path": "github.com/vmware/govmomi",
	"Version": "v0.28.0",
	"Info": "/Users/hhalil/go/pkg/mod/cache/download/github.com/vmware/govmomi/@v/v0.28.0.info",
	"GoMod": "/Users/hhalil/go/pkg/mod/cache/download/github.com/vmware/govmomi/@v/v0.28.0.mod",
	"Zip": "/Users/hhalil/go/pkg/mod/cache/download/github.com/vmware/govmomi/@v/v0.28.0.zip",
	"Dir": "/Users/hhalil/go/pkg/mod/github.com/vmware/govmomi@v0.28.0",
	"Sum": "h1:VgeQ/Rvz79U9G8QIKLdgpsN9AndHJL+5iMJLgYIrBGI=",
	"GoModSum": "h1:F7adsVewLNHsW/IIm7ziFURaXDaHEwcc+ym4r3INMdY="
}
```

The proposal here is to extend the underlying data structures of `go list -m` to present information such as `Sum` and `GoModSum`, just like `go mod download -json`. By definition, *"The -m flag causes list to list modules instead of packages."*, therefore I believe it makes sense for the module data to include hash information.

Also, it would be useful if `go list -m` can also function in workspace mode, meaning that it would present the hashes of the modules **after MVS has been applied to all of them**, but that is conditional logic on `GOWORK`.

The target struct to modify might be this:
https://github.com/golang/go/blob/53f13128a7a4c7d16af5ea9ca5f25b56ff9881fe/src/cmd/go/internal/modinfo/info.go#L12-L27

... and its implementation of the Stringer interface:
https://github.com/golang/go/blob/53f13128a7a4c7d16af5ea9ca5f25b56ff9881fe/src/cmd/go/internal/modinfo/info.go#L33-L65

==== [Comments] ====

--- Comment #1 by HakanSunay ---
cc: @bcmills 

--- Comment #2 by rsc ---
GoModSum would at least need to be a []string. When we do a transition to a new algorithm there will be multiple checksums. 

--- Comment #3 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
â€” rsc for the proposal review group


--- Comment #4 by rsc ---
/cc @bcmills @matloob 

--- Comment #5 by rsc ---
Looks like we dropped the ball on go mod download -json about string vs []string. Let's keep GoModSum a single string, and maybe in the future we'll have to add GoModSums listing all of them.


--- Comment #6 by bcmills ---
SGTM. For reference. the `go mod download -json` struct definition is documented here:
https://pkg.go.dev/cmd/go#hdr-Download_modules_to_local_cache

--- Comment #7 by bcmills ---
So this would be two new fields for the `Module` definition for `go list`, paralleling the `Module` definition for `go mod download`. The new definition for `go list` would then be:

```go
type Module struct {
    Path      string       // module path
    Version   string       // module version
    Versions  []string     // available module versions (with -versions)
    Replace   *Module      // replaced by this module
    Time      *time.Time   // time version was created
    Update    *Module      // available update, if any (with -u)
    Main      bool         // is this the main module?
    Indirect  bool         // is this module only an indirect dependency of main module?
    Dir       string       // directory holding files for this module, if any
    GoMod     string       // path to go.mod file used when loading this module, if any
    GoVersion string       // go version used in module
    Retracted string       // retraction information, if any (with -retracted or -u)
    Error     *ModuleError // error loading module
    Sum       string       // checksum for path, version (as in go.sum)
    GoModSum  string       // checksum for go.mod (as in go.sum)
}
```

(Note that this would leave at least a couple of fields present in `go mod download` but absent from `go list`: namely, the `Info` and `Zip` fields.)

--- Comment #8 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
â€” rsc for the proposal review group


--- Comment #9 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. ðŸŽ‰
This issue now tracks the work of implementing the proposal.
â€” rsc for the proposal review group

--- Content after FINAL acceptance decision removed ---