=== Fetching Proposal: MDU6SXNzdWU3MTEzMjQ3MDY= ===
Issue URL: https://github.com/golang/go/issues/41696

==== [Issue Title] ====
cmd/go: deprecate the -i flag

==== [Issue Body] ====
`go build`, `go install`, and `go test` accept the `-i` flag. From `go help build`:

> The -i flag installs the packages that are dependencies of the target.

For example, if you run `go build -i example.com/a`, and `example.com/x` imports `example.com/y`, `go build` installs the file `$GOPATH/pkg/$GOOS_$GOARCH/example.com/y.a`.

This was useful for speeding up builds before Go 1.10, since previously installed packages didn't need to be recompiled. `go build` re-used packages installed in `$GOPATH/pkg`.

Go 1.10 introduced the build cache, so the `$GOPATH/pkg` directory is largely obsolete. Compiled packages are now stored in `$GOCACHE`. The `-i` flag merely copies files out of the build cache, so there's no longer any performance advantage.

The `-i` can cause errors when a target directory is not writable, as in #37962. In that issue, VSCode installed tools with `-i`, which caused errors when `$GOROOT/pkg` was not writable (common when Go is installed system-wide with an installer). Something caused `runtime/cgo` to be recompiled (perhaps a new `clang` version or flag), but it couldn't be written to `$GOROOT/pkg/darwin_amd64/runtime/cgo.a`.

Because of these problems, we should consider deprecating and eventually removing the `-i` flag.


==== [Comments] ====

--- Comment #1 by jayconrod ---
cc @bcmills @matloob @rsc 

--- Comment #2 by rsc ---
Are there any objections to doing this? I see plenty of emoji in favor and nothing else.


--- Comment #3 by mvdan ---
My only potential objection is breaking people who learned to use `go build -i` years ago, and perhaps introduced the flag in build or CI scripts. So the eventual removal of support for `-i` should come with a clear deprecation warning in the release changelog at least one or two releases before then.

--- Comment #4 by rsc ---
@mvdan, yes, deprecate and remove means it will have a release of printing a warning that -i is going away followed by the actual removal in the next release.


--- Comment #5 by rsc ---
Based on the discussion above, this seems like a **likely accept**.
To be clear, Go 1.16 would warn that the flag should not be used (but still complete successfully), and Go 1.17 would remove the flag.


--- Content after FINAL acceptance decision removed ---