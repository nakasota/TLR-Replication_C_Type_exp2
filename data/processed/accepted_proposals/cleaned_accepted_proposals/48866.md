=== Fetching Proposal: I_kwDOAWBuf8483fEE ===
Issue URL: https://github.com/golang/go/issues/48866

==== [Issue Title] ====
mime: allow duplicate media parameters with equal values

==== [Issue Body] ====
[This is a duplicate proposal of #28618, but it's closed due to `Timed out in state WaitingForInfo.` and doesn't accept further discussion.]

Some mail user agent (MUA) (incorrectly) generates mail header with duplicate parameter names, this is the one i received recently (duplicate `boundary`):

```
Content-Type: multipart/alternative; boundary="----RTIR0GV26TDW15Q5CVX979LBL6XN18"; boundary="----RTIR0GV26TDW15Q5CVX979LBL6XN18"
```

Golang standard library `mime.ParseMediaType()` does not allow duplicate media parameters so it is impossible to parse such a header (it returns error `mime: duplicate parameter name`).

I suggest making the `mime.ParseMediaType()` function more tolerant to such errors, for example, just use the first value and ignore the rest. At least it should not stop the execution if duplicate parameters have the same value.

--- 
See also:

- #28618, @xeruf reported similar mail header: `Content-Type: text/html; charset=utf-8; charset=UTF-8`
- #47602, @XYM01 reported similar http header: `Content-Type: multipart/form-data;boundary="boundary";boundary="another-boundary"`

==== [Comments] ====

--- Comment #1 by rsc ---
@iredmail what MUA specifically is generating this kind of message?

/cc @neild 

--- Comment #2 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
â€” rsc for the proposal review group


--- Comment #3 by iredmail ---
> @iredmail what MUA specifically is generating this kind of message?

Unfortunately the email doesn't contain a header like `X-Mailer:` to identify the MUA program, so i don't know. :(

- The email was sent on 24 Feb 2020, since we use `mime` package to parse email message for archiving purpose, it's normal that we need to parse a lot old emails which might be non-RFC-compliant.
- Email message is easy to forge, and many MUAs (especially email marketing and spamming tools) don't generate standard emails, it's also normal that we receive non-RFC-compliant messages.

--- Comment #4 by rsc ---
It sounds like the proposal is to continue to reject duplicate boundary= parameters but have a special case that if the duplicates all say the same boundary value, then it's OK. There's at least one buggy program generating these, and the intent is at least pretty clear.

Do I have that right?


--- Comment #5 by iredmail ---
You're right.

Unlike duplicate parameters with different values, there's no need to judge which one to use as final value, so ideally it should be allowed. :)

Note: ideally it should apply to all duplicate parameters with same value, not just `boundary=`. :)

--- Comment #6 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
â€” rsc for the proposal review group


--- Comment #7 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. ðŸŽ‰
This issue now tracks the work of implementing the proposal.
â€” rsc for the proposal review group

--- Content after FINAL acceptance decision removed ---