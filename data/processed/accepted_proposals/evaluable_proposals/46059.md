=== Fetching Proposal: MDU6SXNzdWU4ODEzNzM2NDk= ===
Issue URL: https://github.com/golang/go/issues/46059

==== [Issue Title] ====
net/url: add OmitHost bool to URL

==== [Issue Body] ====
<!--
Please answer these questions before submitting your issue. Thanks!
For questions please use one of our forums: https://github.com/golang/go/wiki/Questions
-->

### What version of Go are you using (`go version`)?

<pre>
$ go version
go version go1.16.3 linux/amd64
</pre>

### Does this issue reproduce with the latest release?

Yes

### What operating system and processor architecture are you using (`go env`)?

<details><summary><code>go env</code> Output</summary><br><pre>
$ go env
GO111MODULE=""
GOARCH="amd64"
GOBIN=""
GOCACHE="/home/timothy-gu/.cache/go-build"
GOENV="/home/timothy-gu/.config/go/env"
GOEXE=""
GOFLAGS=""
GOHOSTARCH="amd64"
GOHOSTOS="linux"
GOINSECURE=""
GOMODCACHE="/home/timothy-gu/go/pkg/mod"
GONOPROXY=""
GONOSUMDB=""
GOOS="linux"
GOPATH="/home/timothy-gu/go"
GOPRIVATE=""
GOPROXY="https://proxy.golang.org,direct"
GOROOT="/usr/lib/go"
GOSUMDB="sum.golang.org"
GOTMPDIR=""
GOTOOLDIR="/usr/lib/go/pkg/tool/linux_amd64"
GOVCS=""
GOVERSION="go1.16.3"
GCCGO="gccgo"
AR="ar"
CC="gcc"
CXX="g++"
CGO_ENABLED="1"
GOMOD="/home/timothy-gu/dev/go/go/src/go.mod"
CGO_CFLAGS="-g -O2"
CGO_CPPFLAGS=""
CGO_CXXFLAGS="-g -O2"
CGO_FFLAGS="-g -O2"
CGO_LDFLAGS="-g -O2"
PKG_CONFIG="pkg-config"
GOGCCFLAGS="-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build1221289449=/tmp/go-build -gno-record-gcc-switches"
</pre></details>

### What did you do?

<!--
If possible, provide a recipe for reproducing the error.
A complete runnable program is good.
A link on play.golang.org is best.
-->

https://play.golang.org/p/OFrp4cOVW8j

```go
import (
	"fmt"
	"net/url"
)

u, _ := url.Parse("myscheme:path")
fmt.Printf("myscheme:path\t%s\n", u)

u, _ = url.Parse("myscheme:/path")
fmt.Printf("myscheme:/path\t%s\n", u)

u, _ = url.Parse("myscheme://path")
fmt.Printf("myscheme://path\t%s\n", u)

u, _ = url.Parse("myscheme:///path")
fmt.Printf("myscheme:///path\t%s\n", u)
```

### What did you expect to see?

All the parsed URLs roundtrip.

```
myscheme:path	myscheme:path
myscheme:/path	myscheme:/path
myscheme://path	myscheme://path
myscheme:///path	myscheme:///path
```

### What did you see instead?

```
myscheme:path	myscheme:path
myscheme:/path	myscheme:///path    <-- three slashes
myscheme://path	myscheme://path
myscheme:///path	myscheme:///path
```

The issue here is that `myscheme:/path` and `myscheme:///path` are treated as the same URL, both parsing to

```
&url.URL{
	Scheme: "myscheme",
	Host: "",
	Path: "/path",
}
```

Yet, they are materially different URLs. According to [RFC 3986](https://www.rfc-editor.org/rfc/rfc3986.html), `myscheme:/path` should be treated as having a `path-absolute`, which does not have an `authority` defined. On the other hand, `myscheme:///path` _does_ have an `authority`, albeit an empty one.

Whether `authority` is undefined or empty is important for the [recomposition](https://www.rfc-editor.org/rfc/rfc3986.html#section-5.3) algorithm in the RFC (i.e., `URL.String`):

```
      if defined(authority) then
         append "//" to result;
         append authority to result;
      endif;
```

----

I can imagine two different ways to solve this problem:

1. Add a **ForceAuthority** boolean to url.URL, such that a true value implies an authority that is present even if Host is "" and User is nil. This has the advantage of being analogous to ForceQuery. However, it can run into compatibility problems: existing code that creates a `file` URL from scratch will now have their URL serialized to `file:/home/...` rather than the expected `file:///home/...`.

2. Add a **NoAuthority** boolean to url.URL, such that a _false_ value implies an authority is present. url.Parse will set this field if a `/` (but not `//`) is present right after the scheme. This maintains the previous behavior for any manually created URLs, but fixes the Parse/String roundtrip for URLs with a single slash.

I propose approach 2.

As a historical note, this limitation was known when introduced in cdd6ae128894abbaf3fef0401cdef319f3ec1d3d (Go 1.1) to fix #4189: https://github.com/golang/go/blob/b38b1b2f9ae710ee2c16a103bb21644f1adbc5d3/src/net/url/url_test.go#L166-L174 At the time, the argument against fixing this bug was a desire to avoid introducing more fields to url.URL. Since Go 1.1, we have added quite a few new fields to url.URL: RawPath (1.5), ForceQuery (1.7), and RawFragment (1.15). I think we should still maintain a high bar when introducing new fields, but the memory cost for adding a new boolean is low (zero in fact, if we pack the structure properly).

/cc @rsc @bradfitz 

==== [Comments] ====

--- Comment #1 by TimothyGu ---
I'll also add that among other URL parsers tested, Go is almost unique in not distinguishing between `myscheme:/path` and `myscheme:///path`. Chrome, Firefox, and Safari, as well as Ruby, Rust, Node.js, and the C [uriparser](https://uriparser.github.io/) library, all distinguish them.

Python represents an exception, but it normalizes `myscheme:///path` to `myscheme:/path`, the opposite from Go. (Python also treats `file` URLs differently from non-web URLs, which is also different from Go.)

--- Comment #2 by rsc ---
We don't call that section Authority, we just call it Host.
It sounds like we should add `OmitHost bool // do not emit empty host (authority)` to url.URL?


--- Comment #3 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
â€” rsc for the proposal review group


--- Comment #4 by TimothyGu ---
Ah, sorry I mixed up Host and Hostname(). OmitHost is a good name.

--- Comment #5 by rsc ---
It sounds like people are in favor of adding OmitHost to URL. Will retitle.


--- Comment #6 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
â€” rsc for the proposal review group


--- Comment #7 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. ðŸŽ‰
This issue now tracks the work of implementing the proposal.
â€” rsc for the proposal review group


--- Comment #8 by odeke-em ---
Kindly cc-ing @willpoint and @kirbyquerby to send a fix.

--- Comment #9 by gopherbot ---
Change https://go.dev/cl/391294 mentions this issue: `net/url: add OmitHost bool to url.URL`
