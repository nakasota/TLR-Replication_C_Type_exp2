=== Fetching Proposal: I_kwDOAWBuf85MIdpx ===
Issue URL: https://github.com/golang/go/issues/53466

==== [Issue Title] ====
all: add freebsd/riscv64 port

==== [Issue Body] ====
This issue is intended to serve both as a proposal and to track the progress of adding the freebsd/riscv64 port.

The majority of porting work is done, there's an out-of-tree port at https://github.com/MikaelUrankar/go/tree/freebsd_riscv64 which builds and passes all `run.bash` tests, including cgo (tested under QEMU and on Unmatched).

@mengzhuo has graciously agreed to setup and maintain the freebsd/riscv64 builder (on SiFive Unmatched) and @MikaelUrankar has agreed to be the port maintainer.

cc @golang/freebsd @golang/riscv64 @mengzhuo @MikaelUrankar

==== [Comments] ====

--- Comment #1 by mengzhuo ---
CC @rsc 

--- Comment #2 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
â€” rsc for the proposal review group


--- Comment #3 by mengzhuo ---
I tried to install the prometheus node_exporter and got undefined errors from `golang.org/x/sys`

I think we should update golang.org/x/sys and other x/ moduels first and leave alone the Go main develope cycle.

--- Comment #4 by paulzhol ---
I'm already updating `golang.org/x/sys` as part of https://github.com/golang/go/issues/53280. It is indeed horribly out of date. For example `Time_t` on freebsd/arm is still 32-bit. It was [switched](https://cgit.freebsd.org/src/commit/?id=ef4d5877ddefe6bfa5943d8e16f17c0c64fa7d17&h=stable%2F12) to 64-bit more than 16 years ago (I guess it originates directly from the `syscall` package).
There ptrace constants which are defined only on the x86 arches, not available on both ARMs (because these were probably not generated on actual hosts).
I shudder to think of what state the `golang.org/x/net/route` is in. `std` still carries a hand copied `if_data8` and `if_msghdr8` types.

--- Comment #5 by rsc ---
The new port policy (#53383) will require two maintainers for the port. Assuming that is accepted, is there anyone else who would be willing to be a second maintainer for freebsd/riscv64?


--- Comment #6 by dmgk ---
Assuming nobody else volunteers, I'll be willing to be a second maintainer for the freebsd/riscv64 (can we have more than two?). I think more people will be interested when this port is closer to be merged.

--- Comment #7 by mengzhuo ---
I want to be the third maintainer since the freebsd/riscv64 stage0 is up and ready.

--- Comment #8 by gopherbot ---
Change https://go.dev/cl/416834 mentions this issue: `unix: add freebsd/riscv64 support`

--- Comment #9 by rsc ---
Thanks to @MikaelUrankar, @dmgk, and @mengzhuo for volunteering to be maintainers.

--- Comment #10 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
â€” rsc for the proposal review group


--- Comment #11 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. ðŸŽ‰
This issue now tracks the work of implementing the proposal.
â€” rsc for the proposal review group


--- Comment #12 by gopherbot ---
Change https://go.dev/cl/418814 mentions this issue: `all: add FreeBSD riscv64 support`

--- Comment #13 by dmitshur ---
CC @golang/release.

--- Comment #14 by gopherbot ---
Change https://go.dev/cl/425937 mentions this issue: `build/dashboard: add freebsd-riscv64`

--- Comment #15 by dmitshur ---
Is it right for this issue to be closed now? `go tool dist list` at tip doesn't include freebsd/riscv64.

--- Comment #16 by dmgk ---
@dmitshur No, the riscv64 port is still not merged, please reopen.

--- Comment #17 by gopherbot ---
Change https://go.dev/cl/431655 mentions this issue: `syscall: add support for freebsd/riscv64`

--- Comment #18 by gopherbot ---
Change https://go.dev/cl/431656 mentions this issue: `runtime: add support for freebsd/riscv64`

--- Comment #19 by gopherbot ---
Change https://go.dev/cl/431661 mentions this issue: `cmd/link: skip tests on freebsd/riscv64 that requires internal cgo linking`

--- Comment #20 by gopherbot ---
Change https://go.dev/cl/431658 mentions this issue: `cmd/nm, runtime/cgo: add cgo support for freebsd/riscv64`

--- Comment #21 by gopherbot ---
Change https://go.dev/cl/431657 mentions this issue: `cmd/dist: enable cgo tests on freebsd/riscv64`

--- Comment #22 by gopherbot ---
Change https://go.dev/cl/431660 mentions this issue: `cmd/link/internal/riscv64: add support for freebsd/riscv64`

--- Comment #23 by gopherbot ---
Change https://go.dev/cl/431659 mentions this issue: `cmd/dist: add support for freebsd/riscv64`

--- Comment #24 by 4a6f656c ---
@mengzhuo the freebsd/riscv64 builder entry exists on the build dashboard, however the builder does not appear to be online (farmer.golang.org says "host-freebsd-riscv64-unmatched: 0/0 (1 missing)" - are we able to resolve this?

--- Comment #25 by mengzhuo ---
> @mengzhuo the freebsd/riscv64 builder entry exists on the build dashboard, however the builder does not appear to be online (farmer.golang.org says "host-freebsd-riscv64-unmatched: 0/0 (1 missing)" - are we able to resolve this?

It's running (stage0, buildlet are modified by hand).
However it can't download the buildlet from GCP repo for now.
I will submit those CLs today.

--- Comment #26 by gopherbot ---
Change https://go.dev/cl/432656 mentions this issue: `cmd/buildlet/stage0: add freebsd-riscv64-unmatched`

--- Comment #27 by gopherbot ---
Change https://go.dev/cl/432658 mentions this issue: `cmd/buildlet: add freebsd-riscv64`

--- Comment #28 by 4a6f656c ---
> It's running (stage0, buildlet are modified by hand). However it can't download the buildlet from GCP repo for now. I will submit those CLs today.

@mengzhuo per step 6 on https://github.com/golang/go/wiki/DashboardBuilders#how-to-set-up-a-builder (and the "WIP ports" comment at the bottom), you should be able to build and run the stage1 buildlet locally - I'm not sure that it can be built/made available for download until the port has already been upstreamed.

--- Comment #29 by gopherbot ---
Change https://go.dev/cl/432756 mentions this issue: `cmd/link: return correct default linker for the platform`

--- Comment #30 by mengzhuo ---
@4a6f656c 
It looks like we have to wait the port complete.
```
2022/09/24 09:50:07 Not on GCE; not remounting root filesystem.
2022/09/24 09:50:10 Dialing coordinator farmer.golang.org:443 ...
2022/09/24 09:50:20 dialing proxy "uplink.golangcn.org:8123" ...
2022/09/24 09:50:20 Dialed coordinator farmer.golang.org:443.
2022/09/24 09:50:20 Doing TLS handshake with coordinator (verifying hostname "farmer.golang.org")...
2022/09/24 09:50:21 Registering reverse mode with coordinator...
2022/09/24 09:50:21 Connected to coordinator; reverse dialing active
2022/09/24 09:50:21 Dialing coordinator farmer.golang.org:443 ...
2022/09/24 09:50:31 Dialing coordinator farmer.golang.org:443 ...
2022/09/24 09:50:31 dialing proxy "uplink.golangcn.org:8123" ...
2022/09/24 09:50:31 dialing proxy "uplink.golangcn.org:8123" ...
2022/09/24 09:50:31 Dialed coordinator farmer.golang.org:443.
2022/09/24 09:50:31 Doing TLS handshake with coordinator (verifying hostname "farmer.golang.org")...
2022/09/24 09:50:31 Dialed coordinator farmer.golang.org:443.
2022/09/24 09:50:31 Doing TLS handshake with coordinator (verifying hostname "farmer.golang.org")...
2022/09/24 09:50:32 Removing .
2022/09/24 09:50:32 writetgz: untarring Request.Body into /tmp/workdir-host-freebsd-riscv64-unmatched/go
2022/09/24 09:50:32 extracted tarball into /tmp/workdir-host-freebsd-riscv64-unmatched/go: 1 files, 1 dirs (1.503999ms)
2022/09/24 09:50:32 Dialing coordinator farmer.golang.org:443 ...
2022/09/24 09:50:32 dialing proxy "uplink.golangcn.org:8123" ...
2022/09/24 09:50:33 Dialed coordinator farmer.golang.org:443.
2022/09/24 09:50:33 Doing TLS handshake with coordinator (verifying hostname "farmer.golang.org")...
2022/09/24 09:50:33 writetgz: failed to fetch tgz URL https://storage.googleapis.com/go-builder-data/gobootstrap-freebsd-riscv64-go1.17.13.tar.gz: status=403 Forbidden
2022/09/24 09:50:33 writetgz: untarring Request.Body into /tmp/workdir-host-freebsd-riscv64-unmatched/go
2022/09/24 09:50:54 extracted tarball into /tmp/workdir-host-freebsd-riscv64-unmatched/go: 11349 files, 1241 dirs (20.368625001s)
2022/09/24 09:50:54 Halting in 1 second.
2022/09/24 09:50:54 http.Serve on reverse connection complete: revdial: Listener closed
2022/09/24 09:50:54 buildlet reverse mode exiting.

```


