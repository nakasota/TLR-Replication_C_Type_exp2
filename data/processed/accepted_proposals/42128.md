=== Fetching Proposal: MDU6SXNzdWU3MjY4NzA0MDg= ===
Issue URL: https://github.com/golang/go/issues/42128

==== [Issue Title] ====
x/net/dns/dnsmessage: use UnknownResource for an unrecognized DNS type

==== [Issue Body] ====
This is a proposal for the already written https://golang.org/cl/262037.  The proposal is to change methods like `(*Parser).Answer` and `(*Parser).Additional` such that when they see a resource that is not specifically recognized by the package, then rather than return an error, they return a `Resource` of type `UnknownResource`.

```Go
// An UnknownResource is a catch-all container for unknown record types.
type UnknownResource struct {
	Type uint16
	Data []byte
}
```

Filing a proposal as this is new API.

CC @iangudger 

==== [Comments] ====

--- Comment #1 by iangudger ---
LGTM

--- Comment #2 by tmthrgd ---
The `Type` field should be of type `Type` (say that quickly) rather than an untyped `uint16`. `ResourceHeader` already has:
```go
type ResourceHeader struct {
...
    // Type is the type of DNS resource record.
    //
    // This field will be set automatically during packing.
    Type Type
...
}
```

It should also be possible to add an `UnknownResource` to a `Builder`, otherwise you can't parse and then reassemble a message containing an unknown RR using that API (only with `Message`?).

This is definitely a good addition though, miekg/dns (of which I contribute) has similar support for unknown RRs with a [type RFC3597 struct](https://godoc.org/github.com/miekg/dns#RFC3597) that can be both packed and unpacked.

--- Comment #3 by dmcardle ---
Thanks, Tom!

I've switched the `uint16` to `Type` and added UnknownResource functions to `Parser` and `Builder`.

Here's the diff for those changes: https://go-review.googlesource.com/c/net/+/262037/6..8

--- Comment #4 by dmcardle ---
It's been brought to my attention that this design might be a compatibility issue when adding support for new RR types.

Rather than adding an `UnknownResource`, we could add a `Raw []byte` field to `ResourceHeader`. When an RR is unparseable, the `ResourceBody` would just be nil.

Suppose a user of this API wants to support a new RR type,  such as  [draft-ietf-dnsop-svcb-https-01](https://tools.ietf.org/html/draft-ietf-dnsop-svcb-https-01). If the caller relies on `UnknownResource` to catch the new record, adding explicit support for the new record to dnsmessage would break the user's code.

If their code instead branched on `Type == newRRType` and  read the `ResourceHeader.Raw` bytes, it would not be broken when dnsmessage adds support for the new RR type.

--- Comment #5 by iangudger ---
In my opinion, code that relies on `UnknownResource` like that should use the `Parser`. There is no compatibility guarantee for this package and the `ResourceHeader.Raw` solution will still likely break applications which don't follow best practices when adding RR types. I think the solution is to detail contracts and best practices in comments

--- Comment #6 by rsc ---
Adding to minutes but it seems headed for likely accept.


--- Comment #7 by rsc ---
Based on the discussion, this seems like a **likely accept**.


--- Comment #8 by rsc ---
No change in consensus, so accepted.


--- Comment #9 by dmcardle ---
I'm surprised this issue didn't get auto-closed yesterday when the change landed: https://github.com/golang/net/commit/cd0ac97f97f601545e9c3aa666cccb3e72af42ae.

--- Comment #10 by ianlancetaylor ---
Whoops, the line in the CL should have been `Fixes golang/go#42128`.
