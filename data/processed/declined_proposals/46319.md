=== Fetching Proposal: Deprecated proposals ===
Issue URL: https://github.com/golang/go/issues/46319

==== [Issue Title] ====
proposal: x/net/http2: support http.Hijacker

==== [Issue Body] ====
### What version of Go are you using (`go version`)?

<pre>
go version go1.16.4 linux/amd64
</pre>

### Does this issue reproduce with the latest release?

Yes.

### What did you do?

I wanted to use Websockets over HTTP2.

### What did you expect to see?

That HTTP2 ResponseWriter supports Hijacker.

### What did you see instead?

That it does not. Exploring this more, it looks like it is on purpose:

* https://github.com/golang/go/issues/14797
* https://github.com/golang/go/issues/15312

But since then, [WebSockets over HTTP2](https://datatracker.ietf.org/doc/html/rfc8441) have been standardized and [Firefox and Chromium](https://www.chromestatus.com/feature/6251293127475200) supports that. Thus, I suggest that now HTTP2 ResponseWriter should supports Hijacker so that one can use Websockets over HTTP2. The server should also be able to specify using HTTP/2 SETTINGS parameter that it supports Websockets over HTTP2.

==== [Comments] ====

--- Comment #1 by networkimprov ---
cc @fraenkel @neild @bradfitz 

--- Comment #2 by neild ---
The `Hijacker` interface takes over the TCP connection. HTTP/1 WebSocket connections start with an HTTP handshake after which the connection is passed to the WebSocket implementation.

WebSockets over HTTP/2 do not take over the TCP connection. Instead, the WebSocket protocol runs over an HTTP/2 stream. HTTP/2 permits multiple simultaneous streams on a TCP connection. HTTP/2 WebSockets need a way to read from and write to the HTTP/2 stream for a request, not a way to hijack the connection.

--- Comment #3 by mitar ---
So a new type of interface, of exposing something like a TCP connection on top of HTTP/2?

Maybe I should rename this issue then to "support for WebSockets over HTTP/2". :-)

--- Comment #4 by rsc ---
Talking to @bradfitz, it sounds like the HTTP/2 + WebSockets is defined in [RFC 8441](https://datatracker.ietf.org/doc/html/rfc8441). And as @neild pointed out, it doesn't need to use Hijacker. So it seems like we should decline this proposal and add explicit WebSockets support instead. 

It sounds like the latest Chrome (and presumably Edge) have support, as does Firefox, but perhaps not Safari.


--- Comment #5 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
— rsc for the proposal review group


--- Comment #6 by rsc ---

Based on the discussion above, this proposal seems like a **[likely decline](https://golang.org/s/proposal-status#likely-decline)**.
— rsc for the proposal review group


--- Comment #7 by mitar ---
Just to be clear, should I open a new issue for "support for WebSockets over HTTP/2" or rename the title of this one?

--- Comment #8 by ianlancetaylor ---
@mitar Please open a new issue to avoid confusion.  Thanks.

--- Comment #9 by mitar ---
I have made https://github.com/golang/go/issues/49918 as a followup to this issue.

--- Comment #10 by rsc ---

No change in consensus, so **[declined](https://golang.org/s/proposal-status#declined)**.
— rsc for the proposal review group

