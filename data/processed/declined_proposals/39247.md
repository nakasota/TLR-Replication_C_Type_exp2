=== Fetching Proposal: Existing alternatives ===
Issue URL: https://github.com/golang/go/issues/39247

==== [Issue Title] ====
proposal: cmd/go: add way to force ignoring vendor directory

==== [Issue Body] ====
<!--
Please answer these questions before submitting your issue. Thanks!
For questions please use one of our forums: https://github.com/golang/go/wiki/Questions
-->

### What version of Go are you using (`go version`)?

<pre>
$ go version
go version go1.14.3 linux/amd64

</pre>

### Does this issue reproduce with the latest release?

Yes

### What operating system and processor architecture are you using (`go env`)?

<details><summary><code>go env</code> Output</summary><br><pre>
$ go env
$ go env
GO111MODULE="on"
GOARCH="amd64"
GOBIN=""
GOCACHE="/home/david/.cache/go-build"
GOENV="/home/david/.config/go/env"
GOEXE=""
GOFLAGS=""
GOHOSTARCH="amd64"
GOHOSTOS="linux"
GOINSECURE=""
GONOPROXY="github.com/DavidGamba"
GONOSUMDB="github.com/DavidGamba"
GOOS="linux"
GOPATH="/home/david/go"
GOPRIVATE="github.com/DavidGamba"
GOPROXY="https://proxy.golang.org,direct"
GOROOT="/home/david/opt/go"
GOSUMDB="sum.golang.org"
GOTMPDIR=""
GOTOOLDIR="/home/david/opt/go/pkg/tool/linux_amd64"
GCCGO="gccgo"
AR="ar"
CC="gcc"
CXX="g++"
CGO_ENABLED="1"
GOMOD="/home/david/my-repo/go.mod"
CGO_CFLAGS="-g -O2"
CGO_CPPFLAGS=""
CGO_CXXFLAGS="-g -O2"
CGO_FFLAGS="-g -O2"
CGO_LDFLAGS="-g -O2"
PKG_CONFIG="pkg-config"
GOGCCFLAGS="-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build183891728=/tmp/go-build -gno-record-gcc-switches"
</pre></details>

### What did you do?

<!--
If possible, provide a recipe for reproducing the error.
A complete runnable program is good.
A link on play.golang.org is best.
-->

1. Create a new monorepo dir:

`mkdir mod-mod && cd mod-mod`
`go mod init github.com/DavidGamba/mod-mod`

2. Create a vendor directory that is a third party vendor dir, not Go code vendor.

`mkdir vendor && touch vendor/hello`

3. Create a main.go file with an external import, and try build it:

```
$ go build
main.go:9:2: cannot find package "." in:
        /home/david/test/mod-mod/vendor/github.com/DavidGamba/go-getoptions
```

```
$ go build -mod=mod
go: finding module for package github.com/DavidGamba/go-getoptions
go: found github.com/DavidGamba/go-getoptions in github.com/DavidGamba/go-getoptions v0.19.0
```

Common workarounds don't work.

```
$ cd vendor
$ go mod init github.com/DavidGamba/mod-mod/vendor
go: creating new go.mod: module github.com/DavidGamba/mod-mod/vendor
$ cd ..
$ go build
go: inconsistent vendoring in /home/david/test/mod-mod:
        github.com/DavidGamba/go-getoptions@v0.19.0: is explicitly required in go.mod, but not marked as explicit in vendor/modules.txt

run 'go mod vendor' to sync, or use -mod=mod or -mod=readonly to ignore the vendor directory
```

### What did you expect to see?

An option to tell go to always run in mod mode so it ignores the vendor directory used by other code in the monorepo. The option should be persisted in the `go.mod` file so there is no need to pass it to the command line every time and so other tools like gopls know about it.

### What did you see instead?

vendor mode is assumed wrongly due to the presence of a `vendor/` directory.

==== [Comments] ====

--- Comment #1 by seankhliao ---
have you considered setting `GOFLAGS="-mod=mod"`?

--- Comment #2 by DavidGamba ---
The problem with `GOFLAGS` is that only applies for my environment and each executable in our project can be built with plain `go build` unless we do a release build were we insert the metadata with `-ldflags` in our build system. 

It is a workaround every developer will be forced to apply which I suppose it is OK but it would be better if the `go.mod` file had that information.

--- Comment #3 by rsc ---
This seems similar to #37724. Like in that issue, the simplest answer is probably to put your Go code in a subdirectory of the repo, adjacent to vendor/ instead of as a parent of it.

--- Comment #4 by DavidGamba ---
@rsc Thanks for taking the time to respond, I appreciate having a clear path forward vs not knowing if this is a workflow that is planned for in the future. 

As you commented in the liked issue:

> There are already two ways to do this: a dummy go.mod or putting
your assets and Go code in sibling subdirectories of the repo root.
Both of those are feasible today, in contrast to adding an ignore directive.

In the case of the vendor dir, the dummy go.mod doesn't work but putting the go.mod in a sibling dir will certainly work. 
Adding `GOFLAGS="-mod=mod"` also works.

I'll close this issue since this one is not reason alone to add ignore directives to the go.mod file.

--- Comment #5 by rsc ---

This proposal has been **[declined as retracted](https://golang.org/s/proposal-status#declined-as-retracted)**.
â€” rsc for the proposal review group

