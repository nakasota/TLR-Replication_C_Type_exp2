=== Fetching Proposal: Lack of knowledge ===
Issue URL: https://github.com/golang/go/issues/39413

==== [Issue Title] ====
proposal: regexp: add Regexp.ProgramSize method similar to C++ RE2::ProgramSize

==== [Issue Body] ====
<!--
Please answer these questions before submitting your issue. Thanks!
For questions please use one of our forums: https://github.com/golang/go/wiki/Questions
-->

### What version of Go are you using (`go version`)?
```
go version go1.14.1 linux/amd64
```

### Does this issue reproduce with the latest release?

Yes, checked https://pkg.go.dev/regexp?tab=doc

### What operating system and processor architecture are you using (`go env`)?


<details><summary><code>go env</code> amd64</summary><br><pre>
$ go env

</pre></details>

### What did you do?

Checked https://pkg.go.dev/regexp?tab=doc for ``ProgramSize()`` function

<!--
If possible, provide a recipe for reproducing the error.
A complete runnable program is good.
A link on play.golang.org is best.
-->



### What did you expect to see?


### What did you see instead?

Have not function of  ``ProgramSize() ``

==== [Comments] ====

--- Comment #1 by ianlancetaylor ---
I see that in re2 there is a method `RE2::ProgramSize`.  I assume that this issue is a request for a similar method for `regexp.Regexp`.  This seems simple enough to implement, though I don't know how meaningful the value is.  Turning this issue into a proposal.

--- Comment #2 by liangyuanpeng ---
@ianlancetaylor  Yes, this is what I want to say, thank you for your modification to the issue.

In my case, i need rough estimate of how complex a compiled regex is to evaluate.  


--- Comment #3 by rsc ---
This seems fine. In general we're not going to add everything RE2 has to package regexp, but understanding the size of the compiled regexp is generally useful.


--- Comment #4 by rsc ---
One potential problem, on a week's reflection, is that today the regexp.Regexp package makes no mention in its API of how the search is implemented. There is always an underlying program today, but in the future maybe certain special cases won't have one. What then? 

I wonder if it makes more sense for callers that need to know regexp program size to use regexp/syntax directly.

The original report does not say _why_ this is useful, just that it was expected in the API.

@liangyuanpeng, what use did you have in mind for the program size?


--- Comment #5 by liangyuanpeng ---
@rsc 

Sorry for my late reply.

Just used of regex match and replace in the proxy from http request . and we need check the Regular expression complexity in application started.

One example is the (Envoy)(https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/regex.proto#envoy-v3-api-msg-type-matcher-v3-regexmatcher) . Envoy use c++ re2 implementation it and we use Golang to do same thing.

If i didn't make it clear, remind me please!


--- Comment #6 by junyer ---
I talked to Envoy folks about this last year. [[1]](https://github.com/envoyproxy/envoy/pull/9171)[[2]](https://github.com/envoyproxy/envoy/issues/9174) I see now that their documentation says "a rough estimate of how complex a compiled regex is to evaluate", which is wrong. The program size is a crude "cost" signal, not a complexity metric. Having it is better than not having it, but one must understand that it's only slightly more informative than the length of the pattern string.

--- Comment #7 by rsc ---
It might make sense to just use regexp/syntax directly to calculate program length. You can do that today, and it avoids adding any specific mention of implementation to package regexp.


--- Comment #8 by rsc ---
Based on the discussion above, especially @junyer's comment, this sounds like a **likely decline**.
(If the functionality is needed in specific cases, use regexp/syntax directly.)


--- Comment #9 by rsc ---
No change in consensus, so declined.


--- Comment #10 by rsc ---
Forgot to close in July, sorry.
