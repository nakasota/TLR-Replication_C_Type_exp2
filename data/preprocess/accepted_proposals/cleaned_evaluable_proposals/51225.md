==== [Issue Title] ====
cmd/compile: require build systems to specify -importcfg

==== [Issue Body] ====
Originally, cmd/compile implemented a lot of logic for resolving import paths, finding installed packages, etc. internally. Nowadays, this is all handled by cmd/go instead, which then invokes cmd/compile with the -importcfg option. However, a lot of historical code and flags still exist within cmd/compile, and it's not obvious which use cases still matter.

The proposal here is to require build systems that want predictable behavior from cmd/compile must use -importcfg. If -importcfg is not used, then cmd/compile's handling of import paths is unspecified and subject to change at the discretion of the compiler team.

In practice, I don't anticipate the fallback logic to change much from today (to avoid breaking test/run.go or compiler dev workflows). But the current code has grown convoluted and has questionable code paths, and it would be easier to cleanup if we could constrain the set of supported options.

==== [Comments] ====

--- Comment #1 by rsc ---
What are the specific changes you are proposing?

I think in practice it is already true that non-importcfg behavior is undefined. So I'm happy to say that.

But I'm not sure what it accomplishes to just say that. It seems like if we want to do this, we need to put teeth behind it, by making the compiler fail without -importcfg. That will break most people working on the compiler running things like â€œgo tool compileâ€ by hand, which seems like a mistake. (We could adjust test/run.go, but the by-hand stuff still worries me a little.)

--- Comment #2 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
â€” rsc for the proposal review group


--- Comment #3 by mdempsky ---
I'd like to drop support for `-D`, `-I`, and `-importmap`. Maybe `-installsuffix` too. I'd have to double check, but I don't believe any of these flags are needed when `-importcfg` is used.

--- Comment #4 by ianlancetaylor ---
Just noting that test/run.go passes `-D` and `-I` to cmd/compile, 

It might be hard to get rid of `-installsuffix` since it's also a option for `go build`.  But perhaps nobody uses it.

--- Comment #5 by mdempsky ---
> Just noting that test/run.go passes -D and -I to cmd/compile,

Ack, but I expect we could reasonably change it to use `-importcfg` instead.

> It might be hard to get rid of -installsuffix since it's also a option for go build.

Similarly, I expect cmd/go can implement that itself on top of `-importcfg` and `-o`, if it doesn't already. (I'd expect the build cache effectively requires cmd/go to do this actually, but maybe not.)

--- Comment #6 by rsc ---
Assuming that Bazel uses -importcfg and not the other flags, this seems fine. But it's not enough to say they're deprecated: we should either do nothing or remove them. Do you want to update all.bash not to depend on them? 

In the absence of real data, we could try leaving the implementations in place for Go 1.19 but add just a few easily reverted lines to fail any compile using the flags and see how the RC goes.


--- Comment #7 by gopherbot ---
Change https://go.dev/cl/415235 mentions this issue: `cmd/compile: remove -importmap flag`

--- Comment #8 by gopherbot ---
Change https://go.dev/cl/415236 mentions this issue: `cmd/{compile,link}: remove -installsuffix flags`

--- Comment #9 by mdempsky ---
Above two CLs trivially remove cmd/compile's -importmap and -installsuffix flags without any all.bash breakage, and I think are pretty minimally invasive. (cmd/link has an -installsuffix flag too, but it seems to actually be needed for something; this is outside the scope of my concerns here though.)

Removing -D and -I will require at a minimum some more invasive changes to various tests. I'm wary of attempting that for Go 1.19, but I think they're doable for Go 1.20.

--- Comment #10 by rsc ---
Those CLs look good. Let's try it for Go 1.19 - they are easily reverted.


--- Comment #11 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
â€” rsc for the proposal review group


--- Comment #12 by gopherbot ---
Change https://go.dev/cl/417534 mentions this issue: `doc: mention removal of cmd/compile's -importmap and -installsuffix flags`

--- Comment #13 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. ðŸŽ‰
