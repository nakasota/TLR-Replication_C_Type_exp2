==== [Issue Title] ====
net/http: support for the 103 status code

==== [Issue Body] ====
Currently, it's not possible to send informational HTTP responses with, for example, the [103 Early Hints](https://httpwg.org/specs/rfc8297.html) or 102 Processing status codes.

Using Early Hints is proposed as a (partial) alternative to Server Push, [which is going to be removed from Chrome](https://groups.google.com/a/chromium.org/g/blink-dev/c/K3rYLvmQUBY/m/21anpFhxAQAJ).

[Chrome 95 added experimental support for the 103 status code ](https://chromium.googlesource.com/chromium/src/+/master/docs/early-hints.md) (currently behind a flag). Support [is being implemented in Firefox](https://bugzilla.mozilla.org/show_bug.cgi?id=1407355). [Fastly and Google](https://chromium.googlesource.com/chromium/src/+/master/docs/early-hints.md) are also running a joint experiment to measure real-life benefits of this new status code.

I propose to change the API of `net/http` to allow calling `ResponseWriter.WriteHeader()` multiple times in order to send informational responses before the final one. In conformance with RFC 8297, if the status code is 103 the current content of the header map will also be sent. Its content will not be removed after the call to `WriteHeader()` because the headers must also be included in the final response.

I also propose adding support for 103 responses to `net/http/httputil`. I suggest introducing a new exported field, `ReverseProxy.Forward103Responses`, to enable this feature (I think that forwarding 103 responses should be opt-in, as it may cause compatibility issues with some legacy software).

I already crafted the patch implementing this proposal for HTTP/1, HTTP/2, and HTTP/3. Patches for HTTP/1  and 2 have been reviewed by @bradfitz. The one for HTTP/3 is already merged in `lucas-clemente/quic-go`.

Related patches:

* HTTP/1: https://github.com/golang/go/pull/42597
* HTTP/2: https://github.com/golang/net/pull/96
* HTTP/3 (in `lucas-clemente/quic-go`): https://github.com/lucas-clemente/quic-go/pull/3047

==== [Comments] ====

--- Comment #1 by ianlancetaylor ---
CC @neild @bradfitz 

--- Comment #2 by rhysh ---
It looks like the changes to implement this in net/http have been merged, so are on track to be part of the Go 1.19 release.

For HTTP/1 in https://github.com/golang/go/commit/770e0e584a98dfd5e8d0d00558085c339fda0ed7
For HTTP/2 in https://github.com/golang/net/commit/95641704303c734b6cb2959d998ce27a6bf81ae0, which per https://github.com/golang/go/commit/b2ae2f5358e87fabd519bc2de20b3ab81d733820 seems to have been re-bundled into net/http.

That leaves the request for support in net/http/httputil. Is that right, @dunglas ?

--- Comment #3 by dunglas ---
Exactly. I already have a working patch for net/http/httputil. I'll open a PR on Monday.

--- Comment #4 by gopherbot ---
Change https://go.dev/cl/409536 mentions this issue: `net/http: reverseproxy: forward 1xx responses`

--- Comment #5 by dunglas ---
@rhysh I'm a bit late but here is the last patch https://github.com/golang/go/pull/53164.

--- Comment #6 by rhysh ---
Hi @dunglas , I'm interested in net/http but I'm not the decider on what goes in. Per https://dev.golang.org/owners, that's @neild .

Apologies if you're familiar with all this already, but I wanted to make sure you know about Go's release cycle (https://github.com/golang/go/wiki/Go-Release-Cycle), which entered the Go 1.19 release freeze around May 16 (https://groups.google.com/g/golang-dev/c/EDstQLuReWE/m/aQC55F0hBAAJ). It's possible that the remaining change(s) would need a freeze exception, which the wiki page describes. The at-golang/release team would be able to clarify how this interacts with the freeze and the proposal process.



--- Comment #7 by rsc ---
Sounds like the net/http changes have already landed, and people are generally in favor of the support for the 103 status code. (Maybe we should have waited, but so be it.)

As far as reverseproxy, that code can be forked if necessary (unlike net/http), so we should probably wait on that one.

Going to mark this "likely accept" and have it cover just the net/http changes, so it can appear in the minutes in case anyone objects to 103 support in Go 1.19.


--- Comment #8 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
â€” rsc for the proposal review group


--- Comment #9 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. ðŸŽ‰
