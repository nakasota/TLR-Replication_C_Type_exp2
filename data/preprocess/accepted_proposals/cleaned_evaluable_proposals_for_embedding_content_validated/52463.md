go/ast: formal deprec object
packag declar syntax tree type pars go code, produc them.
however, note also rather rudimentari form typechecking, attempt keep track object scopes. however, realli work practice, `go/ast` `go/parser` implement proper go typechecker; that'
find unfortun term confus users, especi new go tool static analysi awar histor gotcha. example, help someon slack find object sometim resolv correctly, reason use `ast.object` rather `types.object`. see code context.
context, ad mode bit `go/parser` skip object resolut bring signific speedup basic cost mani programs, sinc made use partial object resolution.
can't outright remov type field like `ast.object` backward compat concerns, could certainli warn user use `ast.object`. instance:
```
package ast
// [...]
//
// Deprecated: go/ast does not implement a full Go type checker; use go/types.Object instead.
type Object [...]
// [...]
//
// Deprecated: go/ast does not implement a full Go type checker; use go/types.Scope instead.
type Scope [...]
```
true that, potentially, use partial object resolut `go/ast` fine use cases. perhap deal simpl go code run limit `go/types`. think fine (hope rare) case conscious ignor deprec notice.
cc @findleyr @griesem @josharian @dominikh
one potenti question exist user `ast.object`. example, `cmd/gofmt` use rewrit featur (which arguabl deprec right, rather limit develop mani years) simplifi feature, use simplifi `s[:len(s)]` `s[:]`. think necessarili rush replac bit code.
two other exampl exist user includ `x/tools/go/{ssa,cfg}`. use *ast.object build control flow internally.
switch ast.object types.object fork go/ssa trivial change. can't speak go/cfg, reckon roughli same.
chang mention issue: `cmd/gofmt: use skipobjectresolut -s well`
cl remov lone use `gofmt -s`, arguabl unnecessari begin with. rather, prevent simpl form fals positives, assumpt fals posit anyway.
took look `go/cfg`. depend `go/types` yet. would need `types.info` solut apply. obviou fix pass `*types.info` break change.
chang mention issue: `ssa: switch lblock types.object`
chang mention issue: `nilness: add unit test gener instantiation.`
chang mention issue: `ssautil: add unit test set ssa.instantiategenerics`
came #50956 well. status-quo, user like confus whether use ast.object, even confus encount limit ast.object. said, current sever valid use syntact object resolution, cmd/godoc, probabl ever updat use go/types. cours ok even deprec api.
hesit use `skipobjectresolution` parser mode widely, wari creat world differ color syntax trees. deprec ast.object would step toward skip object resolut contexts. howev think consid first provid api syntact object resolut without reli ast.ident.obj. would allow exist valid usag ast.object migrat api without machineri go/types.
example, someth equival follow would trivial implement base current factor go/parser, though api requir seriou thought.
```go
// ResolveFiles syntactically resolves identifiers in the package defined by files, recording their referenced declarations
// in the given decls map, if non-nil. The resulting error will wrap a scanner.ErrorList reporting errors encountered
// during resolution.
func ResolveFiles(files []*ast.File, decls map[*ast.Ident]ast.Node) error
```
cc @adonovan, think problem recently.
chang mention issue: `pointer: add unit test pointer type parameters.`
pleas ignor messag ssautil, nil cl/402276. attach wrong github issue.
@findleyr plan action sound good me.
> hesit use `skipobjectresolution` parser mode widely, wari creat world differ color syntax trees.
that' valid concern, think issu general-purpos api like `go/packages`, know `go/ast` use for. chang make much limited, `cmd/gofmt` `go/format`, know certain ast object unus chang time.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
discuss today extern tool call. seem consensu `ast.object` deprecated, think would reason proceed propos even yet replac api syntact object resolution. cours preserv backward compatibility, peopl continu use `ast.object` even deprecated, deprec make current situat less confus new users.
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
