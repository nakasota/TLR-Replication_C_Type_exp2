runtime: use minidumpwritedump gotraceback=crash window
cl 307372 committed, contain nice chang produc crashdump certain circumstances. however, sever question propos crashdump would automat upload microsoft context use insid builds. absenc good answer that, otherwis okay cl revert (bi me) cl 362454. propos essenti revert revert, extend discuss circumst enabl whether need new flag it, suggest @bufflig.
propos move "under consideration" step, get clearer idea proposing. defer @zhizheng052 @bhiggin this, wrote origin cl.
cc @zhizheng052 @bhiggin @bufflig @ianlancetaylor @alexbrainman @aarzilli @aclement
cl discussion, question "optional" diagnost get enabled. instal fresh window 11 board minut ago notic check default:
!imag
seem opt send crash dump microsoft instal (bi opt out) opt creat crash dump set gotraceback=crash, crash dump upload microsoft expect behavior. given happen insid builds, even *that* sketchi option preselected.
sinc alreadi gate two option think ad third opt-in (through new flag) go make difference. imo either:
* add courtesi remind window document gotraceback (and mayb releas notes),
* implement gotraceback=crash window document reason.
> given happen insid builds, even sketchi option preselected.
insid build; instal window 11 final release.
> > given happen insid builds, even sketchi option preselected.
>
> insid build; instal window 11 final release.
sucks. still, think chang rest opinion.
assum there' someth registri enabl "send ms" behavior. wonder could detect either:
a) enabl wer
b) enabl wer warn user
c) simpli refus run combin (gotraceback=crash upload enabled)?
enabl gotraceback=crash even actual want file disk unreason functionality, chang (it give addit crash information). get ad behavior upload crashdump third parti seem expect cases. least stern warn seem mandated, actual prefer disable/revert chang 1.18 decid exactli want proceed.
> actual prefer disable/revert chang 1.18 decid exactli want proceed.
alreadi happened, fyi.
there' also wer option pop ui ask consent. suspect work services, though.
also, wonder could ditch whole wer set option creat minidump ourselves?
clarify: _only_ `gotraceback=crash` set, right?
propos ad activ column propos project
review weekli propos review meetings.
— rsc propos review group
top post:
> propos move "under consideration" step, get clearer idea proposing.
record, still quit know propos here.
least propos discuss get eye it.
options? possibl write crash dump get collect sent off?
sound like still wait find exactli propos here.
anyon know?
still wait find exactli propos here.
can't figur out, seem like would like decline.
> clarify: _only_ `gotraceback=crash` set, right?
correct.
> sound like still wait find exactli propos here.
> anyon know?
review cl 307372. chang make go runtim creat process crash dump use delv debug crashes.
featur enabl set `gotraceback=crash` environ variable.
also thing need enabl feature. instruct

> can't figur out, seem like would like decline.
hope explan good enough reconsider.
plane use featur today. see life save other noth crash program. crash dump good enough.
also crash dump standard windows. vendor use exactli purpose. see go implement featur avail tool developers.
alex
also want add comment featur request nearli 5 year ago #20498. brad label `needsfix` ian `help wanted`, assum ok implement feature.
differ peopl tri implement feature. implement requir quit bit effort manual testing.
made put extra effort cl 307372 (most recent attempt) discov delv actual use dump file gener change. make featur quit use people.
understand concern jason rais crash dump sent microsoft. use gotraceback environ variabl set

stop that.
featur window does. want crash dumps, accept whatev polici microsoft enforc onto feature. make clear doc happen user set `gotraceback=crash`.
alex
hi @alexbrainman, thank information. sound like useful, import featur users.
tri read confus implic send data microsoft.
say "thi featur enabl default."
mean edit registri set make gotraceback=crash work?
mean ms collect crash default?
not, exactli registri set chang stop upload gotraceback=crash-gener file ms?
thanks.
> say "thi featur enabl default."
> mean edit registri set make gotraceback=crash work?
gotraceback=crash still output appropri stack trace. gotraceback=crash creat crash dump file edit registry. read microsoft doco. see pc.
> mean ms collect crash default?
believ so. take word it. read

talk window os crash - see `wer send report microsoft (watson server) user consented.` bit. talk program crash dumps. would wast microsoft collect program dumps.
> exactli registri set chang stop upload gotraceback=crash-gener file ms?
look friend' pc (with registri untouch hacker like me), `hkey_local_machine\software\microsoft\windows\window error reporting` key, `localdumps` key inside. see details.
registri config creat crash dump regardless gotraceback=crash setting.
window pc, check registri yourself. use regedit program, gui access pc (direct consol remot desktop).
altern write go program list registri key. start `internal/syscall/windows/registry.testreadsubkeynames` adjust coupl lines, abl run test go builder see regstri set are. care.
alex
@zx2c4 's suggest creat minidump consid also privaci focus alternative.
sound like make change, develop edit registri see chang all.
develop edit registri get exactli edit imply. sound ok too.
sound like this?
anyon object accept proposal?
> @zx2c4 's suggest creat minidump consid also privaci focus alternative.
know mean "minidump". test cl 307372 `dumptype` registri valu set 2. also tri dump creat `dumptype` registri valu 1, recognis delve.
see cl 307372 commit messag explain `dumptype` valu tried. like explain here.
alex
@alexbrainman @beoran seem confus brew around term "minidump" stem microsoft decis use "minidump" "mini dump" mean two differ things:
* **minidump** file format use window userspac core dumps, roughli equival et_cor elf files. term use contrast crashdump, format oper system core dumps. content minidump determin minidump_typ enumer
* **mini dump** minidump minidump_typ set minidumpnormal. contrast "full dump" includ full memori process.
@zx2c4 suggest call minidumpwritedump dbghelp.dll directly, instead let wer it. either way minidump produc either way result mini dump full dump.
afaik mini dump recogn delv noth use (becaus goroutin implemented), might seem aren't.
> sound like make change, develop edit registri see chang all.
> develop edit registri get exactli edit imply. sound ok too.
> sound like this?
>
> anyon object accept proposal?
>
learn point window beta user (call "insiders") get registri key turn on?
> @zx2c4 suggest call minidumpwritedump dbghelp.dll directly, instead let wer it. either way minidump produc either way result mini dump full dump.
inde still seem like best solution.
> inde still seem like best solution.
theori make difference, microsoft want upload core dump hook minidumpwritedump like hook wer. consent ask broad.
practic know difference, anyon check wer actual upload anyth default minidumpwritedump doesn't?
wer mean hand state crash app wer api say "do someth it." app developer, actual regist receiv dump microsoft partner portal. minidumpwritedump, third param file handle, mean control. mean sure, microsoft could shim intercept everything; could behind scene without api call. seem bit much tinfoil right? that'd big deal that, wherea wer kind alreadi mark part microsoft' "crash blackbox" apparatus.
@aarzilli thank tutori "minidumps" vs "mini dumps". said "mini dumps" recogn delv basic useless memori contents. "minidumps" gener minidumpwritedump? work delve?
***if*** wer api minidumpwritedump write file work delve,
***if*** uncertainti wer api upload ms uncertainti minidumpwritedump,
***then*** seem like choic clear: use minidumpwritedump.
statement true?
> "minidumps" gener minidumpwritedump? work delve?
far tell procdump.ex use minidumpwritedump write minidump delv work those.
ok, well minidumpwritedump work delve, previou complex condit reduc "the choic clear: use minidumpwritedump".
anyon object use minidumpwritedump instead wer api?
retitl believ converg on. objections?
seem okay me.
base discuss above, propos seem like **like accept**.
— rsc propos review group
