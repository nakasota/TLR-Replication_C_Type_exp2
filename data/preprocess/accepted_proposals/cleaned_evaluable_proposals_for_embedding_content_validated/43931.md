all: merg dev.typeparam master go 1.17
##
propos #43651 add gener go language. propos current 1223 like 89 dislikes. demand gener top request featur 2016, 2017, 2018, 2019 go develop survey results. there' work go2go playground tri proposal. type paramet propos subject keynot talk gophercon 2020. wide demand featur go community; nich featur like persist memori field tracking.
propos allow prototyp compil develop featur happen master branch. new languag function would kept behind compil flag **both** (1) #43651 accept (2) function readi end users.
course, #43651 accept proposal, one becom moot. alternatively, #43651 reject one accepted, implement support code back master.
## rational
alreadi begun develop #43651 dev.typeparam branch, keep sync master dev.regabi tedious. within last 2 month development, 20+ merg branches. fail merg requir reset develop branch (#43147). compil engin attempt give merges, conflict difficult resolv without familiarity/time.
tedium like decreas somewhat go 1.16 releas dev.regabi merg back master, also chang happen elsewher repo keep (e.g., #42637 caus lot trybot flake dev.regabi dev.typeparams). also, support gener continu requir pervas chang involv touch backend. also accept go languag chang slate go 1.17 (e.g., #395, #19367, #38248, #40481) overlap frontend areas.
would eas cmd/compil develop *significantly* compil function dev.typeparam could merg master develop behind featur flag. featur flag develop binari export (ae2f54a7718e803fe00ee0e5b83e6c07036ba93f), ssa (c0740fed377109526e61955af612efba8ec3f3dc), packag syntax' new parser (2ff463948c92e71651a31c621826281035a7071a), index export (ca2f85fd3f32b2a4c863a2de602876bd31e9d956), new escap analysi (97c4ad432743d74ee59648dee0db1b107c701834), etc. (i'm sure others; one person familiar with.)
additionally, dev.typeparam introduc new go/types-bas typecheck "types2". even reject #43651, think want adopt new typecheck replac compiler' legaci typecheck ("typecheck"). gener support types2 alreadi condit behind flag, remov gener support #43651 reject would differ remov old code featur replaced.
## flag
spell compil flag, dev.typeparam current use `-g`, spell would fine. particular valu assign though somewhat arbitrary, driven develop need longer apply, revisited. suggest `-g=0` mean use typecheck; `-g=1` mean use types2 w/o gener support; `-g=2` mean use types2 w/ gener support. (i'm hope `-g=1` default go 1.17; drop support `-g=0` go 1.18, make easier enabl `-g=2` default. however, **not** propos either default chang time.)
brought user might use thing could break. current provid user compil flag like `-b` (disabl bound checking), `-wb=false` (disabl write barriers), `-d=disablenil` (disabl nil checking), user ampl opportun self-harm today already.
moreover, think want user tri featur fulli ready. help user report regress dev.regabi (#43479, #43480, #43701, #43818), end releas cycl alway beg user tri beta releas candidates.
realli desired, could put behind `goexperiment=typeparams` featur like field track static lock ranking, never went propos process. ask consider #42681.
> wide demand featur go community; nich featur like persist memori field tracking.
clarify, intend derid #43810. persist memori brought counter-point googl compiler/runtim team meeting, understood time hypothet proposal. vagu rememb topic go languag support persist memori discuss past email, awar yet advanc proposal.
present familiar enough persist memori know whether #43810 good idea, mean impli either way here. think current thumb up/down ratio demonstr differ level broad commun support #43651, point argu think justifi interest broad go commun allow develop #43651 continu master behind featur flag, probabl extend offer #43810.
think land code master propos accepted. goe spirit propos process rule ask other follow propos changes. think right way view propos simpli start work master #43651 accepted, chang previou plan stay dev.typeparam go 1.18.
bigger concern properli firewal gener work go 1.17 work chang made help set gener caus undu instabl go 1.17 release.
mani code chang contempl (for exampl back ends) would _not_ gate flag?
> goe spirit propos process...
english first language, line sound circular me.
propos spirit propos process, proposal.
> propos spirit propos process, proposal.
think russ taken slightli context there. understood comment say: histor merg code propos accepted, make except here. might set bad precedent, someth understand.
said, think propos *is* special, given much refactor improv compil typechecker. assum want merg future, even gener end rejected. understand matthew' point larg amount extra tediou work involved, could avoided.
land code master implement propos accept odd propos process exist for. implic _filing_ propos goe that. perhap see confus arose, pleas consid clarifi point, attend @rscâ€™ respons written.
> propos spirit propos process, proposal.
that' saying. say point propos _process_ standard way get new featur language. proposal, case #43651, given special treatment allow circumv part process, unfair propos set bad preced later one peopl want know popular still unaccept propos can't get treatment, too.
propos scope gener work. think itâ€™ ok make exceptions, peopl need understand except made itâ€™ easi explain.
> proposal,..., given special treatment allow circumv ...
propos scope.
proposals, design document required. others, design document required.
propos come proto-typ implementation(go-modul example).
think import explan given certain propos requir exempt rules. obtain exemption, do? write proposal. mdempski done.
others, figur reason given enough warrant exemption.
knowledg #43651 still even specif propos chang _to languag spec_ (see seem like necessari step seriou propos chang language. perhap step wait detail inform implement work.
#43651 sketch design requir lot refactor implement work. refactor work seem outsid scope propos process first place (sinc user-fac effect toolchain). top that, user-fac implement work seem like fine applic `goexperiment`, could use provid test coverage.
would much rather accept implement work `goexperiment` prematur accept languag chang (without actual text languag change!) order unblock implement work. pass bill find what' it.
> bigger concern properli firewal gener work go 1.17 work chang made help set gener caus undu instabl go 1.17 release.
de facto primari build-cop project past coupl years, honestli concern bake regress branch.
alreadi opinion sever problem regress introduc tree dismiss â€œflakesâ€, accept like bug triag promptli occur low frequency. regress introduc separ branch, even easier (intent accidentally) buri regress happen manifest intermitt failures.
would rather deal regress main branch introduced, rather accumul backlog regress branch spend month deal unstabl tree branch merg back in.
realli can't comment â€œspirit propos processâ€ line, goal propos process make sure chang well designed? featur often get design one way origin design improv process implement discov inconsist omissions. `go111module` experi one example. precis data, someth tell go modul also featur touch lot code, develop (and improved) main branch six releases.
regard possibl instabl go 1.17. type paramet possibl anticip featur sinc go publicli released. think reason assum mani peopl build go main branch type paramet work merged. want tri new features, play them, report bugs. bug show flaw design. especi call help community, exampl go blog.
would possibl accept #43651 principl without requir propos finalis last detail?
istm basic outlin propos solid, there' consider room movement around remain semant detail still keep overal model intact. #43651 accept principle, propos could introduc nail specif semant awkward parts, istm unlik invalid preparatori work current undertaken dev.typeparam branch.
would allow work start master branch even detail finalised.
> would possibl accept #43651 principl without requir propos finalis last detail?
maybe? that' tension russ' comment:
> goe spirit propos process rule ask other follow propos changes.
â€œ[t]he rule ask other follow propos changesâ€ are, part, answer question go 2 languag chang template, including:
> * pleas describ precis possibl chang language.
> * would chang languag spec?
> * pleas also describ chang informally, class teach go.
> â€¦
> * would languag spec change?
> * orthogonality: chang interact overlap exist features?
believ current design document satisfi first five points. opinion, â€œa class teach goâ€ would need includ answer basic question like â€œwhat type?â€ â€œwhat interface?â€, cover exist spec notabl miss current propos â€” despit concern rais last summer re-rais concepts.
gotten bit heated, even though cool down, go lock next week.
last week wrote:
> think right way view propos simpli start work master #43651 accepted, chang previou plan stay dev.typeparam go 1.18.
continu view propos "merg dev.typeparam master go 1.17 dev cycle", seem like reason thing do. also asked:
> bigger concern properli firewal gener work go 1.17 work chang made help set gener caus undu instabl go 1.17 release.
>
> mani code chang contempl (for exampl back ends) would gate flag?
make sure care keep riski chang gate flag.
also probabl disabl flag go 1.17 releas itself, end ecosystem packag built `-gcflags=all=-generics`.
precaut take make sure merg code master caus undu risk go 1.17?
add one compel reason _for_ make chang creat backpressur non-gener work make sure work compat what' go dev.typeparams. without merg master, merg _from_ master end creat work team work generics, feedback master-branch work chang made incompatibly.
eager anyon #43651 accepted, howev agre @rsc @bcmill follow procedur languag changes. know made fail propos >;-> question then: speed accept #43651? could go team shift people, perhap ask googl will hire help? we, outsid go team, contribut somehow, perhap inform descript feature?
#43651 accepted, propos could also accept speed implement then, hidden behind flag goexperiment, whichev effect convenient.
> mani code chang contempl (for exampl back ends) would gate flag?
see code chang fall three camps:
1. generics-specif code eventu replac exist code paths, gate behind flag. example, new parser/typechecker/nod code dev.typeparams.
2. generics-specif code pure additive. example, expect addit ir type necessari repres gener functions, repres dictionaries, etc. harder gate behind flag, expect would lie unus gener enabled. necessary, add runtim assert make sure use gener enabled.
3. gener code refactor facilit changes. stuff like packag ir refactor land dev.regabi (but unlik anyth scale).
think camp 1 chang larg done alreadi dev.typeparams; think alreadi run option far possible. think remain work split camp 2 3. current solid predict ratio might be, expect signific work still fall camp diffus lot part compiler.
example, think want dwarf support gener code/types. probabl requir refactor current dwarf code (camp 3), ad support gener new dwarf die (camp 2). refactor code continu benefit exist test develop practic (e.g., test cl `toolstash -cmp`), new code new test also natur use go 1.17 gener disabl anyway.
gener expect chang camp 2 closer frontend (e.g., transform gener code ir), camp 3 closer backend (e.g., plumb gener metadata need debugging/runtime).
> make sure care keep riski chang gate flag.
ack.
> also probabl disabl flag go 1.17 releas itself, end ecosystem packag built `-gcflags=all=-generics`.
think disabl gener support go 1.17 releas build would fine.
broadly, think would nice better delin compil flags/extens stabl support direct use end users, unstabl flag use compil develop and/or standard library. that' separ issue.
> precaut take make sure merg code master caus undu risk go 1.17?
think best precaut merg earli possibl / reasonable. master branch tested/us develop branch. earlier dev.typeparam merged, time+test make sure chang neg impact non-gener code paths.
> without merg master, merg master end creat work team work generics, feedback master-branch work chang made incompatibly.
also, merg alreadi difficult enough creat review, there' good workflow break tricki merg conflict smaller cl like would normal development, except merg frequently. merg nothing.
review merg conflict also error-pron / tedious: gerrit present specif conflict resolved. provid easi way see chang full, origin contexts, review go way track inform needed.
finally, mistak introduc bad merg conflict resolut harder diagnos later. e.g., `git bisect` identifi merg problemat cl, human develop still need spend time figur whether merg conflict sourc trouble, function develop separ branch simpli interoperate.
overall, think merg dev.typeparam master go 1.17 develop master increas risk somewhat simpl natur chang -> opportun mistakes. think risk alreadi offset increas test exposur work master also addit engin time freed worri merges. think also *significantly* reduc risk enabl gener go 1.18 (assum #43651 accepted).
master 'hijack' take place like pipelin improv relev branch experiment... could see effect exist codebas one go2 pre-releas 'test suite'.
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
