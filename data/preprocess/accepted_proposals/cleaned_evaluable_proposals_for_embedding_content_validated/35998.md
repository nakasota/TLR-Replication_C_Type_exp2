testing: add tb.tempdir() string
pretti usual test make temp files.
pretti usual test leak temp files. (#23619 track detect go' tests, keep come up)
thing properli also get kinda boilerplatey.
propos ad method testing.tb, *testing.t, *testing.b someth like this:
```go
// TempDir returns a temporary directory for the test to use.
// It is lazily created on first access, and calls t.Fatal if the directory
// creation fails.
// Subsequent calls to t.TempDir return the same directory.
// The directory is automatically cleaned up when the test exits.
func (t *T) TempDir() string {
	t.tempDirOnce.Do(func() {
		t.tempDir, t.tempDirErr = ioutil.TempDir("", t.Name())
		if t.tempDirErr == nil {
			t.Cleanup(func() {
				if err := os.RemoveAll(t.tempDir); err != nil {
					t.Errorf("TempDir RemoveAll cleanup: %v", err)
				}
			})
		}
	})
	if t.tempDirErr != nil {
		t.Fatalf("TempDir: %v", err)
	}
	return t.tempDir
}
```
possibl artifact temporari directori would use event test failure? case, directori removed. expect t.error call contain necessari inform debug failure?
yeah, artifact could use debugging. explicit os.removeall, comment debugging. new function guess dig test packag comment line, complicated. mayb add new helper keep artifact use debugging? t.keep()? t.nocleanup?
@cherrymui, need. write:
```go
   defer func() { if t.Failed() { os.Exit(1) } }
```
sinc know alreadi failing:
```go
    defer log.Fatalf("check out the failing files in %v", t.TempDir())
```
... cleanup happen due `os.exit(1)` (which `log.fatalf` also does).
flag prevent tempdir deletion, someth like `-test.keeptmp`? think that'd simpler manual insert defer (for uses), within propos test framework alreadi charg manag directory' lifetime.
@bradfitz good know. thanks!
@zikaeroh, flag/knob fatigue. much crap overwhelming. especi stuff that' rare needed. "it might use sometimes" bar add stuff. also consid fatigu cost doc `-help` spew.
sinc iâ€™m see mentioned, consid verbos explicit api variat return cleanup closure?
somewhat inspir `context.withcancel`, may look like:
```Go
func (*T) TempDir() (dir string, cleanup func())
```
would make idiomat first usag requir two extra lines:
```Go
func Test(t *testing.T) {
	// ...
	tempDir, cleanup := t.TempDir()
	defer cleanup()
	// ... use tempDir
}
```
advantag would itâ€™ easier temporarili modifi clean up, readabl thereâ€™ leak first-tim readers, possibl detect cleanup isnâ€™t called, cost addit verbosity. mayb two line isnâ€™t bad compar 4+ requir now.
throw consideration, iâ€™m convinc would better.
@dmitshur, want write verbos code, alreadi today? ðŸ¤·â€â™‚ï¸
also, tempdir() return two things, suddenli need variabl store use `filepath.join()`. that' anoth line.
> that' anoth line.
think itâ€™ constant 2 extra lines, donâ€™t see third extra line would required.
```Go
foo(filepath.Join(t.TempDir(), "foo"))
bar(filepath.Join(t.TempDir(), "bar"))
```
vs
```Go
tempDir, cleanup := t.TempDir()
defer cleanup()
foo(filepath.Join(tempDir, "foo"))
bar(filepath.Join(tempDir, "bar"))
```
okay, constant two, compar constant zero. much prefer `foo(filepath.join(t.tempdir(), "foo"))` style variables.
wrote tempdir helper use lot test work. trick use (which took @tv42) detect whether test run `go test` and, is, locat tempdir insid go tool' temp directory. (in case defer `td.remove()` nothing.) want inspect tempdir, use `-work` print directori delet it.
@cespare, @tv42, cute! (mayb littl fragil thu gross, though?)
would love possibl without hack like that!
t.cleanup, seem like nice api. favor tri this. anyon els thoughts?
person written similar helper three time three separ modules, agre would useful. also cc @rogpepp @myitcv particip cleanup proposal.
using:
```
dirname := t.TempDir("a", "b")
filename := t.TempFile("a", "b", "c.txt")
// internally these would do `filepath.Join` and `os.MkdirAll`
```
sinc quit common want filenam subdirectory, rather "root directory".
manual version also work well one directori end read-only. (in case, obviou `removeall` call succeed remov temp directory.)
could address `removeall` (see also #26295, #29983), wit fact clean temporari directori entir trivial.
general, think use function probabl worth ad standard library.
use similar thing quit year (name `mkdir` rather `tempdir`), say never issu remov read-onli directories. think would probabl fine test fail directori can't removed.
fwiw, two similar helper found enduringli use time setenv patch, case might consid ad too.
@rogpepp helper compat t.parallel().
@rsc pleas make sure tempdir method well defin behaviour t.parallel() subtest end propos process.
part `testing.tb` interface? current api `testing` packag feel general, use-cas specif helper move sub-packages, e.g `iotest`, `httptest`.
better move separ package, specif test fs-relat cases?
seem like temporari directori come larg enough varieti test part `testing` proper.
note `iotest` `httptest` test `io` `http` (and relat implementations); make sens put i/o helper `iotest`.
`setenv` `patch` seem less gener necessary, implement easili use `cleanup`. (so `tempdir` seem wide applicable.)
directori name test binari name test function name.
(the exampl use test function name.)
base discuss above, sound like **like accept**.
chang consensus, accepted.
chang mention issue: `testing: add tb.tempdir`
chang mention issue: `doc: document testing.tb.tempdir releas notes`
what' guidelin make sure packag `testing` respect go 1 compat promise? ad method like `cleanup` `tempdir` interfac `testing.tb` break custom implementations.
test code explicitli exclud document, unclear "it may necessari add method types" case, seem concern struct embedding.
@deleplac note doc alreadi say ` tb interfac common b`, implement explicitli forbid type ever implement tb:

```
	// A private method to prevent users implementing the
	// interface and so future additions to it will not
	// violate Go 1 compatibility.
	private()
```
someon want use subset interfac that' also implement types, declar interfac method interest in. backward compat appli there, ever add method tb, modifi remov exist ones.
thank daniel, that' exactli info look for! inde awar `tb.private`.
