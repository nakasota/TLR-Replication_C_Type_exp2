go/parser: add skipobjectresolut mode flag
#45104, `go/parser` refactor make pars object resolut separ pass within `parsefile`. side effect chang trivial add mode skip object resolut entirely. issu propos ad mode flag: `skipobjectresolution`. (note mode initi ad part #45104, go backed-out pend discuss here).
### background
object resolut featur `go/parser` attempt resolv identifi declaration, set `ast.ident.obj`, use tool basic analyz need information. notabl inform incomplet case inaccurate: object resolut properli handl selector field composit literals, often lack inform declar file packages. also redund inform produc `go/types`. reason object resolut limit utility, particularli tool either deal syntax, use output `go/types` identifi inform (`go/types` need object resolut order function).
### pro con
testing, skip object resolut save 18-20% pars time, made `gofmt` around 10% faster (when rewrit simplifying, make use object resolution). also avoid unnecessari allocation. small meaning optim tool know need `ast.ident.obj`. see #45104 discussion.
completeness, worth consid downsid ad mode. one, add new mode must supported. however, think neglig cost: unlik futur revert refactor #45104, even so, skip object resolut still achiev ad guard function record resolv identifiers. also worth note mode entir orthogon exist modes: `reportdeclarationerrors` work object resolut skipped.
think _strongest_ argument ad new mode simpli necessary. however, current expect would add small benefit user rel smaller cost.
cc @griesem @mvdan
chang mention issue: `go/parser: un-export skipobjectresolut mode pend discussion`
object resolut mode use tool run result ast type checker care unadorn syntax tree, e.g. formatting. featur present histor reason (the `go/parser` one first larger go/packag ever written still use).
fact object resolut save 20% pars time significant. arguably, object resolut default would non-backward compat chang behavior. note also mode implement oper well go1.17 freeze.
short, suggest new skipobjectresolut mode provid easi way increas perform mani tool simpli set flag.
see good reason this.
fulli agre robert said. see reason chang must 1.17, code api while, like miss freez deadline. also see reason push back 1.18.
follow propos process properly, perhap meant potenti object raised. see anyon bring next week two, though person doubt :)
also benefit `go list -test`, fulli pars test file extract test functions.
`go list -test -json std`, go 0.61 0.53s.
speedup would automat trickl user `go/packages`, without chang code way.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
