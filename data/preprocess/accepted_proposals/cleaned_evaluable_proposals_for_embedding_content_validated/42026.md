os: add readdir, readfile, writefile, createtemp, mkdirtemp & deprec io/ioutil
io/ioutil, like thing util name, turn poorli defin hard understand collect things.
part #40025, migrat discard, nopcloser, readal packag io.
(they remain io/ioutil compatibility, course, new code prefer one io.)
what' left os file system helpers: readdir, readfile, tempdir, tempfile, writefile.
propos migrat packag os, adjustments.
(again, would remain compatibility, new code would prefer one os.)
point, io/ioutil would becom entir deprecated.
signatur would be:
packag os
// readdir read name directory,
// return directori entri sort filename.
func readdir(nam string) ([]direntry, error)
// readfil read name file return contents.
// success call return err == nil, err == eof.
// readfil read whole file, treat eof read
// error reported.
func readfile(nam string) ([]byte, error)
// writefil write data name file, creat necessary.
// file exist, writefil creat permiss perm (befor umask);
// otherwis writefil truncat writing, without chang permissions.
func writefile(nam string, data []byte, perm fs.filemode) error
// mkdirtemp creat new temporari directori directori dir
// return pathnam new directory.
// new directory' name gener ad random string end pattern.
// pattern includ "*", random string replac last "*" instead.
// dir empti string, tempfil use default directori temporari files, return tempdir.
// multipl program goroutin call mkdirtemp simultan choos directory.
// caller' respons remov directori longer needed.
func mkdirtemp(dir, pattern string) (string, error)
// createtemp creat new temporari file directori dir,
// open file read writing, return result file.
// filenam gener take pattern ad random string end.
// pattern includ "*", random string replac last "*".
// dir empti string, tempfil use default directori temporari files, return tempdir.
// multipl program goroutin call createtemp simultan choos file.
// caller use file' name method find pathnam file.
// caller' respons remov file longer needed.
func createtemp(dir, pattern string) (*file, error)
notes:
- os.readdir return []direntry, contrast ioutil.readdir' []fileinfo.
(provid helper return []direntri one primari motiv change.)
- os.readfil ident ioutil.readfile.
- os.writefil ident ioutil.writefile.
look whether permiss bit dropped, go code wild use varieti popular set (for example: 0666, 0644, 0600, 0700, 0777).
- os.mkdirtemp ident ioutil.tempdir.
cannot name os.tempdir alreadi exist return default temporari directory.
mkdirtemp seem like make clear directori creat appear next mkdir docs.
look whether directori argument dropped, 20% call wild use empti string.
- os.createtemp ident ioutil.tempfile.
could name os.tempfile, call os.createtemp consist os.mkdirtemp, make clear file creat (use tempfil would function surprisingli differ tempdir), appear next creat docs.
look whether directori argument dropped, 25% call wild use empti string.
would make sens put `readdir`, `readfile`, `writefile` `io/fs` instead `os`?
see like could plausibl work filesystem, `os` one.
would argu fit natur new `walk` api, wherev end up: `readdir`, `readfile`, `writefile`, `walk` share properti implement high-level oper term exist lower-level operations.
(`mkdirtemp` `createtemp` seem like belong `os`, though: locat temporari directori os-specific, `createtemp`, least, return `*os.file` rather abstract `fs.file`.)
actually, even `mkdirtemp` `createtemp` could belong `io/fs`, defin `fs` extens interfac method return default directori temporari files.
@bcmills, io/f alreadi readdir readfile. would fine add createtemp mkdirtemp if/when io/f add write operations.
probabl make sens put _only_ io/fs. read oper system' file system insan common. example, even start would certainli keep os.open(name) rather tell peopl use fs.open(os.dir("/"), name) os.dir("/").open(name) (neither would correct window anyway).
accept issu obsolet #19660, propos renam ioutil.
chang mention issue: `all: updat use os.readfile, os.writefile, os.createtemp, os.mkdirtemp`
chang mention issue: `os: add readfile, writefile, createtemp (wa tempfile), mkdirtemp (wa tempdir) io/ioutil`
chang mention issue: `all: updat use os.readdir appropriate`
post cl would implement chang case anyon want see diff look like.
particularli happi two cl convert tree use new locations, 217 "io/ioutil" import remov 51 "os" import added, mean ~75% case code alreadi import "os" simplifi juggl ioutil well.
base discussion, seem like **like accept**.
get rid ioutil good conceptu clean up. know first learn go, confus io vs. ioutil vs. bufio. io littl tricki understand, cleanup, explan pretti clear. imagin write blog post beginn along line of:
> packag io defin differ kind "virtual files" either read write special featur like seek closing. io/f extend virtual file virtual filesystem. case, work io.read io.writ directly, either stream packag bufio write memori bytes.buff strings.builder.
thing seem odd given descript fileinfo filemod io/f instead io itself. one hand, part "virtual file" think io. otoh, make sens part "virtual filesystem" case io/fsâ€¦
instead "virtual files" say "virtual data streams" set!
chang consensus, accepted.
chang mention issue: `os: remov depend string package`
"go fix" support migrat old use new ones?
@go101, would fall natur #32816.
chang mention issue: `io/ioutil: flag packag function deprec marker`
chang mention issue: `os: correct name mkdirtemp doc comment`
chang mention issue: `doc/go1.16: mention deprec io/ioutil`
chang mention issue: `io/ioutil: forward tempfil tempdir os package`
chang mention issue: `cmd/go: revert testscript/build_trimpath use ioutil.readfile`
por favor alguien que sepa espanol expliqu esto
[oslay@oslay-garuda ~]$ sudo go get layeh.com/asar
go get: modul layeh.com/asar: get " read tcp 192.168.1.176:40832->142.250.189.145:443: read: connect reset peer
@levis-cod si tien pregunta sobr go, consult .
chang mention issue: `io/ioutil: add deprec marker ioutil`
chang mention issue: `io/ioutil: provid equival deprec readdir`
