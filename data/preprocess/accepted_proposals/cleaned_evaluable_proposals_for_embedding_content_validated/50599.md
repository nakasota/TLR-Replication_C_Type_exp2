os/exec: improv api default behavior pwd env variabl
### background
posix platforms, `pwd` environ variabl repres (emphasi mine) ‚Äú<strong>an</strong> absolut pathnam current work directory.‚Äù
specif valu `pwd` import current work directori reach multipl absolut paths, case subdirectori `/tmp` macos. affect behavior `os.getwd` (see #8400), turn affect error non-error output programs, includ behavior like path debug metadata (which invalid build cach skewed) parent-directori lookup (import for, among things, identifi current go workspac module). `pwd` `/tmp` aris natur go test execut subprocess within directori obtain call `(*testing.t).tempdir`, (or ought be!) common test command-lin binaries.
fail set `pwd` appropri set `dir` led number subtl bug within go project, as:
* #33598 (‚Äúunexpect stale targets‚Äù macos)
* #43862 (unexpect output `go:generate`)
moreover, set `pwd` correctli trivial: `pwd` requir absolute, `dir` field may relative, lead bug like #46832 two match.
### propos
propos two ergonom improv `exec.cmd` api:
1. `env` field `exec.cmd` nil `dir` field non-empti platform use `pwd`, subprocess' `pwd` variabl implicitli set appropri absolut path (comput `os.getwd()` `dir` relative) command started.
* `dir` field empty, `pwd` variabl (or lack thereof) would continu inherit go process, today.
* `env` field non-nil, `pwd` variabl (or lack thereof) would continu used, today.
2. new method, `(*cmd).environ`, analog `os.environ()`, return copi environ would use command current configuration: either copi current valu `env` field (if non-nil), `os.environ()` augment `pwd` and/or `systemroot` variabl would otherwis used.
part (1) alon would set appropri `pwd` exist command set `dir` explicitli modifi environ ‚Äî is, command author almost certainli consid `pwd` interact all.
part (2) would make easier set command run particular directori small number overridden environ variabl ‚Äî common case environ variabl `pwd` chang all.
### compat
propos would set updat `pwd` variabl command today receiv stale one (or none all) inherit parent go process.
would effect command empti `dir` field non-nil `env` field.
may chang observ behavior command nil `env` sensit valu `pwd`, includ command enumer variabl environment. command _are_ sensit valu `pwd` variable, nearli alway strict improvement: semant `pwd` variabl explicitli describ posix standard, chang would bring behavior line standard posix-lik platforms.
case conceiv user explicitli want inherit miss mismatch `pwd` test behavior command-lin binari non-posix-compli environment. however, rare case would straightforward user explicitli set `env` field slice desir `pwd` variable, includ variabl all.
### limit
propos would fix `pwd` variabl command explicitli set `env` incorrect miss `pwd` today (such explicit call `os.environ()`). deliber choic bia toward maintain compatibility, may limit scope improvements.
### altern consid
* could set `pwd` variabl less aggressively:
a. could omit `pwd` command' environ go process `pwd` variable, even platform normal use `pwd`.
b. could set `pwd` (on platform use it) whenev `dir` non-empti `env` includ explicit entri it, analog condit set `systemroot` window today. would fix command set explicit variabl accident omit `pwd`, would remov abil deliber leav `pwd` complet unset use `dir` field. (at best, would set empti string.)
c. could set `pwd` (on platform use it) whenev `dir` non-empti `env` includ `pwd` absolut path resolv `dir`. would enforc complianc posix standard variable, may expens detect, would remov abil deliber use noncompli `pwd`.
opinion, option (a) (b) would reason (c) would invasive.
* instead propos `environ` method, could add `setdir` method set `dir` field append appropri valu `env` field, popul `env` field use `os.environ()` previous nil.
worri append exist `env` field might bit subtle: intuit obviou whether `setdir` append `env` (potenti overwrit entri alias slices), `env[:len(env):len(env)]` (produc possibly-unexpect new allocation). could address documentation, think `environ` method easier describe, especi analog `os.environ`.
propos ad activ column propos project
review weekli propos review meetings.
‚Äî rsc propos review group
neato! one miss `pwd`, found via #50183. one caus `golang.org/dl/gotip` report mislead `goroot` compon `$home/sdk/gotip` symlink.

chang mention issue: `internal/version: set goroot_fin pwd environments`
seem reasonable. unfortun sometim wrong pwd inherit construct like
cmd.env = append(os.environ(), "goarch=amd64")
that' indistinguish realli want preserv pwd. it.
updat
cmd.env = append(cmd.environ(), "goarch=amd64")
anyon object make change?
base discuss above, propos seem like **like accept**.
‚Äî rsc propos review group
chang consensus, **accepted**. üéâ
