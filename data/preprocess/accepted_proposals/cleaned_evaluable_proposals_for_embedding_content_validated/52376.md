reflect: add value.setzero
re-propos #33136, convert perform optim `reflect.zero` allocate. chang certainli helps, insuffici especi tri zero small values.
propos add dedic `value.setzero` method.
prototyp implement mine show much faster small values:
```
Bool:       3.9x faster
Int:        3.5x faster
Uint:       3.9x faster
Float:      3.6x faster
Pointer:    2.2x faster
Map:        2.3x faster
Slice:      3.1x faster
Interface:  1.7x faster
String:     3.3x faster
```
unfortunately, conveni `setxxx` api clear nil-abl type (e.g., pointers, slices, maps) go propos `value.setnil` method, might well expand handl clear kinds.
cc @randall77
seem fine me.
@dsnet go tri tackl 1.19?
`value.setzero`ã€`value.setnil` method correspond test case need added, right? that' all, happi :)
@zaunist start think @dsnet may someth els planned. anyways. safe perform improv alway welcome.
> @dsnet go tri tackl 1.19?
implement ready, need go propos process. guarante get accepted.
@randall77 , @ianlancetaylor would next step make happen?
look propos committee. argument favor (exist code would made cleaner/faster/whatever) pleas post here.
probabl make freez 1.19, believ 2 weeks.
propos process explain
@randall77 , @ianlancetaylor, @rsc forgiv ignor matter still find way around go community, ecosystem look way collaborate, feel follow 2 feel would like flush lack knowledg appropri channel post here.
1. speak, 525 open issu label `performance`. least 400 came valid, merg would definit make go execut faster mani mani tasks. feel perform optim languag dread chang preferred. accord latest survey, 25% peopl prefer anoth languag go end go rust. rust forum seen lot peopl talk critic speed rust offer go, etc.. go way pleasur write rust, get build someth usabl faster mani benefits. "performance" sprint get mani optim get go execut much faster point adopt rust go runtim execut time longer even considered. again, apolog ignorance. opinion base multipl comment seen commun discord channel across past 12 months.
2. entir propos - go releas feel slow. current 2 major version releas everi year. could 4 releas per year? 2 major version, 2 small version releases. small version releas could sneak chang like one would huge languag change? propos meet could filter issu would go major/minor releases. understand current stabil releas "major" releas pretti much meant fix issu may come big release. current speed could take easili 4 year drain issu pipeline. look around name alway come includ yours. lot work, lot thing go peopl look potenti final say. mean, weekli propos meetings, mani issu guy look anyways?
please, let know chang think this.
@aalvarez90 start get off-top - would suggest summar point send email
gener rule thumb, increas amount releas chang prioriti team magic make featur improv get implement faster. still amount peopl work full-tim either way. yes, perform relevant, import object go - even 500 issu minor compar 7k+ open total.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
@dsnet, confirm compar v.set(reflect.zero(v.type())) optim #33136 express allocating?
assum yes, ad setzero final 2-4x seem ok.
chang mention issue: `reflect: add value.setzero`
given #33136 around sinc go1.16, fairli sure account benefit optimization.
perform number follows:
direct cachedzero newzero
setzero/bool 2.20n Â± 0% 8.97n Â± 5% 11.4n Â± 1%
setzero/int 3.08n Â± 1% 9.06n Â± 1% 11.5n Â± 0%
setzero/uint 2.88n Â± 1% 9.04n Â± 1% 11.7n Â± 5%
setzero/float 2.65n Â± 2% 9.05n Â± 1% 11.5n Â± 1%
setzero/complex 2.68n Â± 3% 9.31n Â± 1% 11.7n Â± 1%
setzero/array 6.69n Â± 4% 9.32n Â± 1% 11.8n Â± 1%
setzero/chan 3.31n Â± 1% 6.19n Â± 1% 8.20n Â± 1%
setzero/func 3.32n Â± 1% 6.20n Â± 0% 8.24n Â± 1%
setzero/ani 2.64n Â± 1% 9.39n Â± 3% 11.8n Â± 2%
setzero/interfac 2.66n Â± 1% 9.31n Â± 1% 11.8n Â± 1%
setzero/map 3.31n Â± 1% 6.21n Â± 2% 8.19n Â± 1%
setzero/point 3.30n Â± 1% 6.22n Â± 1% 8.17n Â± 1%
setzero/slic 2.90n Â± 4% 9.13n Â± 1% 11.6n Â± 1%
setzero/str 3.11n Â± 1% 9.30n Â± 1% 11.8n Â± 2%
setzero/struct 6.37n Â± 1% 9.18n Â± 4% 11.5n Â± 1%
where:
* `direct` perform `v.setzero()`
* `cachedzero` perform `v.set(zero)` `zero` pre-comput variabl `zero(v.type())`
* `newzero` perform `v.set(zero(v.type()))`
see `direct` gener 2-4x faster.
thank numbers. seem fine understand justif well.
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
