testing: benchmark unit properti
propos extend go benchmark format way specifi properti units. especi `testing` packag support report custom metrics, would use tool process benchmark result understand basic properti custom unit benchmark results. example, two unit properti would like `benchstat`: 1. whether higher lower valu better, 2. whether measur come underli distribut (e.g., perform measurements) exact (e.g., file sizes).
strong opinion syntax. would like syntax make sens benchmark format itself, command line tools. someth concrete, propos follow benchmark format

unit <i>unit</i> <i>key</i>=<i>value</i> <i>key</i>=<i>value</i> ...

follow command-lin flag

-unit "<i>unit</i> <i>key</i>=<i>value</i> <i>key</i>=<i>value</i> ..."

start line `unit` parallel benchmark result line start `benchmark`. use `key=value` parallel flag syntax benchmark name configuration. obviou altern would `key:value`, seem similar without file-level benchmark configuration, requir whitespac colon (it' unfortun benchmark name configur use `=` instead `:`). anoth option `-key=value` exactli parallel flag syntax, get awkward nest command line rais question whether also support `-key value`.
propos error specifi conflict properti unit.
also propos unit properti appli follow benchmark results, unspecifi whether appli earlier benchmark results. tool built would benefit unit properti aggreg result present them, unit properti natur appli results. want forc pure stream tool read result emit anyth case there' later unit properti line. alternatively, could say error properti suppli unit that' alreadi seen, seem overli restrict aggreg tools.
specif properties, propos
1. `{higher,lower}={better,worse}` indic direction. graph tabl often label "higher better" "lower better", meant parallel that. propos support four combin peopl rememb works.
2. `assume={nothing,exact}` specifi statist assumptions. `nothing` mean make statist assumpt (use non-parametr methods) `exact` mean assum measur exact (e.g., repeat measur necessari increas confidence). default `nothing`. futur could also support `normal`, that' almost never right assumpt benchmarks, omit now.
concret examples:
- default unit could specifi `unit ns/op lower=bett assume=nothing`, `unit mb/ higher=bett assume=nothing`, etc. would built-in tooling.
- variou compil benchmark tool report size compil binaries. requir repeat measurement, unit could specifi like `unit text-byt lower=bett assume=exact` command-lin `-unit "text-byt lower=bett assume=exact"`.
/cc @rsc @mknyszek @dr2chase @jeremyfal
use unit metadata would scale (see benchstatâ€™ newscaler) metric name (see benchstatâ€™ metricof).
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
> follow command-lin flag
>
> `-unit "unit key=valu key=valu ..."`
understand flag would used. tool envis support flag?
propos address benchmark code control properti unit uses?
wonder benchmark use default unit would commun unit properti proposal. take, example, `benchmarkparalleltimerlatency` time package.

remind conversation:
> understand flag would used. tool envis support flag?
benchstat, namely. plan ad support current version benchstat, complet rewrit almost done would like add support to. also work autom perform monitor (#48803), use command-lin flag specifically, would like unit properti for.
support "exact" measur particular sore spot benchstat benchmark record thing like "binari size", example. sinc that' go chang repeat measurement, report one sample, mean benchstat refus show delta enough data statist signific gener distribut assumptions.
> wonder benchmark use default unit would commun unit properti proposal.
actual fmt.print "unit" line `sync.once` benchmark function.
> remind conversation:
heh, indeed. benchstat v2 handl much better, without need unit properties. pars units, normal "ns" "sec", appli reason scale result.
improv benchstat sound realli nice.
> actual fmt.print "unit" line `sync.once` benchmark function.
seem ... unsatisfying. also help discover much. anyth ergonomic?
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
@chrishin , agre particularli ergonomic, though think ultim follow-on issu proposal. ad format tool support custom metric long test packag `b.reportmetric` (and workaround there!).
would add unit properti specif go benchmark format spec could certainli mention `testing.b` benchmark print unit lines. mayb worth mention doc `reportmetric`?
@aclement target user base feature?
want peopl write benchmark code know use featur think `testing` packag doc place put information. that' refer point write benchmarks. anywher els suspect peopl never learn it.
target user base narrow reason, perhap contribut go itself, mayb belong differ place.
> ... think ultim follow-on issu proposal. ad format tool support custom metric long test packag `b.reportmetric` ...
think understand propos limit go benchmark data format benchstat cli flags. propos titl "testing: benchmark unit properties" gave impress test packag scope. apolog got excit jump gun.
> @aclement target user base feature?
intend anyon write go benchmarks, gener sophist one (certainli use custom unit much need this!). curiously, actual refer go benchmark format benchstat anywher test packag documentation. realli quit non-prescriptive. think right document test packag right thing do, though think pull bit bigger go benchmark pictur time (which bad thing).
> propos titl "testing: benchmark unit properties" gave impress test packag scope.
that' fair. mayb titl "x/perf:" something. sure need curb enthusiasm. thing intent weakli coupled: point out, initi super ergonom access test package, can, propos accepted, broader tool make use this.
chang consensus, **accepted**. ðŸŽ‰
