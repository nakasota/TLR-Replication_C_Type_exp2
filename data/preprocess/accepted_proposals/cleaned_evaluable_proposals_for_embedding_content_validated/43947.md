os/exec: window use needcurrentdirectoryforexepathw lookpath behavior
os/exec.lookpath use window function `needcurrentdirectoryforexepathw` check environ harden protect resolut command path current directory.
note propos differ look exist `nodefaultcurrentdirectoryinexepath` environ variabl function look process environ variabl might also look registri settings.
relat to:
* #43724: return error path lookup would use current directori
* #42950: use lookpathab default
credit goe @kalleolaviniemitalo his/her comment #38736.
side note: window multipl way resolv applic paths. one `os/exec` implement 1.15.7 one implement cmd.ex (and cli tools), one recommend gui tool involv `path`. say `os/exec` never _only_ right way launch command windows.
sound reasonable.
/cc @alexbrainman @zx2c4
huh, interest rabbit hole here. one thing notic `createprocess` handl path resolut pass non-absolut execut name argv[0] null actual execut path name:
!imag

asid specif propos here, make wonder instead exec.command use lookpath, instead use behavior createprocess, alway window does.
---
regard needcurrentdirectoryforexepath, here' kernelbase.dl window 10, translat x86 go:
```go
if strings.Index(exePath, `\`) != -1 { return true }
_, ok := os.Environ()["NoDefaultCurrentDirectoryInExePath"]
return !ok
```
write:
> note propos differ look exist nodefaultcurrentdirectoryinexepath environ variabl function look process environ variabl might also look registri settings.
sure actual true. version window think look at?
> use [the] behavior createprocess ... alway window
sound realli reckless? entir propos aros exactli necess mitig risk malici code execut may lurk current work directori (#38736, #42420, #42950 #43724). fact microsoft stupid sh...tuff (and still does, ages), realli *doe not* mean anyon els ape that, ever (again). conveni *should not* take preced security.
seen #43724. think go want behavior change, would want keep os/exec use default whatev oper system environ using. look like #43724 chang that. issu here, suppose, becom one "how tell window go someth bad?" take @dolmen' suggest use `needcurrentdirectoryforexepath()` instead check `nodefaultcurrentdirectoryinexepath` environ variable. revers former, saw basic latter.
summary:
except error #43724, lookpath aim match window cmd.exe.
window configur add "." path implicitly,
propos lookpath respect configur set
(which turn environ variable).
seem unobjectionable. discuss aris confus exactli proposed, seem resolved.
anyon object proposal?
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
