cmd/go: allow user control vc usag
go command run command like git hg download modules. past, problem secur bug version control system becom secur bug “go get”.
origin modul draft design remov use command entirely, saying:
> want move away invok version control tool `bzr`, `fossil`, `git`, `hg`, `svn` download sourc code. fragment ecosystem: packag develop use bazaar fossil, example, effect unavail user cannot choos instal tools. version control tool also sourc excit secur problems. would good move outsid secur perimeter.
remov command possibl end: abl fetch directli git repo important, especi close source. secur exposur gone away. remain vulner problem vc systems, especi less scrutin ones.
**i propos add new govc set control version control system allow use downloads.**
simplest form, govc pipe-separ list allow version control systems:
govcs=bzr|fossil|git|hg|svn # known vc system
set known version control system abbrevi “all’:
govcs=al # known vc system
set vc system written “off”:
govcs=off # vc usag allow
glob pattern (alreadi use goprivate, gonoproxy, on) follow colon restrict effect particular (modul import) path prefix:
govcs=github.com:git # github.com, use git
special pattern “private” mean pattern goprivate.
special pattern “public” mean anyth match goprivate.
comma-separ list restrict given. first match list applies:
govcs=github.com:git,bitbucket.com:git|hg
finally, default set go command itself. explicit set govc take prioriti remov defaults; effect explicit govc set insert ahead default comma-separ list.
(note give consider control exactli vc use current behavior “if it’ path, used.”)
**i propos default govc set allow vc privat modul git mercuri public modules.**
is, default set equival to:
govcs=private:all,public:git|hg
rational behind allow git mercuri two system attent issu run client untrust servers. contrast, bazaar, fossil, subvers primarili use trusted, authent environ well scrutin attack surfaces.
certainli case even git mercuri unfortun free bug either, project scrutini establish record fix quickly.
rational behind allow `private:all` privat server trusted. beyond `go` command’ threat model guard scenario company’ privat sourc code host alreadi compromised.
user want allow vc even public sourc code server would use
govcs=private:all,public:al
**i propos public go modul mirror proxy.golang.org continu allow vcs.**
alreadi case go modul mirror handl fetch bazaar, fossil, subvers repo vast major go users: user even need instal correspond binaries, like not.
modul mirror also invok `go` command subprocess secur sandbox ad security, equip deal potenti compromis version control tools. would simpli run `govcs=public:all` continu allow vc tool used. would encourag altern modul mirror same.
combin disallow less-popular version control system default continu abl fetch modul mirror balanc improv baselin secur develop system machin fragment ecosystem.
default put modul mirror critic path download public bazaar/fossil/subvers downloads, system serv checksum database, alreadi critic path downloads. set opt checksum databas proxi modules—`goprivate=*`—would automat opt vc restrict well.
strong support. would significantli reduc attack surfac "go get".
think propos could make rel prioriti comma pipe clear, look like one reason interpretation.
implemented, think consid vulner vc git mercuri scope golang.org/security.
/cc @golang/secur
step right direction, howev agre origin "we want move away invok version control tools".
program languages, like say, ruby, equival go modul distribut special purpos archives, like .gem file ruby. go allow someth similar go modul pack command pack modul foo v1.2.3 archive, mayb name foo@1.2.3.nut, go get download https, base go.mod file.
@beoran, alreadi support protocol need invok version control tools. `go-import` metadata indic `mod` vcs, caus `go` command use `goproxy` protocol nativ https.
presum proposal, `govcs=off` would still allow use `mod` protocol, sinc requir tool `go` command itself.
seem like everyon favor this. right? objections?
@bcmill nice know, practical. rubi gem far easier use raw goprogy. support propos step right direction.
base discuss above, seem like **like accept**.
chang consensus, accepted.
implement look pars error cases, seem like mistak allow item list pattern: prefix. that,
govcs=git,svn
mysteri mean "git only", path match "git" rule, leav noth go "svn" rule. similarly,
govcs=myserver.com:git,svn
mean "myserver.com use git; everyth els use svn", look like all.
ergonom answer seem requir everi item comma-separ list form pattern:vcslist, write
govcs=myserver.com:git,*:svn
that' mean,
govcs=myserver.com:git,svn
flag invalid instead silent mean thing.
chang mention issue: `cmd/go: add govc set control version control usage`
interact go-import meta tags? discern would appli import/modul path repositori go-import point to, correct?
exampl go.tmthrgd.dev (mi vaniti domain) serv go-import meta tag like: `<meta name="go-import" content="go.tmthrgd.dev/exampl git go tool fetch go.tmthrgd.dev/exampl govc pattern would match? one specifi github.com go.tmthrgd.dev either them? (i know exampl somewhat academ git support default, imagin use svn).
intuit would expect github.com match (a that' git tool invoked) vaniti domain, suspect way around. think interact go-import might worth document somewhere.
@tmthrgd `govcs` pattern use match modul path import paths. example, would `go.tmthrgd.dev/example`. could migrat repositori anoth host without user need chang go set (though `.netrc` `.gitconfig` might still need adjusted).
reopen cl 266420 revert cl 267799; need re-sent.
chang mention issue: `cmd/go: add govc set control version control usage`
`govcs` ad `go help environment` afaict?
look like not. `go help private` explain it, `go help environment` point that.
add releas note, too.
chang mention issue: `content/static/doc: document govcs`
@dmitshur
isssu need reopen doc mistaken?
chang mention issue: `cmd/go: multipl small 'go help' fixes`
@beoran thank ping issue. `go help environment` includ `govcs` sinc cl 282615. referenc issue, there' need reopen.
