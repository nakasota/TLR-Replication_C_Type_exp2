runtime/debug: soft memori limit
# proposal: soft memori limit
author: michael knyszek
## summari
propos new option tune behavior go garbag collector set soft memori limit total amount memori go uses.
option come two flavors: new `runtime/debug` function call `setmemorylimit` `gomemlimit` environ variable. sum, runtim tri maintain memori limit limit size heap, return memori underli platform aggressively. includ mechan help mitig garbag collect death spirals. finally, set `gogc=off`, go runtim alway grow heap full memori limit.
new option give applic better control resourc economy. empow user to:
* better util memori alreadi have,
* confid decreas memori limits, know go respect them,
* avoid unsupport form garbag collect tuning.
## detail
full design document found here.
note that, time being, propos intend supersed #44309. frankly, abl find signific use-cas it, oppos soft memori limit overall. **if believ real-world use-cas memori target memori limit `gogc=off` would solv problem, pleas hesit post issue, contact gopher slack, via email mknyszek@golang.org. pleas includ much detail can.**
chang mention issue: `design: add propos soft memori limit`
afaict, impact memori limit visibl gc cpu throttled, before. would worth expos current effect gogc well?
@mpx think that' interest idea. `gogc` off, clear sign throttl telemetry. however, `gogc=off` think harder tell, get blurri runtim start bump gc cpu util limit, i.e. effect `gogc` mean runtim let exceed heap goal?
think that' pretti close. ideal would one metric could show, at-a-glance, "are red, so, far?"
case find use refer (and possibl includ "prior art"), go-watchdog librari schedul gc accord user-defin policy. infer limit environment/host, container, target maximum heap size defin user. built librari deal ever sinc integr singl oom reported.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
@mknyszek statu this?
@rsc believ design complete. receiv feedback design, iter it, arriv point major remain comment need addressed. think big question center propos whether api benefit worth cost. implement chang improv time; detail internal.
personally, think answer yes. found mechan respect users' memori limit give gc flexibl use avail memori quit popular. go user implement themselves, left work tool (like `runtime.gc`/`debug.freeosmemory` heap ballasts) signific pitfalls. propos also take step mitig signific cost new gc tune knob.
term implementation, foundat bit review wish land 1.18 (i think uncontroversi improvements, mostli relat scavenger). next step creat complet implement trial real workloads. suspect complet implement land 1.18 point, fine. give time work unexpect issu design practice.
thank summary. overal reaction seem overwhelmingli positive.
anyon object this?
> foundat bit review wish land 1.18
> suspect complet implement land 1.18
@mknyszek somewhat confus this. high level, hope includ 1.18, expect come later?
(specifically: extra knob 1.18, chang entir internal?)
@kent-h propos accepted, api definit land 1.18. plan land work scavenger, make scale bit better. use right, happen implement `setmemorylimit` describ propos depend it. intern function pertain `setmemorylimit` tree go 1.18.
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
