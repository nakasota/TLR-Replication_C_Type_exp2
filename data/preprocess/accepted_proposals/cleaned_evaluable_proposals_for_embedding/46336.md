bytes, strings: add cut
propos add packag strings:
// cut cut around first instanc sep,
// return text sep.
// found result report whether sep appear s.
// sep appear s, cut return s, "", false.
func cut(s, sep string) (before, string, found bool) {
:= index(s, sep); >= 0 {
return s[:i], s[i+len(sep):], true
}
return s, "", fals
}
similarli propos add packag bytes:
// cut cut around first instanc sep,
// return text sep.
// found result report whether sep appear s.
// sep appear s, cut return s, "", false.
func cut(s, sep []byte) (before, []byte, found bool)
cut singl function replac simplifi overwhelm major usag four differ standard librari function (index, indexbyte, indexrune, splitn). also invent twice main repo. reasons, propos add cut standard library.
previous propos part #40135, turn quit bikesh discuss compil optim on. also variou function proposed, made discuss even wide-ranging.
issu replac #40135, start new hope focus discussion. thank much @ainar-g start discuss #40135.
**edit, may 24**: renam third result `found` avoid confus comma-ok form map access, channel receive, on, alway return zero valu ok = false.
### unreason effect cut
attempt cut bikeshed time, let present data show cut worth adding.
anecdotally, discuss #40135 copi suggest implement cut everi program wrote could use while, turn everi program wrote anyth strings. made think someth here.
check belief, recent search use strings.index, strings.indexbyte, strings.indexrun main repo convert one could use strings.cut instead. call “index” sake discuss (ani call constant sep use index anyway), were:
- 311 index call outsid exampl testdata.
- 20 contain
- 2 1 call indexani
- 2 1 call containsani
- 1 trimprefix
- 1 hassuffix
leav 285 calls. those, 221 better written cut, leav 64 not.
is, 77% index call clearli written use cut. that' incredible!
typic rewrit replace:
// first equal separ key value.
eq := strings.indexbyte(rec, '=')
eq == -1 {
return "", "", s, errhead
}
k, v = rec[:eq], rec[eq+1:]

// first equal separ key value.
k, v, ok = strings.cut(rec, "=")
!ok {
return "", "", s, errhead
}
long believ line first version eleg go idiom:
k, v = rec[:eq], rec[eq+1:]
however, undeni eleg write line all, second version. complex exampl becam quit lot readabl work string instead indexes. seem index equival c pointers. work actual string instead, return cut, let code rais level abstract significantly.
note #40135, cut much like splitn n=2, without awkward potenti ineffici slice. typic rewrit replace:
elt := strings.splitn(flag, "=", 2)
name := elts[0]
valu := ""
len(elts) == 2 {
valu = elts[1]
}

name, value, _ := strings.cut(flag, "=")
discuss #40135, point rais mayb could make splitn count 2 alloc result slice caller' stack, first version would effici second. sure mid-stack inlining, probabl help exist code, make splitn n=2 effici make code less awkward write. reason adopt cut clariti code, efficiency.
33 call splitn main repo (exclud examples), 24 use count 2 clearli written use cut instead.
is, 72% splitn call also clearli written use cut. that' also incredible!
look public go corpus, found 88,230 call strings.splitn. these, 77,176 (87%) use fix count 2. expect essenti would clearli written use cut.
also worth note someth like cut reinvent two differ packag unexport function: golang.org/x/mod/sumdb/note' chop (7 uses) net/url' split (4 uses). clearly, slice separ incred common thing result strings.index.
convers describ view cl 322210.
note #40135, cut similar python' str.partition(sep), return (before, sep, after) sep found (str, "", "") not. boolean result seem far idiomat go, use directli boolean half cut call introduc main repo. is, fact str.partit use python ad evid cut, need adopt python signature. (the idiomat go signatur first suggest @nightlyone.)
again, cut singl function replac simplifi overwhelm major usag four differ standard librari function (index, indexbyte, indexrune, splitn), invent twice main repo. seem bar standard library.
### relat functions?
hand function suggest #40135 well. data address those.
**lastcut**. function would
// lastcut cut around last instanc sep,
// return text sep.
// found result report whether sep appear s.
// sep appear s, cut return s, "", false.
func lastcut(s, sep string) (before, string, found bool) {
:= lastindex(s, sep); >= 0 {
return s[:i], s[i+len(sep):], true
}
return s, "", fals
}
107 call strings.lastindex strings.lastindexbyt main repo (compar 285 index/indexbyte/indexrune). expect substanti fraction would made simpler use lastcut investig except look coupl dozen random examples. consid includ lastcut proposal, seem easier limit singl function cut.
may worth ad lastcut well.
**until**. function would
// return prefix first instanc sep,
// whole string sep appear.
func until(s, sep string) string {
s, _, _ = cut(s, sep)
return
}
261 call strings.cut end main repo, 51 (20%) form. single-result form would simplifi use allow appear insid expressions. like lastcut, consid includ propos seem easier limit singl function cut.
may worth ad well.
(until also suggest prefixuntil.)
**suffixafter**. function suggest mean
func suffixafter(s, sep string) string {
_, s, _ = strings.lastcut(s, sep)
return
}
similarly, could consid variant use cut instead lastcut. 261 call strings.cut end main repo, 6 (2%) form `_, x, _ = strings.cut`. suffixaft form use result cut definit _not_ worth adding. possibl data would come differ lastcut, absenc evidence, worth propos add suffixafter. (ad lastcut form would requir first ad lastcut well.)
**splitfirst**. function suggest mean
func splitfirst(s, sep string) (before, string) {
before, after, _ = strings.cut(s, sep)
return before,
}
261 call cut ad main repo, 106 (41%) discard final result. although result reconstruct `len(before) != len(s)`, seem wrong forc major use that, especi sinc multipl result either way.
### unrel functions?
concern #40135 even among thought cut worth ad bar standard librari addit whether ad cut meant open floodgates. comfort say bar somewher near “replac simplifi overwhelm major usag four differ standard librari function once” similarli confid establish bar would open floodgates.
chang mention issue: `all: use strings.cut`
chang mention issue: `strings: add cut`
like idea. question regard decis return `s` `false` case, wonder mani case go meaning data return neg case. know `io.reader` `io.writer` give meaning return case `io.eof`, use `if !ok` meaning data, case reflection, channel reads, map access, etc. eleg simplifi exist usages, caus double-tak read first, want highlight case may other encount same. ignor `ok` valu function also struck bit surprising.
@ezanmoto usual valu return "negative" case. is. instead think final bool indic whether first two result exist all, think ad one piec inform overal answer. is, differ kind bool map access, like math/big.rat.float64. think similar valu return rang error strconv.parseint.
renam result declar `found`, tri help surprise. expect call site peopl still call `ok`.
idea bad share:
```
prefix, ok := haystack[:"."]
```
think constitut vote cut.
think correct return found==false, inde set charact prior first instanc thing found s.
hearti +1 me.
also favor `until`, would perfectli comfort analog `lastcut` `after`.
idea cut function great, see hat string byte arrays, perhap could gener function?
gener realli help unifi string []byte functions, separ string byte packag go away.
definit support ad feature, would use mani time already. rememb realli appreci ad `str.partition` python -- avoid `split ... len(parts) == 2` awkwardness, shown, often avoid `if` all.
however, think name `cut` perfect. took coupl read descript figur did. "where cut?" "oh, cut two pieces, 'cut out' separator?" either way, think doc comment use word definition: "cut cut ...". mayb "cut split string first instanc sep" something.
vote would exact signature, name `partition`. longer think explanatory. *think* that' use python' version ... "partition" seem evok care separ piec return pieces. partit countri carefully-defin states. partit (albeit noun) also close word: space materi two thing -- exactli sens here. cut vague; cut thing shape size. get cut, often-messi abras skin -- before, after, partition.
fwiw, author origin issu say `cut` solv me. object name implementation.
> vote would exact signature, name `partition`. longer think explanatory. _think_ that' use python' version ... "partition" seem evok care separ piec return pieces. partit countri carefully-defin states. partit (albeit noun) also close word: space materi two thing -- exactli sens here. cut vague; cut thing shape size. get cut, often-messi abras skin -- before, after, partition.
mayb pedantic, mathematician, "partition" mean set disjoint set union equal anoth set. sinc cut, proposed, includ separator, give partit technic definit (adjust strings). python' partit includ separ return value, truli form partition.
first saw proposal, assum `cut` relat `trimxxx` functions. suggest chang name, agre @benhoyt said regard doc comment.
think cut realli illustr metaphor operation. take second get it, get it’ complet unambiguous. also it’ short, v tax page. i’m pro cut!
think "cut" captur meaning; impli "remove/drop". options:
split2 - associ current split op
cleav
bisect
divid
separ
segment
sinc mani string-search op support lastop() variant, think lastcut ad too.
chop?
case help anyone, evoc imag (sever food-related!) think captur spirit word, comment each:
* cut - certainli worst word, think convey cut shape cut string two
* chop - think usual mean "into small pieces", appli
* cleav - funni word mean opposite; "cut" sens usual forc oper
* divid - bad word, though probabl close "division" number sens
* bisect - almost alway mean "into equal parts" appli (and overload cs)
* partit - still vote, convey separ two not-necessary-equ parts, someth
* segment - particularli fitting, usual connot multipl segment like split
* separ - quit fit, usual mean care evalu compon put similar pile
> think "cut" captur meaning; impli "remove/drop".
"cut" remove/drop "sep" part.
rust call oper split_onc
readabl compat function (split, splitn, ...), better name splitonce.
sinc propos api like current split apis...
splitat - emphas separ
splitpair - emphas return valu
splitn2 - refer splitn(..., 2)
splitonc - emphas search iter
let suggest `splitaround`
```
// SplitAround splits s around the first instance of sep,
// ...
func SplitAround(s, sep string) (before, after string, found bool) {
	...
}
```
propos ad activ column propos project
review weekli propos review meetings.
— rsc propos review group
use function six month cut perfectli fine name it. let' bikesh name.
(i take point doc say "cut cuts...".)
general, agre proposal.
however, sinc use indexbyt lot, use unless also cutbyt function which, like indexbyte, use byte separ paramet type.
packag strings:
`func cutbyte(s, sep byte) (before, string, found bool)`
packag bytes:
`func cutbyte(s, sep byte) (before, []byte, found bool)
`
@petergo use `indexbyte` take byte literal, though? case `cut(s, "=")` instead `cutbyte(s, '=')`. guess use `indexbyte` non-liter (variable) byte compar rare. search go compil sourc indic 6 121 (5%) non-test use `[strings|bytes].indexbyte` use non-liter separator.
indeed, +1 @benhoyt - indexbyt constant sep index.
base discuss above, propos seem like **like accept**.
— rsc propos review group
concern peopl miss "cut" docs, group "split". sever splitx apis, folk guess there' anoth split-lik api elsewher docs.
"cut" clear, simpl term, there' alreadi "splitx" precedent. heard compel reason break it.
though voic support cut fond name, don’t want excess bike shed, find discover argument split compelling. probabl would know look cut.
think need forc use prefix make godoc content easier discover. see
