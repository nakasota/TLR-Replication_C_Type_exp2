database/sql: close driver.connector implement io.clos
propos ad new `sql.db.close` behavior/sid effect: close `driver.connector` implement option `io.closer` interface.
see [cl 258360][0] / #41710
would like abl manag resourc `driver.connector`, e.g. share underli databas handl multipl connections. requir embed databas in-memori backend like [sqlite][1] [genji][2] don’t creat new in-memori store whenev `sql.db` decid ask new connect call `driver.connector.connect`.
in-memori storag [go-sqlite3][3] driver doc current advic manual set `cache=shared` dsn parameter, non-zero [max idl connect limit][4] infinit [connect lifetime][5] `sql.db`. (see [faq: get tabl error?][6]).
get wors genji sinc on-disk boltdb badgerdb engin lock database. is, connector can’t open databas exist handl closed. `database/sql` mean either user must set connect limit 1, share handl `driver.conn` instances, also allow us support [concurr transact badgerdb][7] (see [genjidb/genji#210][8]).
said, need releas resourc held `driver.connector` (e.g. close file handle, unlock databas free unmanag memory) `sql.db` longer needed.
[0]:
[1]:
[2]:
[3]:
[4]:
[5]:
[6]:
[7]:
[8]:
cc @kardiano
bar expand updat exist database/sql (v1) fairli high
however, chang simpl interact anyth else. one situat would help. driver databas without inlin connect cancel background goroutine/connect dedic close connections, would provid way prevent connect leaking.
would say tent accept.
@kardianos, take care updat propos project status. need go discuss move like accept. thanks.
ad minutes.
anyon object ad this?
base discussion, seem like **like accept**.
chang consensus, accepted.
chang mention issue: `database/sql: close driver.connector implement io.closer`
