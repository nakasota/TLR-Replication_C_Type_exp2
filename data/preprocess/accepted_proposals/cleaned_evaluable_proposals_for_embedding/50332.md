cmd/go: add -c flag chang directori
sure rise propos not.
mani tool (e.g. make, git) univers `-c <dir>` flag let thing directori without pushd/popd silliness. given go use cwd import thing like modules, would nice someth like go. exampl `go -c path/to/dir list` give package-path. otherwis thing like `pushd path/to/dir >/dev/null; go list; popd >/dev/null`.
realli conveni thing. alreadi discussed? find it.
imagin would flag follow `go <cmd>`, `go build -c dir` `go test -c dir ./...`. think root `go` command ever taken flag directly, would odd break rule - unless deem flag special enough. note alreadi common flag commands, `-modfile` `-x`. also imagin command may need flag, `go version` `go bug`, perhap wrong.
logic itself: would effect replac use current directori everywhere? example, `go build -c /new/dir -o cmdbin foo.com/cmd@latest`, would binari show `/new/dir/cmdbin` `${pwd}/cmdbin`? would imagin former sake consistency; like real pushd/popd pair would do. note plenti flag accept rel paths, `-modfile` `-overlay`, need think together.
think neutral proposal. one hand, seem like harmless addition, inde preced popular tools. hand, hard judg necessari flag realli is, seem like pretti far-reach flag compar common flag right now.
particular use case think about? particular problem pushd/popd, verbos it?
imagin would straightforward implementation. flag
set, chdir() carri before. semant changes.
ack notion bare go command take flags, would
argu sort flag make sens univers modifier.
not, would argu sub-command it. happi
audit individually.
main use case avoid constant refrain `pushd path/to/foo
>/dev/null; whatever; popd >/dev/null` script (even wors
need exit code go) make like tools.
total conveni convent thing, also pretti trivial
implement (i hope).
>
> messag id: ***@***.***>
>
> main use case avoid constant refrain `pushd path/to/foo >/dev/null; whatever; popd >/dev/null` script (even wors need exit code go) make like tools.
could use subshell, lot shorter `pushd`/`popd` (or even quietier `cd foo; cd -`) give back exit codes.
```sh
$ (cd foo; pwd; true); echo $?
foo
0
$ (cd foo; pwd; false); echo $?
foo
1
```
commonli go checkout run `make.bash` repo root: `(cd src; gogc=off ./make.bash)`.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
`-c` realli "do chdir anyth else", that' easy.
go build -c bar -o x.ex
wors
go build -o x.ex -c bar
x.ex get written bar/x.exe? behavior peopl expect?
sound like suggest command write bar/x.exe.
confus people?
/cc @matloob @bcmill
think bar/x.ex consist tools' semantics.
wed, jan 19, 2022 10:18 russ cox ***@***.***> wrote:
> -c realli "do chdir anyth else", that' easy.
>
>
> go build -c bar -o x.ex
>
> wors
>
> go build -o x.ex -c bar
>
> x.ex get written bar/x.exe? behavior peopl expect?
>
> sound like suggest command write
> bar/x.exe.
> confus people?
>
> /cc @matloob < @bcmill
> <
>
> â€”
> repli email directly, view github
> <
> unsubscrib
> <
> .
> triag notif go github mobil io
> <
> android
> <
>
> receiv author thread.messag id:
> ***@***.***>
>
@matloob @bcmills, thought ad -c mean exactli
go cmd -c dir ...
==
(cd dir && go cmd ...)
paren make shell switch back go exits.
?
nitpicki here, assum want make equival `(cd dir && go cmd ...)`? like `dir` exist, `go` bail non-0 code.
would nice, small chang consist tool like `git` would help simplifi build scripts.
work build autom last year previou team code monorepo. build instruct script litter `pushd/popd` equival `cd dir && go â€¦ && cd ..` pattern. ad bit visual nois case error-pron directori structur refactor rel path `cd ..` need updating. scripts, git repositori outsid main monorepo interact use `git -c`.
seen makefil go project follow pattern similar would also benefitted:
```Make
GOCMD=go
GOBUILD=$(GOCMD) build
BINARY_NAME=app
build: 
  cd dir; $(GOBUILD) -o $(BINARY_NAME) -v
```
directori travers typic handl someth like `$(make) -c dir` go tool handl directori chang without need worri use subshel invok make littl easier work with. shell script makefiles, often see counter argument rais "you could *x!*" often technic correct less friendli develop may familiar rough edg areas. sense, `go -c` flag would like easier use wider rang background experi levels, think good thing.
object ad this?
tri think whether exist cmd/go behavior might intersect poorli this, spot glare seriou conflict.
example, go build take -modfil allow select altern go.mod file, okay time use anoth work directory.
presumably, also possibl set -c via cmd/go' `goflags` environ variable, possibl configur environ via `go env -w`. sinc go command use current work directori look `go env goenv`, conflict.
edit: also, `go test` `go doc` boolean `-c` (lower case) flags. conflict sinc propos `-c` (upper case).
interest work object propos one els pick yet.
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
> could use subshell, lot shorter pushd/popd (or even quietier cd foo; cd -) give back exit codes.
also reach solut github action found fail windows: would accept syntax, ran follow command directori subshell.
+1 proposal.
chang consensus, **accepted**. ðŸŽ‰
