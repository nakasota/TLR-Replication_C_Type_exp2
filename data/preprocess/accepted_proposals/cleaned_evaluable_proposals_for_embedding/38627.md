text/template/parse: add skipfunccheck mode flag disabl function check pars
follow discuss #34652 (accept ad 1.16) propos #36911, propos add option skip function exist check parsing, order make possibl pars arbitrari templat text get ast.
currently, pars follow templat text `{{ "foo" | titl }}` - without pass function map get `"function "title" defined"` error. ideal plan add tool support around templat packag (like gopls).
suggest ad anoth mode parse.modes, name `skipfunccheck` address issu (cl301493).
see need `option` type here. add flags?
> see need option type here. add flags?
thank respons @ianlancetaylor. give exampl api look like flags? sure add multipl flag current `parse` function:
```go
Parse(name, text, leftDelim, rightDelim string, funcs ...map[string]interface{}) (map[string]*Tree, error)
```
idea allow pars templat text comment ignor function exist check. quit necessari want support gopl want make possibl develop tool like gofmt templates.
api option look follows:
```go
ParseWithOptions(name, text, WithComments(), WithFuncs(funcs...), ...)
```
`skipfunccheck` anoth option. `leftdelim` `rightdelim` ad option well. make api much flexibl chang future.
suggest `parsewithoptions` use `net/html.parsewithoptions`, `config` object work well.
suppos make sens wrap `leftdelim` `rightdelim` options. see reason put `funcs` options, config struct would make sense. let' use config struct.
sorry, sure mean `net/html.parsewithoptions`, function sure refer to.
> see reason put func options, config struct would make sense. let' use config struct.
sure. let' use config struct.
> sorry, sure mean net/html.parsewithoptions, function sure refer to.
`parsewithoptions` function golang.org/x/net/html package. see:
golang.org/x/text repositori contain packag use function option well, sure use, config struct function options.
thank feedback continu discuss gerrit.
chang mention issue: `text/template/parse: add mode skip func-check parsing`
hey @ianlancetaylor, updat regard issue?
tag @stamblerre, far know, block change.
wait review propos review committee. sorri delay.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
/cc @robpik
ok me. hyrum' law.
support this. possibl static analysi templat without need provid execut functions.
anoth option would avoid check lazili always, defer first execution. would behavior change, incorrect templates, might ok. would avoid api chang new feature.
> anoth option would avoid check lazili always, defer first execution. would behavior change, incorrect templates, might ok. would avoid api chang new feature.
chang big affect mani programs.
currently, user declar `template.template` package-level variable, expect program fail startup templat invalid. use develop flow import deploy system detect program unabl start properli keep previou version (e.g. crashloopbackoff kubernetes). course, solv execut templat sampl data `init`, that' weird.
anoth exampl tool (like one use ent) check templat valid, sampl data execut templat - someth like third-parti templates.
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
> expect program fail startup templat invalid
get mean, there' mani way templat could fail execution. proper way check templat work execut it, e.g. via tests.
static analysi templat nice idea, @rogpepp mentioned, check function name resolved. example:
* field expressions, tell type struct, check field name valid.
* could check function call receiv known-to-be-invalid argument types.
* similar `go vet`, could check invalid `printf` call given arguments.
* could flag nonsens pipelines, condit alway true/false.
personally, lean toward rob' idea. api parsing, convinc give impress also check template' validity.
> get mean, there' mani way templat could fail execution. proper way check templat work execut it, e.g. via tests.
right, that' work today. user reli behavior, think better leav today introduc break change.
> personally, lean toward rob' idea. api parsing, convinc give impress also check template' validity.
parser today "parsing", agre proposals, static-analysi tool can't written without parser return ast check, format, etc (thi go compil works, right?).
@mvdan, ask way - want format templat file use standalon tool (e.g. like gofmt templates).
current `template/parse` fork, possibl pars arbitrari templat file get asts. suggest thing?
know one interest request long time ago (see propos it.
mayb clear. support proposal, argu new option necessary, explain here.
regard rob said mvdan reemphas above:
> anoth option would avoid check lazili always, defer first execution. would behavior change, incorrect templates, might ok. would avoid api chang new feature.
better wors current check realli use catch typo like. fact thing get caught seem like strong argument catch thing can.
catch set-and-not-us go compiler, argument remov set-and-not-us check have.
chang consensus, **accepted**. ðŸŽ‰
