net/http: allow custom proxi connect url
**updat may 5 2021**: current propos api - rsc
- - -
<!--
pleas answer question submit issue. thanks!
question pleas use one forums:
-->
### version go use (`go version`)?

go version go1.16 windows/amd64

### issu reproduc latest release?
ye
### oper system processor architectur use (`go env`)?
<details><summary><code>go env</code> output</summary><br>
set go111module=auto
set goarch=amd64
set gobin=
set gocache=c:\users\ÊµÅÊòüÊö¥Èõ®\appdata\local\go-build
set goenv=c:\users\ÊµÅÊòüÊö¥Èõ®\appdata\roaming\go\env
set goexe=.ex
set goflags=
set gohostarch=amd64
set gohostos=window
set goinsecure=
set gomodcache=e:\eternal\go\pkg\mod
set gonoproxy=
set gonosumdb=
set goos=window
set gopath=e:\eternal\go;
set goprivate=
set goproxy=
set goroot=c:\program files\go
set gosumdb=sum.golang.org
set gotmpdir=
set gotooldir=c:\program files\go\pkg\tool\windows_amd64
set govcs=
set goversion=go1.16
set gccgo=gccgo
set ar=ar
set cc=gcc
set cxx=g++
set cgo_enabled=1
set gomod=
set cgo_cflags=-g -o2
set cgo_cppflags=
set cgo_cxxflags=-g -o2
set cgo_fflags=-g -o2
set cgo_ldflags=-g -o2
set pkg_config=pkg-config
set gogccflags=-m64 -mthread -fno-caret-diagnost -qunused-argu -fmessage-length=0 -fdebug-prefix-map=c:\users\ ÊµÅÊòüÊö¥Èõ®\appdata\local\temp\go-build1194816388=/tmp/go-build -gno-record-gcc-switch
</details>
### do?
<!--
possible, provid recip reproduc error.
complet runnabl program good.
link play.golang.org best.
-->
want use proxi access http websit custom backend ip address
### expect see?
way custom url connect request
### see instead?
connect request ssl handshak use `cm.targetaddr`



unlik mani projects, go project use github issu gener discuss ask questions. github issu use track bug propos only.
question pleas refer
@seankhliao oh no, sorri express clearly. read relev code find way custom connect request. perhap requir new api.
exactli want do? chang address proxi keep hostname?
http request sent http proxy, first send connect request establish tcp connection, start handshak ssl website. websit multipl resolut addresses, use cdn, use specifi backend ip access websit specifi connect url. hope api custom connect url custom entir connect request.
similar
right, differ valu `connect xxx` (for connecting) `host: yyy` (for tls)
cc @bradfitz @neild @fraenkel
code set connect does:
connectreq := &request{
method: "connect",
url: &url.url{opaque: cm.targetaddr},
host: cm.targetaddr,
header: hdr,
}
hdr["host"] set, sound like use instead cm.targetaddr set connectreq.host. is, add:
host, ok := hdr["host"]; ok {
len(host) >= 1 {
connectreq.host = host[0]
} els {
connectreq.host = ""
}
}
anyon object this?
propos ad activ column propos project
review weekli propos review meetings.
‚Äî rsc propos review group
sorri confus tri solve.
request target site, www.target.org, go proxy. actual request url/host www.target.org. realli matter host header is. request ignor host header gener based,
proxi requir ignor host header receiv absolut uri,
```
When a proxy receives a request with an absolute-form of
   request-target, the proxy MUST ignore the received Host header field
   (if any) and instead replace it with the host information of the
   request-target.
```
@fraenkel, that' standard http proxy, custom thing serv connect requests.
object provid functionality? seem unobjection us.
@rsc sorri bad.
miss fact talk proxyconnectheaders.
also reset `connectreq.url.opaqu = ""` appear connect line.
probabl easier rewrit url sinc host use opaqu bit url.
sorri confus again. ignor said. need doubl check test case see host header side.
forgot readrequest delet host header. long side use go, work.
base discuss above, propos seem like **like accept**.
‚Äî rsc propos review group
chang consensus, **accepted**. üéâ
