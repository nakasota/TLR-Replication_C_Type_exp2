io/fs: add readlinkf interfac
### version go use (`go version`)?

$ go version
go version go1.17.3 linux/amd64

### issu reproduc latest release?
ye
### do?
walk directori `fs.walkdir` encount symlink want read.
### expect see?
function `fs.readlink` behav like `os.readlink`, oper `fs.fs`. design sketch:
```go
package fs
// ReadLink returns the destination of the named symbolic link.
//
// If fsys does not implement ReadLinkFS, then ReadLink returns an error.
func ReadLink(fsys FS, name string) (string, error)
// ReadLinkFS is the interface implemented by a file system that supports symbolic links.
type ReadLinkFS interface {
  FS
  // ReadLink returns the destination of the named symbolic link.
  ReadLink(name string) (string, error)
}
```
would also want file system return `os.dirfs` implement call `os.readlink`. iiuc `archive/zip.reader` would probabl also benefit implementation.
open question mind whether return destin slash-separ path kept as-is. think consist probabl convert slash-separ path, sure problem windows.
### see instead?
api exists.
### detail
bandwidth contribut implement this, understand freez earliest could go go 1.19.
somewhat relat #45470, propos chang exist semantics, ad new method.
> open question mind whether return destin slash-separ path kept as-is.
would say slash-separ _also_ rel `fs`: link absolut path made relative, link path fs root (or entir differ volume) rejected.
rewrit link tricki rewrit link also tricky. unclear here, anything.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
data point, applic writing, rewrit link rel effect anyway. want creat zip archiv on-disk directory, absolut path rewritten rel `dirfs` root. return error path could repres acceptable.
api readlink must return path rel link, can't that, return error?
seem like symlink absolute, though, dirfs(foo) use foo = "/", make symlink result errors?
tri understand use practice, balanc cost. use practice? peopl frustrat 99% symlink usable?
> api readlink must return path rel link, can't that, return error?
yes.
> seem like symlink absolute, though, dirfs(foo) use foo = "/", make symlink result errors?
would expect `readlink` method intern transform absolut link path rel one (for example, use `filepath.rel` check return path begin `../`.) would allow symlink succeed locat fs root â€” would fail absolut symlink would otherwis refer locat complet outsid fs tree.
so, example, os.dirfs("/") unix would abl resolv symlink anywher filesystem, even symlink absolute.
>i would expect readlink method intern transform absolut link path rel one (for example, use filepath.rel check return path begin ../.) would allow symlink succeed locat fs root â€” would fail absolut symlink would otherwis refer locat complet outsid fs tree.
extend non local-disk filesystems?
@rsc:
> api readlink must return path rel link, can't that, return error?
suffici application. root `dirfs` could contain multipl project (think gopath-lik setup), symlink would usual resolv within `io/fs` filesystem.
> seem like symlink absolute, though, [...]
100% convinc that, evid disput claim.
fwiw case concern devtool context:
- symlink within directory. common case multipl alias singl on-disk program, like busybox.
- iirc old version git would use symlink repres symbol refer like `head` instead file.
> tri understand use practice, balanc cost. use practice? peopl frustrat 99% symlink usable?
agreed, think weigh tradeoff trickiest part proposal.
rel link imo use consum api. could imagin implement `readlink` also return absolut path case return path root `io/fs` directory, might add complex path slash-separated. however, tend agre @bcmill strict probabl better.
probabl alreadi consid this, `fs.readlink` would picki link target. implicit interfac `dirfs.open` follow symlink (again, #45470 track spell behavior filesystems), symlink alreadi visibl directori listings.
---
@hherman1:
> extend non local-disk filesystems?
propos slash-separ rel path restrict would extend non-local-disk filesystems, yes. implement meet contract individu filesystem.
@zombiezen, thank use cases. seem fairli unobtrus add readlinkf fs.readlink, cost seem low benefit > 0.
@bcmills:
> would expect readlink method intern transform absolut link path rel one (for example, use filepath.rel check return path begin ../.) would allow symlink succeed locat fs root â€” would fail absolut symlink would otherwis refer locat complet outsid fs tree.
>
> so, example, os.dirfs("/") unix would abl resolv symlink anywher filesystem, even symlink absolute.
rewrit symlink may run problems. burn enough bit wari that. start error absolut ones?
think would fine start error absolut links, perhap defin specif error (or error type) symlink refer locat outsid `fs`.
perspect `fs.readlinkfs`, requir would everi return path rel passed-in name fs root. (it would specif `fs` implement decid whether achiev rewrit absolut link reject them.)
ok, sound like agre readlink readlinkf restrict return link must relative, absolut symlink return error instead. right?
iiuc full constraint return link rel _and_ underneath root `fs`. otherwise, yes, match understanding.
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
