testing: add elapsed() method testing.b
propos add `elapsed` method `testing.b`, follows:
```go
// Elapsed returns the measured elapsed time of the benchmark. If the timer is
// running, it will be stopped.
func (b *B) Elapsed() time.Duration {
    b.StopTimer()
    return b.duration
}
```
## motiv
custom benchmark metric power feature. go introduc partial support `testing.b.reportmetric()` api follow #26037. however, api seem leav gap support rate metrics. specifically, rate metric would divid total benchmark time report `/s` suffix, built-in `mb/s`. cannot report use exist api sinc way access measur time.
rate metric mani use cases. exist `mb/s` prove least one. could also imagin report `packets/s` network benchmark, `points/s` geometri benchmark. work benchmark `avo` assembl want report `instructions/s`.
rate metric support benchmark libraries, googl benchmark, becom somewhat de-facto standard c++ benchmarking. googl benchmark' user counter configur support rate metric `kisrate` flag, along mani others. googl benchmark also support special-cas `setitemsprocessed` support exampl like `packets/s` `points/s` mention previously. example, `abseil` librari use `setitemsprocessed` report rate item push vector.
think satisfactori workaround moment. measur time use report rate metric `reportmetric`. alternatively, abus `setbytes` post-process output inform user interpret differently.
propos extend `testing.b` api possible. ideas:
* add `reportrate` method, similar `reportmetric` valu divid time.
* add `setitemsprocessed` method similar googl benchmark.
* expos measur time user comput rate report exist api.
follow discuss below, propos `elapsed()` method given above.
cc @aclement
> measur time use report rate metric reportmetric.
oner workaround; measur elaps time short simple.
altern fix add method `testing.b` let queri accumul metrics, e.g. `func (b *b) elapsed() time.duration)`. sampl usage:
```
  for i := 0; i < b.N; i++ {
    // do stuff
  }
  b.StopTimer()
  b.ReportMetric(customMetric / float64(b.Elapsed().Nanoseconds()), "custom/ns")
```
> oner workaround; measur elaps time short simple.
sure, oner term line code. however, seem time code execut core respons benchmark framework, seem odd cede respons users.
even look code hood, could imagin `testing` packag want use higher precis timer `time` packag use default. nice hidden user chang futur necessary.
> altern fix add method `testing.b` let queri accumul metrics, e.g. `func (b *b) elapsed() time.duration)`. sampl usage:
>
> ```
> := 0; < b.n; i++ {
> // stuff
> }
> b.stoptimer()
> b.reportmetric(custommetr / float64(b.elapsed().nanoseconds()), "custom/ns")
> ```
yes, would great. mind "expos measur time user comput rate report exist api" idea description. seem slightli awkward need contract call `stoptimer` first.
oppos expos measur elaps time benchmark. true often hard measur yourself, becom much harder benchmark use `stoptimer` `starttimer`, way retriev framework' measur time would ensur custom time-r measur exactli denomin built-in ns/op measurement. consist denomin depend call `stoptimer` retriev elaps time, josh did.
peek internals, could simpl ad `duration() time.duration` method return `b.duration` field. nuanc call timer running. it:
* comput durat instant return it, leav timer run
* return 0 `timeron` true
* `panic` `timeron` true
return 0 seem like would invit bugs, sure two options.
> nuanc call timer running.
fourth option: stop timer. easi document, yield correct outcom situat minimum fuss.
> duration() time.dur
would advoc `elapsed` `duration`, durat could also mean target durat benchmark run.
progress propos process get decision? base discuss think simplest concret propos addit follow method `*testing.b`:
```go
// Elapsed returns the measured elapsed time of the benchmark. If the timer is
// running, it will be stopped.
func (b *B) Elapsed() time.Duration {
    b.StopTimer()
    return b.duration
}
```
perhap addit note document `reportmetric` would order?
leav timer run seem much less surpris silent stop timer.
otherwis seem fine me.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
great see taken up!
> leav timer run seem much less surpris silent stop timer.
yes, see argument that.
assum elaps report elaps time chang run state timer, anyon object ad elapsed?
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
