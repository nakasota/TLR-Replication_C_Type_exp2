all: add goamd64 environ variabl
propos add goamd64 environ variable, initi option "baseline" (default), "v2", "v3".
go architectur support go[arch] environ variabl control architecture-specif options: go386, goarm, gomips, gomips64, goppc64, gowasm. however, amd64 port (presum common architectur go deploy on) still limit original, now-20-year-old instruct set, occasion runtim cpuid detect save signific enough merit it. (for comparison, goppc64 support optim power9, becam avail 2017.)
complic x86-64 accumul many, mani instruct set extensions, processor revis differ set support extensions. make user respons decid set extens enabl feel go-like.
however, 2020, x86-64 psabi ad four name microarchitectur level help group extensions: "x86-64 (baseline)", "x86-64-v2", "x86-64-v3", "x86-64-v4". see details.
"baseline" correspond go alreadi supports, "v2" "v3" add new instruct could use go program (e.g., popcnt v2, bmi1/bmi2 v3).
v2 cpu appear commonplac today. e.g., rhel9 support v2, per blog post; gce cpu support v2, believ aw azur cpu too.
v3 cpu also increasingli common. e.g., gce' ivi bridg sandi bridg cpu limit v2; haswel (launch 2013) newer support v3.
issu #25489, report result two optim attempt use haswell' bmi instruct (pext varint decoding, lzcnt coupl other scanobject). optim could benefit target v3 cpu specifically, probabl worthwhil need reli runtim cpuid detection.
also suggest process startup, go runtim throw compil assum instruct set extens avail cpu. think that' good idea.
questions:
- "baseline", "v2", "v3" best names? "v1" would perhap better "baseline", psabi formal name that. could suggest though?
- add "v4" too? add avx512 instructions, go compiler/runtim immedi use for, seem bit contenti whether use current processor anyway.
sinc v4 defin would inclin say accept v4 valid `goamd64` valu treat v3.
> sinc v4 defin would inclin say accept v4 valid goamd64 valu treat v3.
think okay accept goamd64=v4 actual use avx512 instructions. think runtim probabl still check avail runtime, decid start use avx512 futur worri user erron run v4 binari v3 cpus.
would like note pentium celeron (often use low tier laptops, nuc na devices) support avx/avx2 base haswel newer (and categor architectur names) v2 v3. server farm perform matter v3 like good choic gener comput even newer chip v2 still relevant.
think also worth note mainstream linux distro look adopt microarchitectur level binari packages. example, arch add v3 mirror top exist "baseline":
assum ship soon, imagin packag build gcc llvm would benefit, go packag would left behind without proposal.
nice see intel amd coalesc fewer configur knobs.
"baseline" unfortun name sound like "go' default".
(compar mention baselin discuss goexperiment.)
seem like "v1" obviou choic base configuration.
mayb someon suggest intel?
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
agre ad support differ api level go amd64 port, would like v1 stay default go applic go compil least next 10 years. famili use old refurbish comput linux, sinc still work fine, think must mani other around world situat access recent hardware.
@beoran, default minimum requir go would differ proposals. understand it, one propos chang default minimum requir away v1 issue. ad architectur set similar goarm others.
call current baselin "v1" instead "baseline" seem like everyon board.
right?
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
