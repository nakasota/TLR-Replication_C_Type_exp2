go/doc: improv headings, lists, link
propos improv support headings, lists, link go doc comments,
remain backward compat exist comments.
includ new package, `go/doc/comment`, expos pars syntax tree
doc comments, includ chang `go/printer` therefor `gofmt`
format doc comment standard way.
example, exist list reformat display left one right:
<table>
<tr><td><img src=" width="308" height="271">
<td><img src=" width="307" height="289">
</table>
url link rewritten chang display left one right:
<table>
<tr><td><img src=" width="307" height="94">
<td><img src=" width="308" height="103">
</table>
packag doc comment (and others) rewritten link specif symbols:
<table>
<tr><td><img src=" width="366" height="383">
</table>
full design doc
chang mention issue: `go/doc/comment: new package`
chang mention issue: `all: fix variou doc comment format nits`
chang mention issue: `cmd/go: gofmt alldocs.go`
chang mention issue: `all: fix todo comment hang indents`
chang mention issue: `go/doc: use go/doc/comment`
chang mention issue: `cmd/doc: use new go/doc apis`
chang mention issue: `all: gofmt main repo`
chang mention issue: `go/printer: format doc comments`
chang mention issue: `all: remov trail blank doc comment lines`
chang mention issue: `all: separ doc comment //go: directives`
chang mention issue: `internal/pkgdoc: updat go/doc api usag links`
top comment fill now.
see
solv 90% problem work docstr make remain 10% trivial. ecstatic!
perfectli happi accept as-i coupl minor thoughts:
s/text/inline/g s/plain/text/g align html. could familiar seem clearer me.
allow subhead `##`, `###`, on. seen packag sinc origin discuss could use least one extra level indent group subsect (i think record packag question, sorry). could ad later, may prudent accept `## x` head chang paragraph head later. though point way implementation.
think keep thing simpl increas scope past previou discussion. would realli problem ## render paragraph later transition. singl # render paragraph one.
number point 5 goal non-goals, absenc in-lin imag support note coupl languag support one, mention python (a much relev languag exampl perl). exist project general, python doc string may valid restructuredtext allow embed images.
python support imag docs, noted.
problem list imag still exist though, imag remain scope change.
extrem excit this! coupl question / suggestions.
1. currently, pkg.go.dev render automat convert text like `rfc nnnn` link correspond rfc. tell, that' featur website' render oppos one godoc itself. behaviour render remain intact?
2. point ascii doubl quot mention reformat preformat text. think, worth explicitli mention replac unicod one posit ad test case one.
(thi may seem obvious, anyon ever tri edit shell script maco textedit program know sometim isn't, heh.)
3. number list section, current clear, happen n 9. assum becom “␠nn.␠”?
4. head section, perhap exampl line begin space `#`. markdown allow certain amount space head character, new format allow differr worth mention explicitly, think.
again, realli look forward case.
overal look good, want restat concern access issu rais approach mark links.
thank questions, @ainar-g.
1. dont know sure, think idea drop special case rfc nnnn support pkg.go.dev let peopl write links. current support handl refer subsect well, example. probabl mistak pkg.go.dev diverg way. bit prior discuss
2. doubl ascii singl quot (` `` ` ` '' `) reformatted. call explicitly:
> ascii double-single-quot form alway defin render “ ” replac those.
3. n 10, “␠n.␠” would “␠10.␠”. seem clearer write “␠nn.␠” - “␠1010.␠”?
4. thank suggestion. ad example.
@kortschak note link syntax. anyth add beyond
worth note follow oob detail response, receiv reply.
overall, excit see.
quick question link header relationship base url.
1. link header package, would someth like follow work?
```
See [Some Heading] for more information.
[Some Heading]: #some-heading
```
2. would reli know default header anchor id algorithm (or copy/past similar)? api, look propos as:
```
// The default anchor ID is constructed by dropping all characters
// except A-Z, a-z, 0-9, space, and tab, converting to lower case,
// splitting into space-or-tab-separated fields, and then rejoining
// the fields using hyphens. For example, if the heading text is
// “Everybody Says Don't”, the default ID is “everybody-says-dont”.
```
3. would abl link header packag without need know base url, someth like:
```
[Another Heading]: /some/import/path#another-heading
```
3. anchor id remov non-ascii letter certainli simplifi things, link someth like (one exampl #7349) contempl future, simpli chang anchor id algorithm might break link mix ascii/non-ascii headers?
```
# これは、ヘッダです
```
event, think abil link header would extrem useful, especi complex packages.
propos ad activ column propos project
review weekli propos review meetings.
— rsc propos review group
> * n 10, “␠n.␠” would “␠10.␠”. seem clearer write “␠nn.␠” - “␠1010.␠”?
caus misalign issu follow line list item? see:
> list item continu text, includ addit paragraphs, indent four spaces.
number space line actual text list item belong to?
example,
```
//  10. This is an example list item.
//     This is how my reading of the spec would reformat it.
```
additionally, concern nest lists. dig requested, seem incred like lot \<pre\>-block list would use nest list like so:
```
//  - an item
//  - another item
//    - some important subitem
//    - another important subitem
//  - some other item
```
yes, subtl space counting, exist comment would alreadi preformat blocks. think lack nest list would harm space count would entail. know go back re-structur sever godoc comment written avoid nest lists.
sure nest lists, one way avoid subtl space count would requir doubl tripl list marker bit like
```
 1.
 2.
 2. 1.
 2. 2.
 2. 3. - 
 2. 3. -
```
hi @ajanata
> number space line actual text list item belong to?
>
> example,
> ```
> // 10. exampl list item.
> // read spec would reformat it.
> ```
understand it, deliber choice. there’ discuss rational here:

…includ see exampl suggest vs. current propos intent keep continu line aligned.
third option might realign text number list moment add item 10 item 100, make diff less clean rule complex.
doc link syntax section propos impli `[pkg.id]` render singl link, `doc/comment.doclink.defaulturl` return singl url. `pkg.go.dev` render symbol declarations, link packag symbol. example, look link `io.writer` actual two links: `io` link `/io`, `writer` link `/io#writer`.
data often peopl use packag link, often accident click want symbol. words, may feature, may misfeature. inconsist proposal.
@jba even know two link there. think packag link use dropped.
consid document
would nice format `name`, `usage` `fn` text improved, sinc refer paramet function.
hasnt mentioned, also discuss around doc api places:


center around markdown, eventu spiral gener api like discuss here.
