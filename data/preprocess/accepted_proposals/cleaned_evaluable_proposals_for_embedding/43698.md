cmd/vet: warn "// go:" comment (with space)
`embed.fs` type ad #41191 document follow behavior:
> `fs` read-onli collect files, usual initi `//go:embed` directive. declar without `//go:embed` directive, `fs` empti file system.
expect packag author essenti _never_ intend end empti read-onli filesystem product package. (in tests, perhaps, otherwise.) case do, abl add explicit `//go:embed` direct indic filesystem _intentionally_ empty.
otherwise, easi unintent typo `//go:embed` directive, one discov result difficult-to-debug failur run time.
propos `cmd/vet` emit warn when:
* package-level variabl declar type `embed.fs`,
* without correspond `//go:embed` direct (not even one empti pattern list),
* non-test sourc file.
chang mention issue: `embed: treat uniniti fs empty`
never make sense, build error?
> non-test sourc file.
expect restrict necessary? propos restrict packag level variables. current draft embed.f level. expect anyon els would one intentionally?
> never make sense, build error?
ok too, suspect `vet` warn easier sell. ðŸ˜…
> expect restrict necessary?
expect catch non-trivi number real error false-positives. believ meet bar `vet` check.
> propos restrict packag level variables. current draft embed.f level. expect anyon els would one intentionally?
note (a) package-level variabl cl unnecessari (it could local variabl instead), (b) would trigger propos check anyway, variabl test sourc file.
@timothy-king, oh, think see say now. â€œwould ok warn package-level embed.f variabl test sourc files?â€
actual know. suspect could warn case too..?
> expect catch non-trivi number real error false-positives. believ meet bar vet check.
agreed. also think cost false-posit small. believ `var global *embed.fs=&embed.fs{}` would decent workaround absolut initi empti packag level embed.fs.
> @timothy-king, oh, think see say now. â€œwould ok warn package-level embed.f variabl test sourc files?â€
yep question.
> actual know. suspect could warn case too..?
also suspect warn test would okay. mayb clever enough, can't think good use case test file either.
spec adopt propos clear declar embed.f `//go:embed` line valid.
believ valid, vet "warn" it.
warn non-errors.
implement today, embed.f copyable, thing like
```
var fs embed.FS
if cond {
   fs = version1files
} else {
   fs = version2files
}
```
want vet complain `fs` code.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
@rsc propos warn packag level variables. think `fs` would function scope example. make realli good point proposal:
> similarly, embed.fil variabl global local variable, depend conveni context.
> error declar embed.fil without //go:emb directive. variabl simpli contain embed files.
say fairli definit strict read propos warn non-errors.
seem like someth help case like #43682 though. instead warn //go:emb also like misspel like "// go:embed" (with space)?
seem fine develop vet checker warn "// go:" line "//go:" would mean instead.
exampl "// go:embed" right embed.f []byte string declaration,
"// go:noinline" right function.
want check fals posit exist open-sourc go code though.
repurpos issu that, @bcmills?
yep, seem ok me. `// go:` check would probabl help direct too.
might worth look buildtag analysi pass, may alreadi //go:build.
anyon object retitl propos (a vet check warn "// go:foo" "//go:foo" meaning)?
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
