fmt: add formatstring(state) string
current work custom fmt.formatt implementation. similar request would like implement method "fall back" default `fmt` implement unimpl verbs.
difficult state allow reconstruct origin format string, unless enumer possibl charact format string call `flag(char)` one. lengthi error prone.
would like formal propos @bcmill suggest add string() api `fmt.state`.
```go
// State represents the printer state passed to custom formatters.
// It provides access to the io.Writer interface plus information about
// the flags and options for the operand's format specifier.
type State interface {
	// Write is the function to call to emit formatted output to be printed.
	Write(b []byte) (n int, err error)
	// Width returns the value of the width option and whether it has been set.
	Width() (wid int, ok bool)
	// Precision returns the value of the precision option and whether it has been set.
	Precision() (prec int, ok bool)
	// Flag reports whether the flag c, a character, has been set.
	Flag(c int) bool
         // String returns the original format string that was used to create this State (e.g. "%#v")
         String() string
}
```
doubt mani implement api, would limit amount breakag ad new method.
standard library, current one implement `fmt.state` - `pp` struct.
someon give pointer search across github, would happi check whether in-the-wild implement fmt.state. also appreci someon could insid google.
thank bryan mills, github user seeb eric lagergren initi suggest discussion.
clarify, think add `string` method `fmt.state` interfac â€” implement `fmt` packag pass `format` methods.
(in retrospect think mistak make `state` interfac first place, given earli `fmt` packag design understand mistak could made time. ðŸ˜…)
technic can't add method `fmt.state` interface. add `string` method underli type `fmt.pp`. retitling.
cc @robpik
> add string method underli type fmt.pp. retitling.
would let us do, though? imagin would use third parti code insid `format()` function call:
```go
func (b myType) Format(w fmt.State, verb rune) {
    // here
}
```
gener shape function, would imagine, someth like proposal:
1. implement verb flag custom behavior.
2. rest them, invok `fmt.fprintf(w, ???, b)` similar.
??? is, theory, recov pass format string.
`w` `fmt.pp` hood, think cast `fmt.stringer` `fmt.pp` there, i? sorri dense.
**edit:** ahhh... ad string() could `fmt.sprint(w fmt.state)` whatev recov origin string. indirect still get us want.
@ianlancetaylor presum look like:
```
func (b myType) Format(w fmt.State, verb rune) {
   type derivedType myType
   fmt.Fprintf(w, w.String(), derivedType(b))
}
```
(that would mask mytype.str method though, `%t` `%#v` fallback display right type name, otherwise, gener feasibl approach)
said, believ cleaner.
> perhap could document fmt.state receiv writes, re-interpret valu though fmt.formatter, proceed accordingli (thu "fallback" would mere return format method without fmt.state.writ method called).
sure ad invis method here. solut propos #51195 complet visibl - need peopl know thing type system. new method type-assert would different.
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
one possibl top-level function fmt.state string, like
packag fmt
func formatstring(state) string
chang mention issue: `fmt: add function recov origin format string given state`
@knz implement difficulti work around issue.
@robpik post cl api almost wrote earlier, ad 'verb rune' argument list:
packag fmt
func formatstring(st state, verb rune) string
provid access requested, without new state method.
anyon object api?
actual quit same. actual chang
```
package fmt
func FormatString(state State, verb rune) string
```
state contain verb. verb alway end, caller could add it, remov allocation.
would possibl preserv slice refer portion origin format string state, return instead construct new string?
--
verstuurd vanaf mijn android apparaat met k-9 mail. excus mijn beknoptheid.
no, state interface.
updat comment record 'verb rune' api.
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
chang consensus, **accepted**. ðŸŽ‰
