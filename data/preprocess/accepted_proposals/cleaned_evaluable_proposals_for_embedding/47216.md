runtime/metrics: add gomaxprocs, numcgocall, gc cpu time
hi
test use runtime/metr packag introduc 1.16
use go version 1.16.5.
find follow metric exist runtim packag runtime/metr packag :
- func numcgocall() int64
- func (r *memprofilerecord) inusebytes() int64
- func (r *memprofilerecord) inuseobjects() int64
make sens add runtime/metr pacake?
make sens add valu (which static) well?
- func version() string
- func gomaxprocs(n int) int
- func numcpu() int
thank lot, g.
cc @mknyszek
> hi
> test use runtime/metr packag introduc 1.16
> use go version 1.16.5.
> find follow metric exist runtim packag runtime/metr packag :
>
> * func numcgocall() int64
> * func (r *memprofilerecord) inusebytes() int64
> * func (r *memprofilerecord) inuseobjects() int64
`numcgocall` could good candidate. two alreadi account `/gc/heap/objects:objects` `/memory/classes/heap/objects:bytes` respectively.
>
> make sens add runtime/metr pacake?
>
> make sens add valu (which static) well?
>
> * func version() string
> * func gomaxprocs(n int) int
> * func numcpu() int
`version` `numcpu` quit packag made for. realli make sens track valu time, sinc static. though, simultaneously, understand analyz someth like across fleet nice, also nice one api export everything. think it.
`gomaxprocs` hand probabl good candidate. chang time (usual doesn't, can) seem like might use correl metrics. would cost us littl support this. goe `runtime/debug.setgcpercent`.
> thank lot, g.
thank suggestions!
propos ad activ column propos project
review weekli propos review meetings.
â€” rsc propos review group
ping @mknyszek. new thoughts?
pleas consid export total time spent perfom gc well (`work.totaltime` similar). would use process `gccpufraction` current provid `runtime.memstats`
@mpx alreadi ahead one. `gccpufraction` intent miss `runtime/metrics` issu it. instead, hope export distribut gc cpu util gc cycle. still preprocessed, given api sample-bas rather event-based, think best moment.
total work time also seem fine me, though seem quit use without "total cpu time" counter also (sampl together, take diff determin gc cpu util sinc last sample). could expos someth like that, measur exact cpu time unfortun kind tough. runtim make assumpt luckili hold true 99% (mayb more) cases. might use export assumpt anyway, think aforement distribut gc cpu time directli use monitor (and includ assumptions, necessarily, anyway).
anoth use-cas total time considering?
hi all, thank effort invest issue. telemetri consum telemetry, use extern librari measur total cpu usag process. sure right place discuss it. limit solut present?
thank gil
alrighty, issue, think add follow metrics:
1. `gomaxprocs`
2. total gc cpu time.
3. `numcgocall`.
think there' point `version` `numcpu` static. export (to whatev system) want them. seem unnecessari "resample" regularli via `runtime/metrics` api, though good use-case, open hear it.
objections?
base discuss above, propos seem like **like accept**.
â€” rsc propos review group
@mknyszek total gc time like compar `rusage` understand whether task gc heavi without need profil machineri (which inaccurate/mor involv ways). understand can't sampl simultaneously, error small, becom rel smaller lifetim process.
record histogram gc time would interesting, specif use atm.
chang consensus, **accepted**. ðŸŽ‰
