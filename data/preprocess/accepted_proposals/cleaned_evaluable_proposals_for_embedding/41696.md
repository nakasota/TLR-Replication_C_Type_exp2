cmd/go: deprec -i flag
`go build`, `go install`, `go test` accept `-i` flag. `go help build`:
> -i flag instal packag depend target.
example, run `go build -i example.com/a`, `example.com/x` import `example.com/y`, `go build` instal file `$gopath/pkg/$goos_$goarch/example.com/y.a`.
use speed build go 1.10, sinc previous instal packag need recompiled. `go build` re-us packag instal `$gopath/pkg`.
go 1.10 introduc build cache, `$gopath/pkg` directori larg obsolete. compil packag store `$gocache`. `-i` flag mere copi file build cache, there' longer perform advantage.
`-i` caus error target directori writable, #37962. issue, vscode instal tool `-i`, caus error `$goroot/pkg` writabl (common go instal system-wid installer). someth caus `runtime/cgo` recompil (perhap new `clang` version flag), written `$goroot/pkg/darwin_amd64/runtime/cgo.a`.
problems, consid deprec eventu remov `-i` flag.
cc @bcmill @matloob @rsc
object this? see plenti emoji favor noth else.
potenti object break peopl learn use `go build -i` year ago, perhap introduc flag build ci scripts. eventu remov support `-i` come clear deprec warn releas changelog least one two releas then.
@mvdan, yes, deprec remov mean releas print warn -i go away follow actual remov next release.
base discuss above, seem like **like accept**.
clear, go 1.16 would warn flag use (but still complet successfully), go 1.17 would remov flag.
chang consensus, accepted.
chang mention issue: `cmd/go: print deprec messag -i`
chang mention issue: `cmd/go: updat test_race_instal expect output cl 266368`
occur sometim still use `go test -i -v ./...` see packag built advanc run tests.
guess move `go test -run=- -v ./...` nowadays, thought point reason use case.
@mvdan, way use `-c` flag get inform want?
(perhap `go test -c -v -o /dev/nul ./...`?)
seem like use `-c` mani packag once, make sense.
clarity, like `go test -i -v ./...` could see stream packag built. use `go test ./...` suddenli seem take long time start run tests, exampl someon add larg cgo depend like go-sqlite3. see stream packag built, one would see progress stuck packag ten seconds, pretti clear signal.
mayb better way inspect what' bottleneck go build :) there' `go list -test -dep ./...`, simpli list packages, perform build tell packag slowest build.
`go list -test -export -v ./...` pretti close, though; `-export` mean build packages, `-test` pull test deps, `-v` print packag built.
> mayb better way inspect what' bottleneck go build
mayb `-debug-trace` (#38714)?
chang mention issue: `cmd/go,cmd/link: check stale tests`
chang mention issue: `cmd/go: remov -i build flag`
chang mention issue: `doc/go1.20: add releas note cmd/go changes`
