cmd/go: 'go install' instal execut modul mode outsid modul
authors: jay conrod, daniel martí
last updated: 2020-09-29
design doc: cl 243077
comment cl prefer comment issue.
## abstract
author execut need simple, reliable, consist way user
build instal exectu modul mode without updat modul
requir current module' `go.mod` file.
## background
`go get` use download instal executables, also respons
manag depend `go.mod` files. caus confus
unintend side effects: example, command
`go get golang.org/x/tools/gopls` build instal `gopls`. there'
`go.mod` file current directori parent, command also add
requir modul `golang.org/x/tools/gopls`, usual
intended. `go111module` set, `go get` also run gopath mode
invok outsid module.
problem lead author write complex instal command as:
```
(cd $(mktemp -d); GO111MODULE=on go get golang.org/x/tools/gopls)
```
## propos
propos augment `go install` command build instal packag
specif versions, regardless current modul context.
```
go install golang.org/x/tools/gopls@v0.4.4
```
elimin redund confusion, also propos deprec remov
`go get` function build instal packages.
### detail
new `go install` behavior enabl argument version
suffix like `@latest` `@v1.5.2`. currently, `go install` allow
version suffixes. version suffix used:
* `go install` run modul mode, regardless whether `go.mod` file
present. `go111module=off`, `go install` report error, similar
`go mod download` modul command do.
* `go install` act `go.mod` file present current directori
parent directory.
* modul consid "main" module.
* error report case ensur consist version
depend use user modul authors. see rational below.
* command line argument must meta-pattern (`all`, `std`, `cmd`)
local directori (`./foo`, `/tmp/bar`).
* command line argument must refer main packag (executables).
argument wildcard (`...`), match main packages.
* command line argument must refer packag one modul specif
version. version suffix must identical. version
instal packages' depend determin module' `go.mod`
file (if one).
* modul `go.mod` file, must contain direct
would caus interpret differ modul main
module. particular, must contain `replace` `exclude`
directives.
`go install` argument without version suffixes, behavior
change. oper context main module. run modul mode
outsid module, `go install` report error.
restrictions, user instal execut use consist commands.
author provid simpl instal instruct without worri
user' work directory.
change, `go install` would overlap `go get` even more, also
propos deprec remov abil `go get` instal packages.
* go 1.16, `go get` invok outsid modul `go get`
invok without `-d` flag argument match one main
packages, `go get` would print deprec warn recommend
equival `go install` command.
* later releas (like go 1.17), `go get` would longer build instal
packages. `-d` flag would enabl default. set `-d=false` would
error. `go get` invok outsid module, would print error
recommend equival `go install` command.
### exampl
```
# Install a single executable at the latest version
$ go install example.com/cmd/tool@latest
# Install multiple executables at the latest version
$ go install example.com/cmd/...@latest
# Install at a specific version
$ go install example.com/cmd/tool@v1.4.2
```
## current `go install` `go get` function
`go install` use build instal packag within context
main module. `go install` report error invok outsid modul
given argument version queri like `@latest`.
`go get` use updat modul depend `go.mod`
build instal executables. `go get` also work differ depend
whether invok insid outsid module.
overlap respons lead confusion. ideally, would one
command (`go install`) instal execut one command (`go get`)
chang dependencies.
currently, `go get` invok outsid modul modul mode (with
`go111module=on`), primari purpos build instal executables.
configuration, main module, even one modul provid
packag name command line. build list (the set modul version
use build) calcul requir `go.mod` file modul
provid packag name command line. `replace` `exclude` direct
modul ignored. vendor directori also ignored.
`go get` invok insid module, primari purpos updat
requir `go.mod`. `-d` flag often used, instruct `go get`
build instal packages. explicit `go build` `go install` command
often better instal tool depend version specifi
`go.mod` updat desired. like build commands, `go get` load
build list main module' `go.mod` file, appli `replace`
`exclude` direct find there. `replace` `exclude` direct
modules' `go.mod` file never applied. vendor directori main modul
modul ignored; `-mod=vendor` flag allowed.
motiv current `go get` behavior make usag modul
mode similar usag gopath mode. gopath mode, `go get` would download
repositori miss packag `$gopath/src`, build instal
packag `$gopath/bin` `$gopath/pkg`. `go get -u` would updat
repositori latest versions. `go get -d` would download repositori
without build packages. modul mode, `go get` work requir
`go.mod` instead repositori `$gopath/src`.
## rational
### can't `go get` clone git repositori build there?
modul mode, `go` command typic fetch depend
proxy. modul distribut zip file contain sourc specif
modul versions. even `go` connect directli repositori instead
proxy, still gener zip file build work consist matter
modul fetched. zip file contain nest modul vendor
directories.
`go get` clone repositories, would work differ build
commands. caus sever problems:
* add complic (and bugs!) `go` command support new build
mode.
* creat work authors, would need ensur program
built `go get` `go install`.
* reduc speed reliabl users. modul may avail
proxi origin repositori unavailable. fetch modul
proxi roughli 5-7x faster clone git repositories.
### can't vendor directori used?
vendor directori includ modul zip files. sinc
present modul downloaded, there' way build them.
plan includ vendor directori zip file futur
either. chang set file includ modul zip file would break
`go.sum` hashes.
### can't directori `replace` direct used?
example:
```
replace example.com/sibling => ../sibling
```
`replace` direct directori path right side can't use
directori must outsid module. directori can't
present modul downloaded, there' way build them.
### can't modul `replace` direct used?
example:
```
replace example.com/mod v1.0.0 => example.com/fork v1.0.1-bugfix
```
technic possibl appli directives. this, would
still want restrictions. first, error would report one
modul provid packag name command line: must abl identifi
main module. second, error would report directori `replace`
direct present: want introduc new configur
`replace` direct appli other silent ignored.
however, two reason avoid appli `replace` direct all.
first, appli `replace` direct would creat inconsist user insid
outsid module. packag built within modul `go build`
`go install`, `replace` direct main modul applied,
modul provid package. packag built outsid modul
`go get`, `replace` direct applied. `go install` appli `replace`
direct modul provid package, would consist
current behavior build command. elimin confus
whether `replace` direct applied, propos `go install`
report error encount them.
second, `go install` appli `replace` directives, would take power away
develop depend modul provid tools. example, suppos
author popular code gener tool `gogen` fork depend
`genutil` add feature. add `replace` direct point
fork `genutil` wait pr merge. user `gogen` want
track version use `go.mod` file ensur everyon
team use consist version. unfortunately, longer build `gogen`
`go install` `replace` ignored. author `gogen` might
instruct user build `go install`, user can't track
depend `go.mod` file, can't appli `require`
`replace` direct upgrad fix transit dependencies. author
`gogen` could also instruct user copi `replace` directive,
may conflict `require` `replace` directives, may
caus similar problem user downstream.
### report error instead ignor `replace`?
`go install` ignor `replace` directives, would consist
current behavior `go get` invok outsid module. however,
#30515 relat discussions, found
mani develop surpris behavior.
seem better explicit `replace` direct appli
local within modul develop user build packag
outsid module. like encourag modul author releas
version modul reli `replace` direct user
modul may depend easily.
behavior turn suitabl (for example, author prefer
keep `replace` direct `go.mod` releas version understand
affect users), could start ignor `replace` direct
future, match current `go get` behavior.
### `go.sum` file checked?
main module, `go install` use `go.sum` file
authent download modul `go.mod` file. `go` command still
use checksum databas (sum.golang.org)
authent downloads, subject privaci settings. consist
current behavior `go get`: invok outsid module, `go.sum` file
used.
new `go install` command requir one modul may provid packag
name command line, may logic use module' `go.sum`
file verifi downloads. avoid problem
#28802, relat propos verifi download
`go.sum` file dependencies: build can't broken one bad
`go.sum` file dependency.
however, use `go.sum` modul name command line
provid margin secur benefit: let us authent privat modul
depend (those avail checksum database) modul
command line public. modul name command line privat
checksum databas used, can't authent download
content (includ `go.sum` file), must trust proxy.
depend public, authent download without `go.sum`.
### requir version suffix outsid module?
version suffix requir `go install` invok outsid
module, mean command would depend whether user'
work directori insid module. example:
```
go install golang.org/x/tools/gopls
```
invok outsid module, command would run `gopath` mode,
unless `go111module=on` set. modul mode, would instal latest
version executable.
invok insid module, command would use main module' `go.mod`
file determin version modul need build package.
current similar problem `go get`. requir version suffix
make mean `go install` command unambiguous.
### `-g` flag instead `@latest`?
instal latest version executable, two command would
equivalent:
```
go install -g golang.org/x/tools/gopls
go install golang.org/x/tools/gopls@latest
```
`-g` flag advantag shorter common use case. however,
would use instal latest version package, sinc
`-g` would impli version suffix.
`@latest` suffix clearer, impli command
time-depend reproducible. prefer reasons.
## compat
`go install` part propos appli command version
suffix argument. `go install` report error these,
propos recommend chang function `go install`,
part propos backward compatible.
`go get` part propos recommend deprec remov
functionality, certainli backward compatible. `go get -d` command
continu work without modif though, eventually, `-d` flag
dropped.
part propos strict technic necessari (for
example, requir one module, forbid `replace` directives). could relax
restrict without break compat futur seem
expedient. would much harder add restrict later.
## implement
initi implement featur merg
cl 254365. pleas tri
out!
## futur direct
behavior respect `replace` direct discuss extens
propos written. three potenti behaviors:
1. ignor `replace` direct modules. would consist
module-awar commands, appli `replace` direct
main modul (defin current directori parent directory).
`go instal pkg@version` ignor current directori `go.mod`
file might present, main module.
2. ensur one modul provid packag name command line,
treat modul main module, appli modul `replace`
direct it. report error directori `replace` directives.
feasible, may wider ecosystem effects; see "whi can't modul
`replace` direct used?" above.
3. ensur one modul provid packag name command line,
report error `replace` direct contains. behavior
current proposed.
peopl involv discuss advoc either (1) (2).
behavior (3) compromise. find behavior (1)
strictli better (2) vice versa, switch behavior
(3) without incompat change. additionally, (3) elimin
ambigu whether `replace` direct appli user modul
authors.
note appli directori `replace` direct consid
reason "whi can't directori `replace` direct used?".
## appendix: faq
### appli `replace` direct modules?
short, `replace` direct differ modul would conflict,
would make depend manag harder users.
example, consid case two depend replac modul
differ forks.
```
// in example.com/mod/a
replace example.com/mod/c => example.com/fork-a/c v1.0.0
// in example.com/mod/b
replace example.com/mod/c => example.com/fork-b/c v1.0.0
```
anoth conflict would occur two depend pin differ version
module.
```
// in example.com/mod/a
replace example.com/mod/c => example.com/mod/c v1.1.0
// in example.com/mod/b
replace example.com/mod/c => example.com/mod/c v1.2.0
```
avoid possibl conflict, `go` command ignor `replace`
direct modul main module.
modul intend scale larg ecosystem, order upgrad
safe, fast, predictable, rule must followed, like semant
version import compatibility.
reli `replace` one rules.
### modul author avoid `replace`?
`replace` use sever situat local short-term development,
example:
* chang multipl modul concurrently.
* use short-term fork depend chang merg upstream.
* use old version depend new version broken.
* work around migrat problems, like `golang.org/x/lint` import
`github.com/golang/lint`. mani problem fix lazi
modul load (#36460).
`replace` safe use modul depend modules.
also safe use revis depend modules.
* `replace` direct meant temporari local develop one
person, avoid check in. `-modfile` flag may use build
altern `go.mod` file. see also
#26640 featur request
`go.mod.local` file contain replac local modifications.
* `replace` direct must check fix short-term problem,
ensur least one releas pre-releas version tag check
in. tag new releas version `replace` check (pre-releas
version may okay, depend used). `go` command
look new version modul (for example, run `go get`
version specified), prefer releas versions. tag version let
continu develop main branch without worri user
fetch arbitrari commits.
* `replace` direct must check solv long-term problem,
consid solut caus issu depend modules. possible,
tag version releas branch `replace` direct removed.
### would `go install` reproducible?
new `go install` command build execut set
modul version everi invoc follow condit true:
* specif version request command line argument, example,
`go instal example.com/cmd/foo@v1.0.0`.
* everi packag need build execut provid modul requir
directli indirectli `go.mod` file modul provid
executable. execut import standard librari packag
packag module, `go.mod` file necessary.
execut may bit-for-bit reproduc reasons. debug
inform includ system path (unless `-trimpath` used). packag
may import differ packag differ platform (or may build all).
instal go version c toolchain may also affect binari
reproducibility.
### happen modul depend newer version itself?
`go install` report error, `go get` alreadi does.
sometim happen two modul depend other, releas
tag main branch. command like `go get example.com/m@master`
resolv `@master` pseudo-vers lower releas version.
`go.mod` file pseudo-vers may transit depend newer
releas version.
`go get` report error situation. general, `go get` report
error command line argument differ version module,
directli indirectly. `go install` support yet,
one condit check run version suffix arguments.
## appendix: usag replac direct
proposal, `go install` would report error `replace` direct
modul provid packag name command line. `go get` ignor these,
behavior may still surpris modul author users. tri
estim impact exist set open sourc modules.
* start list 359,040 `main` packag russ cox built
earlier study.
* exclud packag path indic homework, examples,
tests, experiments. 187,805 packag remained.
* these, took random sampl 19,000 packag (about 10%).
* belong 13,874 modules. module, download "latest"
version `go get` would fetch.
* discard repositori fork retrieved. 10,618
modul left.
* discard modul `go.mod` file. 4,519 left.
* these:
* 3982 (88%) use `replace` all.
* 71 (2%) use directori `replace` only.
* 439 (9%) use modul `replace` only.
* 27 (1%) use both.
* set 439 `go.mod` file use modul `replace` only, tri
classifi `replace` used. modul may multipl `replace`
direct multipl classifications, percentag add
100%.
* 165 use `replace` soft fork, example, point bug fix pr
instead origin module.
* 242 use `replace` pin specif version depend (the modul
path sides).
* 77 use `replace` renam depend import anoth
name, example, replac `github.com/golang/lint` correct path,
`golang.org/x/lint`.
* 30 use `replace` renam `golang.org/x` repo
`github.com/golang` mirrors.
* 11 use `replace` bypass semant import versioning.
* 167 use `replace` `k8s.io` modules. kubernet use `replace`
bypass mvs, depend modul forc same.
* 111 modul contain `replace` direct automat
classify. one look seem mostli fork pins.
modul concern use `replace` soft fork
submit bug fix upstream module; problem
solut think need design here. modul use soft fork
replac 4% modul `go.mod` file sampl (165
/ 4519). small enough set think move forward
propos above.
chang mention issue: `design: add 40276-go-get-b.md`
thank proposal!
> * `go get` act `go.mod` file present current directori
> parent directory.
> * modul consid "main" module.
would also accur say go.mod use main modul modul built rather "main" module? error replac simpli consequ implement prevent replac respect consid modul "main". intent main module, one might expect replac ignor like go get today outsid module. regardless `go get -b` `go get` outsid modul end unifying, seem intent `go get -b` today build reproduc binari use packag modul main modul fail unabl so. know outcom here, think state intent help user know expect mode.
> * `-u` flag may use togeth `-b`. usual, `-u` upgrad modul
> provid packag import directli indirectli packag name
> command line
> go get use download instal executables, also respons
manag depend go.mod files. caus confus
unintend side effect
sinc `go get -b` distinct mode go get explicitli manag depend local go.mod, instinct `-u` option confus distinct use `go get` build binari vs manag dependencies. least know scenario would want build project updat depend view work go.mod afterword. someth like would alway repo clone alreadi build previous unus combin depend project would probabl also want run test mayb downgrad certain depend necessary.
> would also accur say go.mod use main modul modul built rather "main" module? error replac simpli consequ implement prevent replac respect consid modul "main". intent main module, one might expect replac ignor like go get today outsid module. regardless go get -b go get outsid modul end unifying, seem intent go get -b today build reproduc binari use packag modul main modul fail unabl so. know outcom here, think state intent help user know expect mode.
that' quit intent: actual main module.
earlier iter #30515, suggest `go get -b` would act `go get`, would ignor `go.mod` current directory: would ignor `replace`. mani peopl found unintuit though. seem like eventu consensu `go get -b` report error there' one modul command line `replace` directives. way, build binari whether it's: use `go build` insid modul provid executable, use `go get` outsid module, use `go get -b` anywhere.
> sinc go get -b distinct mode go get explicitli manag depend local go.mod, instinct -u option confus distinct use go get build binari vs manag dependencies. least know scenario would want build project updat depend view work go.mod afterword. someth like would alway repo clone alreadi build previous unus combin depend project would probabl also want run test mayb downgrad certain depend necessary.
use `-u` here: let build instal execut updat dependencies. `go get -u` alreadi run outsid module. expect common, get free, think there' good reason break it.
> consensu `go get -b` report error there' one modul command line `replace` directives. way, build binari whether it's: use `go build` insid modul provid executable, use `go get` outsid module, use `go get -b` anywhere.
think page regardless!
base discuss slack, like take differ direction, updat cl 243077 copi above.
instead ad `go get -b`, `go install` would propos function invok argument version suffix. exampl command would instal gopl v0.4.4. could run directori would ignor modul current directori one.
go instal golang.org/x/tools/gopls@v0.4.4
`go get` would longer build instal packages. would use chang dependencies.
ptal comment cl 243077 thoughts. would signific change, would good clear separ respons `go get` `go install`.
chang mention issue: `cmd/go: implement 'go instal pkg@version'`
@jayconrod
move convers #40728, stick point agre here: :100:
call insid module, current behavior `tip` great refer module-loc packag path, refer non-loc packag path `go instal package` behav `go instal package@latest`, consist module-rel commands.
@abursavich coupl signific problem approach. would break current `go install` behavior, would inconsist build command (`go build`, `go run`, on).
confus two variant `go install`, instead chang semant `go instal pkg`, think best way resolv would remov `go instal pkg` allow `go instal pkg@version`. seem like disrupt chang me, curiou hear opinions.
think import keep `go instal pkg` module-loc packages, particularli sinc replac direct go ignor `@version`... realli want drop consist hammer, `go get` requir explicit `@version` add updat specif packag module-awar mode.
gonna withdraw comment step way progress. leav like tip :)
late roll back whole "global instal command" thing completely? feel like way impel rather ecosystem all. think origin impetu behind approxim everyon readm file said "use go get instal this" modul mode bunch weird things.
point live without 2 years, readm changed, commun adapted, still need it? go ~100% thing `git clone && go build` net good net negative?
side effect way implement discourag applic use replac directives, heavily, get adopt commun default way instal applications. strang replac direct languag tool discourag use them. design settl replac direct get deprec warn documentation. imho replac direct fact useful, use global instal command, can't accomod mayb global instal command go away.
> late roll back whole "global instal command" thing completely?
propos formal accept yet. however, think there' pretti firm consensu move forward 1.16. lack global instal command signific usabl problem, mani peopl ask someth solv problem.
> point live without 2 years, readm changed, commun adapted, still need it?
think commun adapted. mani instruct seen recommend chang directori outsid module, run `go get` either gopath mode explicit `go111module=on`. think need convenient, consist way instal tools.
> go ~100% thing git clone && go build net good net negative?
modul mode, would unexpect behavior. go command usual fetch depend proxy. even `direct` mode, fetch whole repository. discuss design doc.
> side effect way implement discourag applic use replac directives, heavily, get adopt commun default way instal applications. strang replac direct languag tool discourag use them. design settl replac direct get deprec warn documentation.
`replace` deprecated, there' issu use development.
`replace` discourag *in releas versions* modul may depend on. `replace` direct appli main module; ignor `go install` `go get` anoth modul outsid modules. lead subtl differ select version depend command issu where. felt report error prefer ambiguity.
also discuss design doc length previou discuss #30515.
> point live without 2 years, readm changed, commun adapted, still need it?
agre jayconrad peopl realli adapt switch modul made thing confus `go install` `go get` think big win tool clarity.
> go ~100% thing `git clone && go build` net good net negative?
also think anyth build binari `git clone && go build` what expected. howev *really* import part chang `go install` refus build modul replac direct error rather ignor it. build replac direct intuit want `go install` error encount right thing instead. relat limitation, `go install` much faster `git clone && go build`. chang `go get` would ignor replac build extern binari think chang bring closer want.
want give extra emphasi disadvantag `git clone && [...]` @jayconrod alreadi mentioned. use vc repositori directli is:
* slower, sinc download lot (modul zip gener much smaller)
* less reliable, sinc can't make use modul proxi
* future-proof, sinc modul might chang vc repo point without chang modul path
> > late roll back whole "global instal command" thing completely?
>
> propos formal accept yet. however, think there' pretti firm consensu move forward 1.16. lack global instal command signific usabl problem, mani peopl ask someth solv problem.
disagre this, fact would also like global instal command. problem dislik way implement would like global install.
> > go ~100% thing git clone && go build net good net negative?
>
> modul mode, would unexpect behavior. go command usual fetch depend proxy. even `direct` mode, fetch whole repository. discuss design doc.
disagree, think would expect behavior current behavior go command actual regression. `go get` use repositori clone.
address "whi can't go get clone git repositori build there?" list problems:
> add complic (and bugs!) go command support new build mode.
new build mode, would build mode execut `go build` root directori project. would add altern way download project (which use exist previously).
> creat work authors, would need ensur program built go get go install.
realiti code develop run `go build` clone normal, inevitable, way development. add work author introduc new way download code ignor replac direct vendor directories. solut also fix `go get` build execut `git clone && go build`.
> reduc speed reliabl users. modul may avail proxi origin repositori unavailable. fetch modul proxi roughli 5-7x faster clone git repositories.
conced valid point, howev correct import performance.
speak unexpect behavior, think respect replac direct far unexpect behavior chang detail modul download internet.
> > side effect way implement discourag applic use replac directives, heavily, get adopt commun default way instal applications. strang replac direct languag tool discourag use them. design settl replac direct get deprec warn documentation.
>
> `replace` deprecated, there' issu use development.
>
> `replace` discourag _in releas versions_ modul may depend on. `replace` direct appli main module; ignor `go install` `go get` anoth modul outsid modules. lead subtl differ select version depend command issu where. felt report error prefer ambiguity.
decid replac direct discourag releas versions? scan vgo blog seri current go modul refer can't find anyth suggest this.
>
> also discuss design doc length previou discuss #30515.
seem design doc previou discuss simpli argu consist patholog behavior `go get` use build executables, think point ad global instal command would fix problem entrench them.
@aarzilli, want user instal use `git clone && go build`, tell — ad `go instal pkg@version` remov diminish option; also promot option give concis shorthand.
@aarzilli want reiter share much perspective: current `go get` *ignore* replac directives. chang anymor (sinc dep management). now, `go install` instead *error* replac direct indic `git cloning` build it. refus build global binari altern dep graph, good!
> decid replac direct discourag releas versions? scan vgo blog seri current go modul refer can't find anyth suggest this.
see
> [w]hat want avoid, ecosystem fragmented, split group packag can’t work other.
`replace` direct inher fragment ecosystem. indicate: “use variant select modul instead version everyon els sees”, replac often incompat other. fine tool experimentation, case reason short-term option work around problem negoti fix work everyone, line principl cooperation.
@mvdan disagre would nice use goproxi this, *can be*? judg list caveat accompani design impress can't, current state.
@peeb agreed, make `go get` error replac direct good thing. like anyth else. propos becom "go get error encount replac directive" 100% behind it.
@bcmill `go install` becom default commun meme instal tool antisoci use it. besid "just use like it" fulli gener answer proposal, rule land almost propos could accepted. could like c++: everything' use part like.
> `replace` direct inher fragment ecosystem
disagree. thing executable, mani incompat replac direct want differ execut without interoper problems. belief go team document replac chang reflect that.
@mvdan
> use vc repositori directli is:
>
> - slower, sinc download lot (modul zip gener much smaller)
use `git clone --depth=1` want vc history.
also download zip tar github, think zip somehow inher better git.
history. repositori contain mani modules, somewhat common. modul zip strip directori file part set go packages.
@aarzilli pretti much major point bring alreadi cover current proposal, mainli "rationale" "faq" sections. simpli disagre conclusions, would almost suggest write compet proposal, essenti suggest someth entir different.
agre problem need solving, see point stop declin propos (which almost entir posit feedback) unless equal well thought-out compet propos consid instead.
> disagree. thing executable, mani incompat replac direct want differ execut without interoper problems. belief go team document replac chang reflect that.
part rational propos abl instal execut either within depend modul (appli constraint `replace` direct module) global (without main module). former case import tool like code gener analyz might need specif version modifications.
honor `replace` direct latter case, modul author reli heavili `replace` directives, make former case non-viable. think that' accept tradeoff serv cases.
also can't honor directori `replace` direct all. someth download modul cache, rel absolut system anoth repositori meaningful. honor *some* `replace` direct other add much complication.
one point download vc directly: complet step outsid modul system download code (which what' suggested), much slower (typic 5-7x, even `--depth=1`), also throw safety: there' `go.sum` file, without checksum database, guarante repositori send bit anyon else.
@mvdan believ refut point cover proposals, disagre rebutt would ask point error way rather simpli state wrong.
> simpli disagre conclusions, would almost suggest write compet proposal, essenti suggest someth entir different.
knowledg standard never appli proposal. exampl `try` propos reject without compet propos accepted.
@jayconrod
> part rational propos abl instal execut either within depend modul (appli constraint replac direct module) global (without main module). former case import tool like code gener analyz might need specif version modifications.
think bad idea solv problem introduc new one own. first strange, almost antithetical, global instal command behavior depend current directory. secondly, let' make example. let' say build modul need code generator, let' call goblah. direct one sourc files:
```
//go:generate goblah -some -options
```
add go.mod following:
```
require github.com/blahworld/goblah v31.0.0
```
think enough keep track goblah tool dependency. simpli tell contributor run `go generate` work, go gener automat instal depend version goblah happen path, that' used, regardless version built. peopl could even end use odiou version 29.0.3.
soon enough write gen.sh script like this:
```
#!/bin/bash
go-global-install github.com/blahworld/goblah && go generate
```
(i'm use go-general-instal placehold whatev name global instal be). two problems:
1. much better write version insid gen.sh directli
2. go overrid user' choic version global installed, mayb user realli need version 29.0.3
what' realli need command download extern tool, build specifi go.mod file execut it. let' call command `go mod execute-ext-tool`, go:gener direct could chang to:
```
//go:generate go mod execute-ext-tool goblah -some -options
```
way could ensur build never soil goblah version 31.0.0 user keep live 29.0.3 sin.
> one point download vc directly: complet step outsid modul system download code (which what' suggested),
that' suggesting. suggest whatev implement behav *a if* `git clone && go build` almost 100% time. exampl go-global-instal could request special version goproxy, format: `github.com/blahworld/goblah@main:v31.0.0`, goproxi would know prepar serv archiv work directori retriev repositori version 31.0.0. archiv could checksum similar way conflict `goblah@v31.0.0` due differ namespace.
implement detail import principl behav *a if* `git clone && go build` almost 100% time.
fwiw, person take think non-filepath `replace` direct support `go instal cmd/foo@v1.2.3`.
decent percentag larg & frequent use open sourc go project `replace` direct go.mod files. differ reasons, open sourc fundament messy, take time upstream fix otherwis resolv issues.
`go instal cmd/foo@v1.2.3` cannot use non-filepath `replace`, hint `go install` / `go get` scale larg projects, seem odd overal philosophi go project.
`replace` discussion, think peopl suggest tension between:
1. peopl want use tool publish tool author (e.g., includ `replace` directives).
vs.
2. peopl want track dependencies.
discussion, peopl think suggest support `replace` `go instal cmd/foo@v1.2.3` current propos make easier consum track tool dependencies.
end realli true higher percentag project resolv limit choos still use `replace` pick anoth distribut mode (publish binaries, instal script, git commands, similar). altern distribut mode play well `tools.go` approach.
one certainli debat happen frequent term propos "no replace" limit get resolved:
(a) way **does** play well `tools.go` approach, vs.
(b) way **doe not** play well `tools.go` approach (e.g., publish binari similar).
personally, guess "no replace" limit push largest often consum project toward (b) higher frequenc (a). minimum, publish choos (b) eat benefit deliv (a).
also, whenev someon choos separ distribut mode (binaries, instal script, git, ...), also neg ecosystem impacts, includ side-step "secur go ecosystem" work checksum db, happen occur almost worst point deliveri chain -- point consumpt ultim end user.
> @peeb agreed, make `go get` error replac direct good thing. like anyth else. propos becom "go get error encount replac directive" 100% behind it.
@aarzilli absolut make sure page (apolog alreadi clear): *is* current propos (after much debate, included) except call `go install`. origin propos `go get -b` would ignor replace, `go install` error.
also *potentially* open door road respect *some* replac direct without break changes. sinc error would right thing.
@peeb propos is:
> propos augment go instal command build instal packag
specif versions, regardless current modul context.
> go instal golang.org/x/tools/gopls@v0.4.4
> elimin redund confusion, also propos deprec remov
go get function build instal packages.
object way first part (go instal change) designed. fine second part also fine chang `go install` global instal command, long behavior approxim `git clone && go build`.
@aarzilli
> believ refut point cover proposals, disagre rebutt would ask point error way rather simpli state wrong.
refer back design doc coupl place point cover already.
point expect behavior think matter opinion. cover lot opinions, propos compromise.
> think bad idea solv problem introduc new one own.
win this.
> first strange, almost antithetical, global instal command behavior depend current directory.
*doesn't* depend current directory. that' point. want instal execut without modifi `go.mod` file current directori chang anoth directory, chang anoth directori anymore.
> secondly, let' make example. let' say build modul need code generator, let' call goblah. ...
*wouldn't* use new function situation. would use instal tool specif relat project like gopl goimports.
exampl mostli work today, tri keep work encourag widespread use `replace`.
use `go run` avoid instal execut directly:
```
//go:generate go run example.com/tool
```
script non-glob `go install`:
```
#!/bin/bash
GOBIN=bin go install example.com/tool1 example.com/tool2 # versions come from our go.mod
bin/tool1
bin/tool2
```
`go build`:
```
#!/bin/bash
go build -o bin/ example.com/tool1 example.com/tool2 # versions come from our go.mod
bin/tool1
bin/tool2
```
command work consistently. use `go.mod` current modul select versions.
> what' realli need command download extern tool, build specifi go.mod file execut it. let' call command go mod execute-ext-tool, go:gener direct could chang to:
describ `go run`. work today, though littl slow cach link binary. improv that.
propos meant address use case.
> that' suggesting. suggest whatev implement behav git clone && go build almost 100% time. exampl go-global-instal could request special version goproxy, format: github.com/blahworld/goblah@main:v31.0.0, goproxi would know prepar serv archiv work directori retriev repositori version 31.0.0. archiv could checksum similar way conflict goblah@v31.0.0 due differ namespace.
import differ modul zip file contain file one module, modul repository. directori `replace` direct alway point outsid current module, commonli modul repository, sometim complet differ repositories. that' can't honor them.
even pack modul singl zip file suggesting, make directori replac work time.
@jayconrod
> depend current directory. that' point. want instal execut without modifi go.mod file current directori chang anoth directory, chang anoth directori anymore.
does. go look go.mod file that' either current directori parent directori look version replac there.
> use new function situation. would use instal tool specif relat project like gopl goimports.
ok, even mention proposal? clearli track tool depend influenc design global instal command.
> import differ modul zip file contain file one module, modul repository.
yes. current modul zip like this. work global instal command, differ type archiv need added.
> directori replac direct alway point outsid current module, commonli modul repository, sometim complet differ repositories. that' can't honor them.
why? go get abil recurs download depend already. download `@main:version` archive, unpack run `go build` insid it. realli sure what' imposs this.
> even pack modul singl zip file suggesting, make directori replac work time.
circumst would work? clearli `..` replac point outsid repositori work nobodi expect work match behavior `git clone && go build` anyway.
@aarzilli
> does. go look go.mod file that' either current directori parent directori look version replac there.
no. propos says:
* go instal run modul mode, regardless whether go.mod file
present. go111module=off, go instal report error, similar
go mod download modul command do.
* go instal act go.mod file present current directori
parent directory.
* modul consid "main" module.
> ok, even mention proposal? clearli track tool depend influenc design global instal command.
mention design constraint. introduc new feature, want chang ecosystem way break exist usage.
section "whi can't modul replac direct used?" discuss this: includ exampl similar one gave earlier.
> yes. current modul zip like this. work global instal command, differ type archiv need added.
...
> circumst would [directori replacements] work?
directori replac outsid current repository. absolut path replacement.
even could honor replac though, think reason honor modul replacements: use widely, prevent modul depend modul provid tools.
