=== Fetching Proposal: I_kwDOAWBuf85Gkn9P ===
Issue URL: https://github.com/golang/go/issues/51994

==== [Issue Title] ====
x/crypto/ssh: add ServerConfig.NoClientAuthCallback

==== [Issue Body] ====
Currently Go's SSH package doesn't permit a server to conditionally permit auth type "none" at runtime. There's a `NoClientAuth bool` flag to globally enable it, but you can't decide as a function of the `ConnMetaData` (username, IPs, etc) whether to permit it.

I propose adding a `ServerConfig.NoClientAuthCallback` auth hook, with a signature like the existing auth hooks:

```go
        // NoClientAuthCallback, if non-nil, is called when a user
	// attempts to authenticate with auth method "none".
	// NoClientAuth must also be set to true for this be used, or
	// this func is unused.
	NoClientAuthCallback func(ConnMetadata) (*Permissions, error)
````

I sent https://go-review.googlesource.com/c/crypto/+/395314 which @rolandshoemaker approved, but this is the proposal for the API change.

/cc @maisem 

==== [Comments] ====

--- Comment #1 by gopherbot ---
Change https://go.dev/cl/395314 mentions this issue: `ssh: add ServerConfig.NoClientAuthCallback`

--- Comment #2 by rsc ---
/cc @FiloSottile 

--- Comment #3 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
â€” rsc for the proposal review group


--- Comment #4 by rsc ---
/cc @golang/security 

--- Comment #5 by rsc ---
Does anyone object to adding this? It is a very small CL and Roland has already +2'ed it.


--- Comment #6 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
â€” rsc for the proposal review group


--- Comment #7 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. ðŸŽ‰
This issue now tracks the work of implementing the proposal.
â€” rsc for the proposal review group

