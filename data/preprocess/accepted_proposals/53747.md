=== Fetching Proposal: I_kwDOAWBuf85NaT57 ===
Issue URL: https://github.com/golang/go/issues/53747

==== [Issue Title] ====
flag: add BoolFunc(name, usage string, fn func(string)error)

==== [Issue Body] ====
Using flag.Func forces you to always pass an argument. Sometimes we don't really need an argument and its really convenient to be able to just call this flags without passing any dummy value.

Example:
Setting the flag --start-server will ask you to specify a value and also mentions it on the usage
 -start-server value
    	Starts the server



==== [Comments] ====

--- Comment #1 by mvdan ---
You mean that you want https://pkg.go.dev/flag#Bool?

--- Comment #2 by fnxpt ---
No, Im aware that bool exists, but if you need to have a function in a flag you need to always set a value... Im preparing a PR for this


--- Comment #3 by gopherbot ---
Change https://go.dev/cl/416514 mentions this issue: `flag: support func flags without arguments`

--- Comment #4 by fbiehl ---
This is a really welcome change!! 
Having immediate custom handling function as the flag is detected is very useful. 
Currently this is just not possible for flags that do not require a value.

--- Comment #5 by earthboundkid ---
I added flag.Func. I also wrote my own helper function that works like your proposal: https://pkg.go.dev/github.com/carlmjohnson/flagx#BoolFunc I‚Äôm not totally convinced it belongs in the standard library though. So far it has been less useful than I thought it would be. It‚Äôs only slightly more convenient than just using a flag.Bool. 

--- Comment #6 by fnxpt ---
For me it‚Äôs extremely useful since I‚Äôm delegating the responsibility of registering the flags to other packages and for that I have an interface kind of like a routing. So basically each package can contain n commands and each command has a function to handle it. Also as far as I understood from the existing code, it was written to allow more ‚ÄúboolFlag‚Äù types in the future¬†

--- Comment #7 by rsc ---
In the CL, it's not that there's no argument, it's that you must use =value.
In the flag package that's called a boolflag, like IsBoolFlag.
So if this goes in, it should be BoolFunc, right?



--- Comment #8 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
‚Äî rsc for the proposal review group


--- Comment #9 by earthboundkid ---
Should it be `BoolFunc(name, usage string, fn func() error)` or `BoolFunc(name, usage string, fn func())`?

--- Comment #10 by rsc ---
It should be func(string) error like the others, because you can say 

    cmd -name -name=true -name=false -name=auto

The same as a custom flag implementation that returns true from IsBoolFlag.

--- Comment #11 by rsc ---
Updated title. Does anyone object to adding this?


--- Comment #12 by fnxpt ---
Should I update the code to reflect these changes before the proposal review?

--- Comment #13 by seankhliao ---
While this can already be done via implementations that have `IsBoolFlag`, I'm not sure I'd appreciate this becoming more convenient/widespread given that you can pass an arbitrary value to it.
It leads to unintuitive/unpredictable CLIs with some flags that require an `=` to pass an argument.

--- Comment #14 by earthboundkid ---
I'm +0 on adding it. As I said, I have a version of this in my personal toolbox and so far I have been underwhelmed with how useful it is. On the other hand, it rounds out the functionality in a pretty clear way and it doesn't harm anything to have it. I do think though that if the callback signature ends up being `func(string) error`, I probably will keep using my version of the helper because I don't want to have to do the rigamarole to convert string to bool every time I use it.

--- Comment #15 by ianlancetaylor ---
@fnxpt Accepting or rejecting the proposal is independent of the sample implementation.  So, sure, update it, but no rush.

--- Comment #16 by rsc ---
It seems like this is missing and fills in a hole that people can fall into otherwise. So even though it's not going to be an everyday kind of function, it seems worth adding. 


--- Comment #17 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
‚Äî rsc for the proposal review group


--- Comment #18 by fnxpt ---
renamed the function to BoolFunc. Runned the tests and it fails on API check, in which file should I signature?

--- Comment #19 by earthboundkid ---
Read https://github.com/golang/go/blob/master/api/README

--- Comment #20 by fnxpt ---
Thanks @carlmjohnson 

--- Comment #21 by rsc ---

No change in consensus, so **[accepted](https://go.dev/s/proposal-status#accepted)**. üéâ
This issue now tracks the work of implementing the proposal.
‚Äî rsc for the proposal review group


--- Comment #22 by fnxpt ---
@rsc what are the next steps. There is already a PR with the changes mentioned

--- Comment #23 by earthboundkid ---
@fnxpt Do you want to update the PR to fix the merge conflict, or are you not working on this anymore?

--- Comment #24 by gopherbot ---
Change https://go.dev/cl/476015 mentions this issue: `flag: add BoolFunc; FlagSet.BoolFunc`

--- Comment #25 by gopherbot ---
Change https://go.dev/cl/499417 mentions this issue: `doc/go1.21: mention flag.BoolFunc`
