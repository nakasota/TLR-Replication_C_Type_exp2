=== Fetching Proposal: MDU6SXNzdWU4NjYzMTk0MzU= ===
Issue URL: https://github.com/golang/go/issues/45729

==== [Issue Title] ====
net: deprecate Temporary error status

==== [Issue Body] ====
The `net.Error` interface defines `Timeout` and `Temporary` methods:

```
type Error interface {
	error
	Timeout() bool   // Is the error a timeout?
	Temporary() bool // Is the error temporary?
}
```

The meaning of "timeout" is reasonably intuitive: Was an error returned because an operation ran past a deadline?

However, the meaning of "temporary" is not obvious. What makes an error temporary vs. permanent? Is `EHOSTUNREACH` temporary (because it may result from a temporary network routing error)? Is an operation that ran past a deadline permanent (because retrying the operation without extending the deadline will still fail)?

There is more discussion of `net.Temporary` in here, and in the following thread:
https://github.com/golang/go/issues/32463#issuecomment-506833421

Looking at existing places where the standard library returns an error which implements a `Temporary() bool` method returning true (not counting ones where the temporary status is propagated from a more-specific error):

Timeouts:

* [`context`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/context/context.go#167): `context.DeadlineExceeded`
* [`crypto/tls`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/crypto/tls/tls.go#105): All `Dial` timeouts.
* [`net`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/net/net.go#586): Various timeouts.
* [`net/http`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/net/http/transport.go#2501): Timeout when reading headers or bodies. (The error type is named `httpError`, but it is only used for timeouts.)
* [`net/http`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/net/http/h2_bundle.go#3398): Also, HTTP/2 timeout reading response headers.
* [`os`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/internal/poll/fd.go#51): `os.ErrDeadlineExceeded` (defined in `internal/poll`)

Non-timeouts:

* [`net`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/net/net.go#515): `ECONNRESET` and `ECONNABORTED` errors returned by `accept()`.
* [`net`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/net/cgo_unix.go#37): `EAI_AGAIN` errors returned by `getaddrinfo()`.
* [`syscall/syscall_plan9.go`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/syscall/syscall_plan9.go#71), [`syscall/syscall_unix.go`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/syscall/syscall_unix.go#139), [`syscall/syscall_js.go`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/syscall/syscall_js.go#78),[`syscall/syscall_windows.go`](https://go.googlesource.com/go/+/refs/tags/go1.16.3/src/syscall/syscall_windows.go#163):
`EINTR`, `EMFILE`, `ENFILE`, plus errors also considered timeouts: `EAGAIN`, `EWOULDBLOCK`, `EBUSY`, and `ETIMEDOUT`. (Some minor variation between operating systems.)

Ignoring cases where "temporary" is redundant with "timeout", the only "temporary" errors I can find are ones resulting from a small number of syscall errors. In most cases, "temporary" appears to mean "a timeout, or out of file descriptors". The documentation for `net.Error` does not make the limited scope of "temporary" errors obvious.

There are a number of other places in the standard library where errors propagate through the "temporary" status of another error. The existence of these `Temporary()` methods makes it seem (to me at least) as if temporary errors are more prevalent than they actually are.

Perhaps there is a useful definition of a "temporary" error. Perhaps we should provide a well-defined `os.ErrTemporary` or similar. That is not this proposal.

I believe that:

* We currently do not have a good definition of "temporary".
* Figuring out what errors implement `net.Error` and indicate a "temporary" status is difficult.
* The cases where `Temporary` does not imply `Timeout` are surprising and not particularly useful.

I propose that we deprecate the `Temporary` method:

```
type Error interface {
	error
	Timeout() bool   // Is the error a timeout?

	// Deprecated: Temporary errors are not well-defined.
	// Most temporary errors are timeouts, and the few exceptions are surprising.
	// Do not use this method.
	Temporary() bool
}
```

==== [Comments] ====

--- Comment #1 by bcmills ---
IMO the `Temporary` implementation for `context.DeadlineExceeded` is downright incorrect, and probably `os.ErrDeadlineExceeded` as well.

A ‚Äútemporary‚Äù error _ought_ to be one that could be resolved by retrying the same call _with exactly the same arguments_. However, if a `Context` has already passed its deadline and the call fails with `DeadlineExceeded`, retrying the same call with the same `Context` is almost certain to fail in the same way.

--- Comment #2 by neild ---
I agree, but this isn't specific to `context.DeadlineExceeded`: A non-retriable timeout has implied `Temporary` since the first CL introducing the interface. (https://go.googlesource.com/go/+/47a05334117) The definition of temporary has been confused from the start.

--- Comment #3 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
‚Äî rsc for the proposal review group


--- Comment #4 by rsc ---
It sounds like deprecate means "leave things alone, comment that it's not to be used, and stop discussing it".
That sounds great!



--- Comment #5 by gopherbot ---
Change https://golang.org/cl/322889 mentions this issue: `net: deprecate Temporary error status`

--- Comment #6 by rsc ---
Does anyone object to doing this?


--- Comment #7 by rsc ---

Based on the discussion above, this proposal seems like a **[likely accept](https://golang.org/s/proposal-status#likely-accept)**.
‚Äî rsc for the proposal review group


--- Comment #8 by rsc ---

No change in consensus, so **[accepted](https://golang.org/s/proposal-status#accepted)**. üéâ
This issue now tracks the work of implementing the proposal.
‚Äî rsc for the proposal review group


--- Comment #9 by gopherbot ---
Change https://golang.org/cl/340261 mentions this issue: `net: deprecate (net.Error).Temporary`

--- Comment #10 by cespare ---
It's not clear to me what the replacement is for Temporary inside server Accept loops (like [net/http.Server's](https://github.com/golang/go/blob/ab9d31da9e088a271e656120a3d99cd3b1103ab6/src/net/http/server.go#L3047-L3059)). Since this is closed, I [asked about it on golang-nuts](https://groups.google.com/g/golang-nuts/c/-JcZzOkyqYI/m/xwaZzjCgAwAJ).
