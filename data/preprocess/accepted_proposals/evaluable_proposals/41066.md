=== Fetching Proposal: MDU6SXNzdWU2ODcwNzQ0MDc= ===
Issue URL: https://github.com/golang/go/issues/41066

==== [Issue Title] ====
crypto/tls: export/replace errClosed

==== [Issue Body] ====
<p>Following&#xA0;the&#xA0;discussion in&#xA0;#4373, I&#xA0;propose that
the&#xA0;currently unexported error <code>errClosed</code>
in&#xA0;package <code>crypto/tls</code> be exported.&#x2003;That should
simplify error checking for&#xA0;services which&#xA0;use e.g.&#xA0;TCP,
TLS, or&#xA0;both types of&#xA0;connection depending
on&#xA0;configuration.</p>

<p>@ianlancetaylor&#xA0;also proposed that we replace that custom error
with&#xA0;<code>internal/poll.ErrNetClosing</code>, like&#xA0;it is done
in&#xA0;that CL, but&#xA0;I&#xA0;am not&#xA0;sure about&#xA0;that,
since&#xA0;that could break current code that only wishes to&#xA0;check
the&#xA0;error from&#xA0;<code>crypto/tls</code>
and&#xA0;not&#xA0;<code>net</code>.&#x2003;On the other hand, checking
against&#xA0;one error is obviously easier than&#xA0;checking
against&#xA0;two.</p>


==== [Comments] ====

--- Comment #1 by ianlancetaylor ---
CC @FiloSottile @katiehockman 

My suggestion is that we consider simply replacing `crypto/tls.errClosed` with `net.ErrClosed`.  The error message will be very slightly different, but it will permit consistent use of `errors.Is(err, net.ErrClosed)` to see whether people are trying to do some operation on a connection has been closed.  Or so it seems to me without knowing very much about how this code works.

--- Comment #2 by rsc ---
Now that we've established net.ErrClosed as the "connection is closing/was closed" error, it does seem like TLS should use it.

ping @FiloSottile @katiehockman 

--- Comment #3 by katiehockman ---
The proposal to use `net.ErrClosed` in lieu of the unexported `errClosed` in `crypto/tls` sounds appropriate. @FiloSottile is also in agreement.

--- Comment #4 by rsc ---
Based on the discussion above, this seems like a **likely accept**.


--- Comment #5 by rsc ---
No change in consensus, so accepted.


--- Comment #6 by ainar-g ---
<p>@rsc&#x2003;Great, thanks!&#x2003;Should I&#xA0;send a&#xA0;CL or&#xA0;wait
for&#xA0;someone&#xA0;else to&#xA0;do it?&#x2003;It seems like a&#xA0;small
change, but&#xA0;it's still in&#xA0;a&#xA0;crypto&#xA0;package.</p> 


--- Comment #7 by katiehockman ---
@ainar-g Feel free to send over a CL with this change if you would like!

--- Comment #8 by gopherbot ---
Change https://golang.org/cl/256897 mentions this issue: `crypto/tls: replace errClosed with net.ErrClosed`
