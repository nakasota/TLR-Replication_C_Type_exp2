==== [Issue Title] ====
cmd/go: continue conversion to bug-resistant //go:build constraints

==== [Issue Body] ====
In June I posted a [draft design](https://golang.org/s/go-build-design) for moving from `// +build` lines with ad-hoc syntax to `//go:build` lines with standard Boolean expressions; that doc also has links to a video overview and a prototype implementation.

I propose that we adopt this design, with N = 17 in the [Transition](https://golang.org/s/go-build-design#transition) section, meaning that the prep work would happen in Go 1.16, the main change would land in Go 1.17, and the transition would be finalized in Go 1.18.

==== [Comments] ====

--- Comment #1 by rsc ---
Based on the emoji above and the lack of any objections (along with the overwhelmingly positive Reddit thread), this seems like a **likely accept**.


--- Comment #2 by cristaloleg ---
Post on Reddit: https://www.reddit.com/r/golang/comments/hitexe/qa_gobuild_draft_design/

--- Comment #3 by rsc ---
No change in consensus, so accepted.


--- Comment #4 by rsc ---
Please note that accepting this means that //go:build lines will start working in _Go 1.17_, not Go 1.16. 
Don't everyone rush to put them in.


--- Comment #5 by gopherbot ---
Change https://golang.org/cl/240600 mentions this issue: `go/build: reject //go:build without // +build`

--- Comment #6 by gopherbot ---
Change https://golang.org/cl/240553 mentions this issue: `cmd/go: add IgnoredOtherFiles to go list; pass IgnoredFiles to vet`

--- Comment #7 by gopherbot ---
Change https://golang.org/cl/240601 mentions this issue: `cmd/compile: reject misplaced go:build comments`

--- Comment #8 by gopherbot ---
Change https://golang.org/cl/240602 mentions this issue: `cmd/asm: reject misplaced go:build comments`

--- Comment #9 by gopherbot ---
Change https://golang.org/cl/240554 mentions this issue: `cmd/vet: look at ignored files in buildtag check`

--- Comment #10 by gopherbot ---
Change https://golang.org/cl/261958 mentions this issue: `cmd: go get golang.org/x/tools@d88ec18 && go mod vendor`

--- Comment #11 by rsc ---
All the Go 1.16 prep work for //go:build lines is now landed.
I've retitled and remilestoned the issue to track the Go 1.17 work.


--- Comment #12 by gopherbot ---
Change https://golang.org/cl/240604 mentions this issue: `go/build/constraint: add parser for build tag constraint expressions`

--- Comment #13 by gopherbot ---
Change https://golang.org/cl/240609 mentions this issue: `cmd/vet: update buildtag check for //go:build lines`

--- Comment #14 by gopherbot ---
Change https://golang.org/cl/240608 mentions this issue: `go/printer: canonicalize //go:build and // +build lines while formatting`

--- Comment #15 by gopherbot ---
Change https://golang.org/cl/240607 mentions this issue: `go/build: prefer //go:build over // +build lines`

--- Comment #16 by gopherbot ---
Change https://golang.org/cl/287412 mentions this issue: `api/go1.16: add build/constraint APIs`

--- Comment #17 by gopherbot ---
Change https://golang.org/cl/287472 mentions this issue: `doc/go1.16: document go/build/constraint package`

--- Comment #18 by gopherbot ---
Change https://golang.org/cl/240611 mentions this issue: `cmd/fix: add buildtag fix`

--- Comment #19 by gopherbot ---
Change https://golang.org/cl/294430 mentions this issue: `all: go fmt std cmd (but revert vendor)`

--- Comment #20 by zephyr ---
How will this effect the [Go1.4-bootstrap](https://github.com/golang/go/milestone/28) once the transition will be finalized in Go 1.18?

I just took [master@d4b2638234](https://github.com/golang/go/commit/d4b26382342c98a95b85140b2863bc30c48edd68) and crudely removed all `//+build` lines:

	$ find . -name '*.go' -exec sed -i '/\/\/ +build /d' {} \;

After that, i could no longer bootstrap `master` with `go1.4`:

	dennis@inara:/opt/golang$ update-golang.py dennis
	Building Go cmd/dist using /opt/golang1.4. (go1.4-bootstrap-20170531 linux/amd64)
	# _/opt/golang/src/cmd/dist
	cmd/dist/util_gccgo.go:9: useVFPv1 redeclared in this block
		previous declaration at cmd/dist/util_gc.go:11
	cmd/dist/util_gccgo.go:11: useVFPv3 redeclared in this block
		previous declaration at cmd/dist/util_gc.go:15
	cmd/dist/util_gccgo.go:13: useARMv6K redeclared in this block
		previous declaration at cmd/dist/util_gc.go:20
	Error: /opt/golang/src/make.bash returned

So should `go/build/constraint` be backported to Go1.4?


--- Comment #21 by rsc ---
The compiler has to be kept building with Go 1.4 for now.
That means it has to keep its // +build comments.
I do plan to propose bumping the bootstrap version to Go 1.17,
though, for a variety of reasons, and after we've done that, 
we'd be able to remove the // +build comments.



--- Comment #22 by rsc ---
All the Go 1.17 prep work for //go:build lines is now landed.
I've remilestoned the issue to track the Go 1.18 work
(submitting [golang.org/cl/240611](https://golang.org/cl/240611)).


--- Comment #23 by gopherbot ---
Change https://golang.org/cl/296889 mentions this issue: `unix: add //go:build lines when generating files`

--- Comment #24 by gopherbot ---
Change https://golang.org/cl/319389 mentions this issue: `all: add //go:build lines to assembly files`

--- Comment #25 by gopherbot ---
Change https://golang.org/cl/319410 mentions this issue: `cmd/vendor: update golang.org/x/sys to latest`

--- Comment #26 by gopherbot ---
Change https://golang.org/cl/319469 mentions this issue: `all: add //go:build lines to assembly files`

--- Comment #27 by gopherbot ---
Change https://golang.org/cl/320312 mentions this issue: `all: update golang.org/x/sys to latest`

--- Comment #28 by gopherbot ---
Change https://golang.org/cl/323750 mentions this issue: `runtime/internal/sys: generate //go:build lines in gengoos.go`

--- Comment #29 by gopherbot ---
Change https://golang.org/cl/341009 mentions this issue: `all: gofmt more (but vendor, testdata, and top-level test directories)`

--- Comment #30 by cagedmantis ---
This issue is currently labeled as early-in-cycle for Go 1.18.
That [time is now](https://groups.google.com/g/golang-dev/c/g2aGRJQIGzw/m/m7hkf2YiAAAJ), so this is a friendly ping so the issue is looked at again.
