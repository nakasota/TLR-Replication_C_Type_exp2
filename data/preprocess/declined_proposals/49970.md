=== Fetching Proposal: Existing alternatives ===
Issue URL: https://github.com/golang/go/issues/49970

==== [Issue Title] ====
proposal: net/netip: add Unmap() to netip.Is4()

==== [Issue Body] ====
<!--
Please answer these questions before submitting your issue. Thanks!
-->

### What version of Go are you using (`go version`)?

<pre>
$ devel go1.18-a174638a5c Fri Dec 3 14:28:11 2021 +0000
</pre>

### Does this issue reproduce with the latest release?

This is for Go 1.18

### What operating system and processor architecture are you using (`go env`)?

<details><summary><code>go env</code> Output</summary><br><pre>
$ go env

</pre></details>

### What did you do?

Currently to check if an IP address `ip` is an IPv4, you have to do `ip.Unmap().Is4()`, as IPv4 addresses are mapped into 128 bits, so you first need to `Unmap` it, to then use the function `Is4`. 

For IPv6 you can simply do `ip.Is6()`, but `ip.Unmap().Is6()` will also work. 

<!--
If possible, provide a recipe for reproducing the error.
A complete runnable program is good.
A link on go.dev/play is best.
-->
This is an example: https://go.dev/play/p/slX6Bjf9Ee1?v=gotip

### What did you expect to see?

I'm just wondering if there is a chance to have either `Unmap `called inside the `Is4` and `Is6` functions, or have a new API that is consistent for v4 and v6, so we can do: `ip.IsV4()` or `ip.IsV6()` for example.

### What did you see instead?

Not a biggie, just a minor cosmetic thing for very picky people like me.



==== [Comments] ====

--- Comment #1 by mdlayher ---
Note that `net/netip` also has IP address parsing. I've modified your example a bit: https://go.dev/play/p/nGkMK5a0jQR

Using both packages is a bit awkward but I expect most callers should migrate to `net/netip` exclusively.

--- Comment #2 by nleiva ---
Thanks Matt, your example is more concise and it better illustrates the point I'm trying to make.  You need to add: `?v=gotip` to the link for anyone to run it: https://go.dev/play/p/nGkMK5a0jQR?v=gotip

--- Comment #3 by seankhliao ---
Is this still needed then?

--- Comment #4 by nleiva ---
Yes. In a nutshell, I'm looking for the possibility to change:

```go
ip.Unmap().Is4()
ip.Unmap().Is6()
```

to

```go
ip.Is4()
ip.Is6()
```

By doing `Unmap` inside `IsX`. Otherwise it feels like we are mixing the nature of the IP address with library implementation details in the API when trying to find out if the address is IPv4 or IPv6. This might be OK, I just wanted to see what other think about this.

--- Comment #5 by rsc ---
ip.Is4() and ip.Unmap().Is4() are asking different, both completely reasonable questions.
The latter is accepting IPv4-in-IPv6-mapped IPv4 addresses, while the former does not.
It seems like we should keep both. Sometimes people want one, sometimes the other.

Is there anything unclear in the docs? It sounds like you found what you wanted and just wish it was shorter.


--- Comment #6 by nleiva ---
Thank Russ, I agree both forms answer different questions. In my limited experience, users will use `Is4` as the documentation suggests: "_to reports whether ip is an IPv4 address_", and experience frustration when it returns false even if it's indeed an IPv4 address, but it just happens it ended up as mapped IPv6 because of the library representation of an `Addr` (128 bits). Yes this is documented: "_It returns false for IP4-mapped IPv6 addresses_". I think it might be confusing for some users, but of course I'm probably off here.

What if both `Is4` and `Is6` Unmap by default, considering this would be the most popular use-case (find out the type of the address without caveats), to make it simple and shorter for the user, and add another API `IsMapped` to find out if it is an IPv4-in-IPv6-mapped address for the rest of the cases? Thanks



--- Comment #7 by mdlayher ---
> ... and add another API IsMapped to find out if it is an IPv4-in-IPv6-mapped address for the rest of the cases?

This does exist today as https://pkg.go.dev/net/netip#Addr.Is4In6.

--- Comment #8 by nleiva ---
> > ... and add another API IsMapped to find out if it is an IPv4-in-IPv6-mapped address for the rest of the cases?
> 
> This does exist today as https://pkg.go.dev/net/netip#Addr.Is4In6.

Good catch! In fact `Unmap` calls it, thank you. 

Bottom line is I personally believe, so take it with a grain of salt, people won't care as much about whether the address is mapped or not, so why not make it simpler for the potential most popular use case, which is finding out what type of IP address it is: IPv4 or IPv6. Thanks



--- Comment #9 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
— rsc for the proposal review group


--- Comment #10 by rsc ---

Based on the discussion above, this proposal seems like a **[likely decline](https://golang.org/s/proposal-status#likely-decline)**.
— rsc for the proposal review group


--- Comment #11 by nleiva ---
Understood. This is just a nice to have. Thanks for taking the time to discuss it.

--- Comment #12 by rsc ---

No change in consensus, so **[declined](https://golang.org/s/proposal-status#declined)**.
— rsc for the proposal review group

