=== Fetching Proposal: Existing alternatives ===
Issue URL: https://github.com/golang/go/issues/44484

==== [Issue Title] ====
proposal: embed: conditional embedding support

==== [Issue Body] ====
Really nice to see `embed` finally gets arrived to standard library!

Yet I believe, conditional embedding would be desirable in some use cases, seems there aren't any.

I was using [packr](https://github.com/gobuffalo/packr) beforehand to achieve this kind of behavior; mainly because when I want to build for container image, I do not want to embed files (mainly frontend built assets files) packed into binary because it will increase memory usage a lot.

I think it would be enough `//go:embed` might just ignore embedding by giving buildflags or environment variables in build time.

==== [Comments] ====

--- Comment #1 by ianlancetaylor ---
Can you just use a build tag?

--- Comment #2 by kesuskim ---
@ianlancetaylor Is there any option that can be used for such use cases? Build tag is OK, but it seems currently not supported.

--- Comment #3 by jayconrod ---
@kesuskim You should be able to put the `//go:embed` directive in a file with a build tag like this:

```
// +build embedallowed

package x

//go:embed somefile.txt
var somefile string
```

Then build with `-tags=embedallowed`. This is supported now. `go build` won't process `//go:embed` directives in files that were excluded by build constraints.

--- Comment #4 by kesuskim ---
@jayconrod That will do! Thank you ðŸ˜„ Maybe it will be enough to have some documents or blogs about it, I should make writing on my blog.

--- Comment #5 by frederikhors ---
I think we should re-open this because `tags` should not be the only way to go.

Why can't I use this code instead?

```go
var somefile string

if embedAllowed {
  //go:embed somefile.txt
  somefile
}
```

--- Comment #6 by frederikhors ---
@kesuskim can you re-open please?

--- Comment #7 by kesuskim ---
@frederikhors 

You can achieve similar with build tag. Here is an example for it.


`public/box.go`
```go
package public

import "embed"

var Box embed.FS

var IsEmbedded bool

func init() {
    Box = ebox
}
```


`public/box_embed.go`
```go
// +build embed

package public

import "embed"

//go:embed * index.html
var ebox embed.FS

func init() {
    IsEmbedded = true
}
```

`public/box_noembed.go`
```go
// +build !embed

package public

import "embed"

var ebox embed.FS

func init() {
    IsEmbedded = false
}
```

`main.go`
```go
package main

import (
    "fmt"
    "log"
    "net/http"

    "myproject/public"
)

const PORT = 8080

var httpRoot http.FileSystem

func main() {
    if public.IsEmbedded {
        httpRoot = http.FS(public.Box)
    } else {
        httpRoot = http.Dir("public/")
    }

    log.Printf("server is listening on :%d", PORT)
    http.Handle("/", http.FileServer(httpRoot))
    if err := http.ListenAndServe(fmt.Sprintf(":%d", PORT), nil); nil != err {
        log.Fatalln(err)
    }
}
```

To use `embed`, you can build with build tags like following;

```bash
$ go build -tags embed
```

--- Comment #8 by kesuskim ---
I think having multiple options on doing one thing (in this case, conditional embed) could be very confusing and diverged in the end, and IMHO it is not a Go-way.

--- Comment #9 by frederikhors ---
Yeah, I know and I'm using it, but my question is about not using `-tags` at all for such a thing.

--- Comment #10 by ianlancetaylor ---
@frederikhors  I don't understand what it means to write

```Go
    var somefile string

    if embedAllowed {
        //go:embed somefile.txt
        somefile
    }
```

In order to implement that, the file somefile.txt must always be embedded in the binary.  So I don't understand what you are asking for.

--- Comment #11 by frederikhors ---
I'm asking to only embed file if `embedAllowed` is true.

--- Comment #12 by ianlancetaylor ---
When we build the binary, we have to decide whether to embed the file or not.  We can't postpone that decision until the binary is run.  But when we build the binary, we don't know whether `embedAllowed` is true or not.  It might change at run time.  It might be based on a command line option.  It might be based on user input.
