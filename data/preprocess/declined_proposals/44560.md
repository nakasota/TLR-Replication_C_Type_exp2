=== Fetching Proposal: Deprecated proposals ===
Issue URL: https://github.com/golang/go/issues/44560

==== [Issue Title] ====
proposal: cmd/go: record build tags in build info (for debug.ReadBuildInfo)

==== [Issue Body] ====
This was asked a long time ago, and ultimately rejected, but I'm hoping it can be reconsidered. https://github.com/golang/go/issues/7007

Knowing the build tags at runtime so they can be logged is very useful for debugging/troubleshooting. For example, there isn't really a way today to easily tell if a particular binary was compiled with netgo or netcgo.

To discourage abuse, and to also prevent pointlessly invalidating the build cache, I think it would be fine if the list of build tags were only able to be embedded into a global variable in the main package. For example:

```go
package main

//go:build-tags
var BuildTags []string

func main() {
    log.Printf("built with: %s", BuildTags)
    ...
}
```

This is effectively equivalent to doing something like `go build -tags="${BUILD_TAGS}" -ldflags "-X main.BuildTags=${BUILD_TAGS}"` just without the extra manual bookkeeping.

==== [Comments] ====

--- Comment #1 by ianlancetaylor ---
Has anything changed since #7007 was declined?

--- Comment #2 by rittneje ---
#7007 seemed to be asking for the ability to get the tags in an arbitrary package in order to do conditional logic. It was thus rejected because doing that was deemed hacky, and there didn't appear to be a legitimate reason to need them at runtime. But I've found that at least being able to log what they were would be very useful, similar to how we can log [`runtime.Version()`](https://golang.org/pkg/runtime/#Version) today. I don't intend to be performing if checks with them or any such thing.

--- Comment #3 by mvdan ---
Something that has changed in the recent years is the addition of https://golang.org/pkg/runtime/debug/#ReadBuildInfo. One could say that the list of build tags is part of the running binary's build information.

--- Comment #4 by rittneje ---
@mvdan I don't think that runtime/debug is the best place to record the build tags, since that would cause the build cache to be invalidated for all packages that directly or indirectly import that package whenever the set of build tags changes. It is for this reason that I think embedding them directly in main is a better choice, since if I'm changing build tags, I pretty much expect _at least_ main to change. (And the implications of a cache invalidation for the main package are lesser, since nothing should be importing it anyway.)

Unless writing them into runtime/debug can be deferred until link time? Not sure what's feasible.

--- Comment #5 by bcmills ---
@rittneje, the contents reported by `runtime/debug.ReadBuildInfo` are already injected more-or-less at link time by the `go` command. They shouldn't have any effect on cacheability for `runtime/debug` itself or the packages that (directly or indirectly) depend on it.

--- Comment #6 by AlekSi ---
I think that was done recently for 1.18:

```
$ go version -m XXX
[...]
build	tags	testcover,race,goexperiment.regabiwrappers,goexperiment.regabireflect,goexperiment.regabiargs,goexperiment.pacerredesign
[...]
```

It is also available via `Settings` field.

I guess it can be closed?

--- Comment #7 by rsc ---

This proposal has been **[declined as retracted](https://golang.org/s/proposal-status#declined-as-retracted)**.
â€” rsc for the proposal review group

