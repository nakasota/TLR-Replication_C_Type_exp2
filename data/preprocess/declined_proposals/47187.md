=== Fetching Proposal: Limited use cases ===
Issue URL: https://github.com/golang/go/issues/47187

==== [Issue Title] ====
proposal: os: ExpandEnv: Support Parameter Substitution and Expansion Notations

==== [Issue Body] ====
Currently, [os.ExpandEnv(s string) string](https://pkg.go.dev/os#ExpandEnv) -  supports only $var and ${var} notations:
> _ExpandEnv replaces ${var} or $var in the string according to the values of the current environment variables. References to undefined variables are replaced by the empty string. _

I propose that Go also should support [Parameter Substitution and Expansion](https://tldp.org/LDP/abs/html/refcards.html#AEN22728) notations:

| Expression       | Meaning                                                                                     |
|------------------|---------------------------------------------------------------------------------------------|
| ${var}           | Value of var (same as 	        $var)                                                         |
|                  |                                                                                             |
| ${var-$DEFAULT}  | If var not set, evaluate expression 	        as $DEFAULT *                                   |
| ${var:-$DEFAULT} | If var not set or is empty,               evaluate expression as                 $DEFAULT 		* |
|                  |                                                                                             |
| ${var=$DEFAULT}  | If var not set, evaluate expression 	        as $DEFAULT *                                   |
| ${var:=$DEFAULT} | If var not set or is empty, evaluate expression 	        as $DEFAULT *                       |
|                  |                                                                                             |
| ${var+$OTHER}    | If var set, evaluate expression as 	        $OTHER, otherwise as null string                 |
| ${var:+$OTHER}   | If var set, evaluate expression as 	        $OTHER, otherwise as null string                 |
|                  |                                                                                             |
| ${var?$ERR_MSG}  | If var not set, print 		      $ERR_MSG and abort script 		      with an exit status of 1.*      |
| ${var:?$ERR_MSG} | If var not set, print 		      $ERR_MSG and abort script 		      with an exit status of 1.*      |
|                  |                                                                                             |
| ${!varprefix*}   | Matches all previously declared variables beginning with 	        varprefix                  |
| ${!varprefix@}   | Matches all previously declared variables beginning with 	        varprefix                  |

* `*` If var is set, evaluate the expression as $var with no side-effects.

* `#` Note that some of the above behavior of operators has changed from earlier versions of Bash.

Example:

```go
package main

import (
	"fmt"
	"os"
)

func main() {
	os.Setenv("FOO", "foo")
	
	fmt.Println(os.ExpandEnv("${FOO}"))  //  FOO
	fmt.Println(os.ExpandEnv("${BAR:-bar}"))  //  EMPTY
	fmt.Println(os.ExpandEnv("${BAR:=bar}"))  //  EMPTY
	// etc

}
```

==== [Comments] ====

--- Comment #1 by robpike ---
The os library is not meant to be a bash library, and should not evolve in that direction. Although to do so might be convenient in some situations, the operations listed here, as well as their syntax, are not universal, and it would be wrong to act as though they were. The os package must remain portable in both function and behavior across multiple different systems.

Also, the operations here are trivial to implement in Go in the rare cases they are needed.


--- Comment #2 by Dentrax ---
Oh, make sense! Also, I think we may need to write a "tiny" lexer to parse that bash syntax, which may overcomplicate `os` package. I see the concern now! Thanks.

--- Comment #3 by mvdan ---
If you do want to support the full shell/bash syntax, take a look at https://pkg.go.dev/mvdan.cc/sh/v3/shell#Expand. The module also contains a syntax parser. I fully agree that none of that should be in the standard library.

--- Comment #4 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
— rsc for the proposal review group


--- Comment #5 by seh ---
[The _drone/envsubst_ package](https://github.com/drone/envsubst) gets you most of the way there.

--- Comment #6 by rsc ---

Based on the discussion above, this proposal seems like a **[likely decline](https://golang.org/s/proposal-status#likely-decline)**.
— rsc for the proposal review group


--- Comment #7 by rsc ---

No change in consensus, so **[declined](https://golang.org/s/proposal-status#declined)**.
— rsc for the proposal review group

