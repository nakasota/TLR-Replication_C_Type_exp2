=== Fetching Proposal: Poor feasibility ===
Issue URL: https://github.com/golang/go/issues/48811

==== [Issue Title] ====
proposal: net/http: add Request.SetContext

==== [Issue Body] ====
related: https://github.com/golang/go/pull/48339

==== [Comments] ====

--- Comment #1 by neild ---
Copying a comment from [CL 349369](https://golang.org/cl/349369):

> The original change which introduced a Context to Request deliberately made this field unexported and provided no way to set the context for a Request without copying it. A proposal to change this should explain what has changed since then. See in particular rsc@'s comment here:
> https://github.com/golang/go/issues/14660#issuecomment-200145301


--- Comment #2 by lesismal ---
For the std, the prohibition for `context` field is reasonable. 

But for non-std frameworks that want to be compatible with std Handler, this limits the implementation of non-std frameworks. Although I've found a way [here](https://github.com/golang/go/pull/48339#issuecomment-919742085), it wastes more.

The std solution——one or more goroutines per connection, when handling a 1000k scenario, cost huge memory, scheduling, GC, and leads to STW more easily and it even performs obviously worse than `java-netty` and `nodejs`. So there are still people of us in the community who try to use the syscall+ poller to solve the 1000k problem, we save a lot of hardware configuration and bring better stability.

--- Comment #3 by neild ---
I'm sorry, but I don't see what `Request.SetContext` has to do with numbers of goroutines.

--- Comment #4 by lesismal ---
> I'm sorry, but I don't see what `Request.SetContext` has to do with numbers of goroutines.

Sorry for that, I forgot to explain.

[Here](https://github.com/lesismal/nbio/blob/master/nbhttp/processor.go#L118) I want to set the `context` field, but there's no `Request.SetContext` method, so I set the whole `Request` struct with [another struct that has the context value](https://github.com/lesismal/nbio/blob/master/nbhttp/engine.go#L473).  

--- Comment #5 by lesismal ---
nbio is a poller framework, it saves goroutines and aims to solve 1000k, also wants to be compatible with std Handler as much as possible, so I want to set the `Request.context`

--- Comment #6 by rsc ---
Request is explicitly immutable. That's why we have Request.WithContext.



--- Comment #7 by rsc ---
Declining as infeasible (contradicts basic design).


--- Comment #8 by rsc ---
This proposal has been **[declined as infeasible](https://golang.org/s/proposal-status#declined-as-infeasible)**.
— rsc for the proposal review group

