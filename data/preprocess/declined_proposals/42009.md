=== Fetching Proposal: Poor feasibility ===
Issue URL: https://github.com/golang/go/issues/42009

==== [Issue Title] ====
proposal: encoding/json: add EvalJSONPointer function to support RFC 6901

==== [Issue Body] ====
[RFC 6901](https://www.rfc-editor.org/rfc/rfc6901.html) describes the JSON Pointer standard.

JSON Pointer defines a string syntax for identifying a specific value within a JSON document.

More advanced query languages like [JSONPath](https://goessner.net/articles/JsonPath/) and [JMESPath](https://jmespath.org/) is not required in many cases.  Also including it as part of the standard library would be an overkill.

Since JSON Pointer is a small standard, the implementation would be easy.

The API could be something like this:

```go
func EvalJSONPointer(v interface{}, format string) ([]byte, error) {...}
```


==== [Comments] ====

--- Comment #1 by Merovius ---
I think the API needs a bit of work. AIUI it takes an arbitrary Go value and returns a `[]byte` - so is the intent that it marshals the referenced value into JSON? ISTM that it would be more useful to return the value as a Go value. But that mainly depends on how people would want to use it - there might even be a need for different function signatures, to do different things. In particular, the RFC poses two questions that need answers: 1. How is `-` handled and 2. how are errors handled? Again - we might need different answers for different use-cases.

Given that, as far as I can see, nothing in the stdlib benefits from this and the implementation also doesn't benefit from coupling with internal stdlib code, I think the best course of action here is to implement this outside the stdlib to experiment with the API and re-consider the benefits of including it once kinks in the API has been shaken out.

--- Comment #2 by mvdan ---
I agree with Axel; implement this outside of the standard library first. https://golang.org/doc/faq#x_in_std

--- Comment #3 by baijum ---
> I agree with Axel; implement this outside of the standard library first. https://golang.org/doc/faq#x_in_std

On a quick search, I found these implementations with different API:

1. https://github.com/dolmen-go/jsonptr
1. https://github.com/qri-io/jsonpointer
1. https://github.com/go-openapi/jsonpointer
1. https://github.com/dustin/go-jsonpointer
1. https://github.com/xeipuuv/gojsonpointer
1. https://github.com/yukithm/json2csv/tree/master/jsonpointer
1. https://github.com/json-validate/json-pointer-go
1. https://github.com/twindagger/jsonptr
1. https://github.com/rnd42/go-jsonpointer
1. https://github.com/lestrrat-go/jspointer

Edit 1: Added one more implementation (jsonptr)
Edit 2: Added 4 more implementations

--- Comment #4 by rsc ---
encoding/json does support a generic JSON representation - map[string]interface{} - but it's not really the most efficient or preferred implementation most of the time. Would jsonpointer have to work on every possible struct that can be marshaled or unmarshaled with the json package?

Also, how commonly used is this? Why not keep using one of the choices outside the standard library?


--- Comment #5 by dolmen ---
As the author of package [github.com/dolmen-go/jsonptr](https://pkg.go.dev/github.com/dolmen-go/jsonptr) I don't think there is a need for a JSON Pointer implementation inside the stdlib. An implementation inside the stdlib would not be easier than any external one. The only valid reason for an stdlib implementation would be to reduce fragmentation by directing most users of JSON Pointer towards the use of that implementation.

@rsc wrote:
> encoding/json does support a generic JSON representation - map[string]interface{} - but it's not really the most efficient or preferred implementation most of the time. Would jsonpointer have to work on every possible struct that can be marshaled or unmarshaled with the json package?

An under-documented feature of my own implementation is that it supports not just trees of `[]interface{}` and `map[string]interface{}` as input document, but also [`json.RawMessage`](https://golang.org/pkg/encoding/json/#RawMessage) and any value implementing interface [`JSONDecoder`](https://pkg.go.dev/github.com/dolmen-go/jsonptr#JSONDecoder) (a subset of [`encoding/json.Decoder`]() API). This allows much flexibility for input. However the same flexibility isn't offered for [`jsonptr.Set`](https://pkg.go.dev/github.com/dolmen-go/jsonptr#Set) because of writability constraints.

--- Comment #6 by dolmen ---
I've also published a framework for benchmarking Go implementations of JSON Pointer here:
https://github.com/dolmen-go/jsonptr-benchmark

--- Comment #7 by rsc ---
Based on the discussion above, this seems like a **likely decline**.


--- Comment #8 by rsc ---
No change in consensus, so declined.

