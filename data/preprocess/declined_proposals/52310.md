=== Fetching Proposal: Duplication ===
Issue URL: https://github.com/golang/go/issues/52310

==== [Issue Title] ====
proposal: reflect: allow Value.Set with zero Value for interface values

==== [Issue Body] ====
Consider the following Go code:
```go
type I = interface { ... }
var x I = ...
var y I = ...
x = y
```

Consider the seemingly equivalent Go reflection code:
```go
vx := reflect.ValueOf(&x).Elem()
vy := reflect.ValueOf(y)
vx.Set(vy) // analogous to x = y
```

However, the reflection code about is not quite equivalent since it panics if y is nil.
This occurs because `reflect.ValueOf` loses track of the fact that `y` may be a nil interface value
and simply constructs a zero `reflect.Value`.

The workaround is somewhat convoluted and not immediately obvious as necessary:
```go
vx := reflect.ValueOf(&x).Elem()
vy := reflect.ValueOf(y)
if vy.IsValid() {
    vx.Set(vy)
} else {
    vx.Set(reflect.Zero(vx.Type()))
}
```

I propose changing the behavior of `func (v Value) Set(x Value)` such that `x` may be a zero `Value` only if `v` is an interface value, in which case it simply stores a nil value.

This should be a generally safe change since switching from a panic to a non-panic is not likely to break existing code.

==== [Comments] ====

--- Comment #1 by dsnet ---
It just occurred to me that I could do:
```go
vy := reflect.ValueOf(&y).Elem()
vx.Set(vy) // analogous to x = y
```
but that always causes `y` to escape be allocated on the heap.

--- Comment #2 by ianlancetaylor ---
In the same general space as #51649.  CC @robpike 

--- Comment #3 by rsc ---
This is very similar to #51649 but I think we need to figure out what the scope of "treat zero Value as untyped nil" would be. Where do we stop? If someone can come up with a clear answer for that question, it would help us move forward.


--- Comment #4 by rsc ---

This proposal has been added to the [active column](https://golang.org/s/proposal-status#active) of the proposals project
and will now be reviewed at the weekly proposal review meetings.
â€” rsc for the proposal review group


--- Comment #5 by dsnet ---
> Where do we stop? If someone can come up with a clear answer for that question, it would help us move forward.

In https://github.com/golang/go/issues/51649#issuecomment-1098426793, I came up with a concrete proposal for comprehensive changes to `reflect` if we were to consistently treat a zero `Value` as equivalent to an untyped `nil`.

--- Comment #6 by rsc ---
Let's merge this into #51649. Closing as duplicate.

